{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { MIN_PRIORITY as t } from \"../../../../core/MemCache.js\";\nimport { throwIfAborted as o } from \"../../../../core/promiseUtils.js\";\nimport { f as i } from \"../../../../chunks/mat3f32.js\";\nimport { create as s } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { TileHandler as r } from \"./TileHandler.js\";\nimport { VectorTile as n } from \"./VectorTile.js\";\nimport { declutterSingleTile as l } from \"./decluttering/jobsUtil.js\";\nimport a from \"../../tiling/TileInfoViewPOT.js\";\nimport g from \"../../tiling/TileKey.js\";\nclass h extends r {\n  constructor(e, t, o, i, s) {\n    super(e, t, o), this._memCache = i, this._loader = s, this._ongoingTileRequests = new Map(), this._ongoingRequestToController = new Map(), this._tileInfoView = new a(e.tileInfo, e.fullExtent);\n  }\n  destroy() {\n    super.destroy(), this._ongoingRequestToController.forEach(e => e.abort()), this._ongoingRequestToController.clear(), this._ongoingTileRequests.clear();\n  }\n  async getVectorTile(r, a, h, m) {\n    const u = new g(r, a, h, 0);\n    let c = this._memCache.get(u.id);\n    if (e(c)) return c.retain(), c;\n    const _ = await this._getVectorTileData(u);\n    if (o(m), !this._layer) return null;\n    if (c = this._memCache.get(u.id), e(c)) return c.retain(), c;\n    const T = this._layer.tileInfo.getTileBounds(s(), u),\n      f = this._tileInfoView.getTileResolution(r);\n    return c = new n(u, f, T[0], T[3], 512, 512, this._styleRepository, this._memCache), e(_) ? (c.setData(_), c.retain(), this._memCache.put(u.id, c, c.memoryUsage * c.referenced, t)) : c.setData(null), c.neededForCoverage = !0, c.transforms.tileUnitsToPixels = i(1 / 8, 0, 0, 0, 1 / 8, 0, 0, 0, 1), l(c, this._styleRepository), c;\n  }\n  _getVectorTileData(e) {\n    const t = e.id;\n    if (this._ongoingTileRequests.has(t)) return this._ongoingTileRequests.get(t);\n    const o = new AbortController(),\n      i = {\n        signal: o.signal\n      },\n      s = this._getParsedVectorTileData(e, i).then(e => (this._ongoingTileRequests.delete(t), this._ongoingRequestToController.delete(t), e)).catch(() => (this._ongoingTileRequests.delete(t), this._ongoingRequestToController.delete(t), null));\n    return this._ongoingTileRequests.set(t, s), this._ongoingRequestToController.set(t, o), s;\n  }\n  _getParsedVectorTileData(e, t) {\n    return this.fetchTileData(e, t).then(o => this.parseTileData({\n      key: e,\n      data: o\n    }, t));\n  }\n  request(e, t) {\n    return this._loader.request(e, \"binary\", t);\n  }\n}\nexport { h as default };","map":{"version":3,"names":["isSome","e","MIN_PRIORITY","t","throwIfAborted","o","f","i","create","s","TileHandler","r","VectorTile","n","declutterSingleTile","l","a","g","h","constructor","_memCache","_loader","_ongoingTileRequests","Map","_ongoingRequestToController","_tileInfoView","tileInfo","fullExtent","destroy","forEach","abort","clear","getVectorTile","m","u","c","get","id","retain","_","_getVectorTileData","_layer","T","getTileBounds","getTileResolution","_styleRepository","setData","put","memoryUsage","referenced","neededForCoverage","transforms","tileUnitsToPixels","has","AbortController","signal","_getParsedVectorTileData","then","delete","catch","set","fetchTileData","parseTileData","key","data","request","default"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/2d/engine/vectorTiles/TileHandler3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{MIN_PRIORITY as t}from\"../../../../core/MemCache.js\";import{throwIfAborted as o}from\"../../../../core/promiseUtils.js\";import{f as i}from\"../../../../chunks/mat3f32.js\";import{create as s}from\"../../../../geometry/support/aaBoundingRect.js\";import{TileHandler as r}from\"./TileHandler.js\";import{VectorTile as n}from\"./VectorTile.js\";import{declutterSingleTile as l}from\"./decluttering/jobsUtil.js\";import a from\"../../tiling/TileInfoViewPOT.js\";import g from\"../../tiling/TileKey.js\";class h extends r{constructor(e,t,o,i,s){super(e,t,o),this._memCache=i,this._loader=s,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new a(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(r,a,h,m){const u=new g(r,a,h,0);let c=this._memCache.get(u.id);if(e(c))return c.retain(),c;const _=await this._getVectorTileData(u);if(o(m),!this._layer)return null;if(c=this._memCache.get(u.id),e(c))return c.retain(),c;const T=this._layer.tileInfo.getTileBounds(s(),u),f=this._tileInfoView.getTileResolution(r);return c=new n(u,f,T[0],T[3],512,512,this._styleRepository,this._memCache),e(_)?(c.setData(_),c.retain(),this._memCache.put(u.id,c,c.memoryUsage*c.referenced,t)):c.setData(null),c.neededForCoverage=!0,c.transforms.tileUnitsToPixels=i(1/8,0,0,0,1/8,0,0,0,1),l(c,this._styleRepository),c}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const o=new AbortController,i={signal:o.signal},s=this._getParsedVectorTileData(e,i).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,s),this._ongoingRequestToController.set(t,o),s}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((o=>this.parseTileData({key:e,data:o},t)))}request(e,t){return this._loader.request(e,\"binary\",t)}}export{h as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}