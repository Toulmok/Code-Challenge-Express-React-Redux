{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../core/maybe.js\";\nimport { isArrayBuffer as r } from \"../../../core/typedArrayUtil.js\";\nimport { c as e } from \"../../../chunks/quat.js\";\nimport { c as a } from \"../../../chunks/quatf32.js\";\nimport { q as o } from \"../../../chunks/vec3.js\";\nimport { f, c as i } from \"../../../chunks/vec3f32.js\";\nimport { projectBuffer as n } from \"../../../geometry/projection.js\";\nimport s from \"../../../geometry/SpatialReference.js\";\nimport { readGeometry as u, getAttributeValues as l, evaluateRenderer as b, filterInPlace as m } from \"./i3s/PointCloudWorkerUtil.js\";\nclass c {\n  transform(e) {\n    const a = this._transform(e),\n      o = [a.points.buffer, a.rgb.buffer];\n    t(a.pointIdFilterMap) && o.push(a.pointIdFilterMap.buffer);\n    for (const t of a.attributes) \"buffer\" in t.values && r(t.values.buffer) && t.values.buffer !== a.rgb.buffer && o.push(t.values.buffer);\n    return Promise.resolve({\n      result: a,\n      transferList: o\n    });\n  }\n  _transform(r) {\n    const e = u(r.schema, r.geometryBuffer);\n    let a = e.length / 3,\n      o = null;\n    const f = [],\n      i = l(r.primaryAttributeData, e, a);\n    t(r.primaryAttributeData) && i && f.push({\n      attributeInfo: r.primaryAttributeData.attributeInfo,\n      values: i\n    });\n    const n = l(r.modulationAttributeData, e, a);\n    t(r.modulationAttributeData) && n && f.push({\n      attributeInfo: r.modulationAttributeData.attributeInfo,\n      values: n\n    });\n    let c = b(r.rendererInfo, i, n, a);\n    if (r.filterInfo && r.filterInfo.length > 0 && t(r.filterAttributesData)) {\n      const i = r.filterAttributesData.filter(t).map(t => {\n        const r = l(t, e, a),\n          o = {\n            attributeInfo: t.attributeInfo,\n            values: r\n          };\n        return f.push(o), o;\n      });\n      o = new Uint32Array(a), a = m(e, c, o, r.filterInfo, i);\n    }\n    for (const t of r.userAttributesData) {\n      const r = l(t, e, a);\n      f.push({\n        attributeInfo: t.attributeInfo,\n        values: r\n      });\n    }\n    3 * a < c.length && (c = new Uint8Array(c.buffer.slice(0, 3 * a))), this._applyElevationOffsetInPlace(e, a, r.elevationOffset);\n    const p = this._transformCoordinates(e, a, r.obb, s.fromJSON(r.inSR), s.fromJSON(r.outSR));\n    return {\n      obb: r.obb,\n      points: p,\n      rgb: c,\n      attributes: f,\n      pointIdFilterMap: o\n    };\n  }\n  _transformCoordinates(t, r, a, s, u) {\n    if (!n(t, s, 0, t, u, 0, r)) throw new Error(\"Can't reproject\");\n    const l = f(a.center[0], a.center[1], a.center[2]),\n      b = i(),\n      m = i();\n    e(p, a.quaternion);\n    const c = new Float32Array(3 * r);\n    for (let e = 0; e < r; e++) b[0] = t[3 * e] - l[0], b[1] = t[3 * e + 1] - l[1], b[2] = t[3 * e + 2] - l[2], o(m, b, p), a.halfSize[0] = Math.max(a.halfSize[0], Math.abs(m[0])), a.halfSize[1] = Math.max(a.halfSize[1], Math.abs(m[1])), a.halfSize[2] = Math.max(a.halfSize[2], Math.abs(m[2])), c[3 * e] = b[0], c[3 * e + 1] = b[1], c[3 * e + 2] = b[2];\n    return c;\n  }\n  _applyElevationOffsetInPlace(t, r, e) {\n    if (0 !== e) for (let a = 0; a < r; a++) t[3 * a + 2] += e;\n  }\n}\nconst p = a();\nfunction h() {\n  return new c();\n}\nexport { h as default };","map":{"version":3,"names":["isSome","t","isArrayBuffer","r","c","e","a","q","o","f","i","projectBuffer","n","s","readGeometry","u","getAttributeValues","l","evaluateRenderer","b","filterInPlace","m","transform","_transform","points","buffer","rgb","pointIdFilterMap","push","attributes","values","Promise","resolve","result","transferList","schema","geometryBuffer","length","primaryAttributeData","attributeInfo","modulationAttributeData","rendererInfo","filterInfo","filterAttributesData","filter","map","Uint32Array","userAttributesData","Uint8Array","slice","_applyElevationOffsetInPlace","elevationOffset","p","_transformCoordinates","obb","fromJSON","inSR","outSR","Error","center","quaternion","Float32Array","halfSize","Math","max","abs","h","default"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as i}from\"../../../chunks/vec3f32.js\";import{projectBuffer as n}from\"../../../geometry/projection.js\";import s from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],i=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&i&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:i});const n=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&n&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:n});let c=b(r.rendererInfo,i,n,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const i=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,i)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,s.fromJSON(r.inSR),s.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,s,u){if(!n(t,s,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=i(),m=i();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}