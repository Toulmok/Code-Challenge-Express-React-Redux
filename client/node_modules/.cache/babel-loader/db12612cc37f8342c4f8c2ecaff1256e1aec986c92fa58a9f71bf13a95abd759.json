{"ast":null,"code":"import _regeneratorRuntime from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport t from \"../../../../../core/Logger.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { isAbortError as a, throwIfAborted as s, throwIfNotAbortError as i } from \"../../../../../core/promiseUtils.js\";\nimport { BaseFeatureSource as o } from \"./BaseFeatureSource.js\";\nvar n = /*#__PURE__*/function (_o) {\n  _inherits(n, _o);\n  var _super = _createSuper(n);\n  function n(e) {\n    _classCallCheck(this, n);\n    return _super.call(this, e);\n  }\n  _createClass(n, [{\n    key: \"_fetchDataTile\",\n    value: function () {\n      var _fetchDataTile2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(r) {\n        var _this = this;\n        var i, o, _n, d, c, u, p, h, m, _o2, _loop, _s;\n        return _regeneratorRuntime().wrap(function _callee$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              i = 6, o = 20, _n = this._subscriptions.get(r.key.id);\n              d = !1, c = 0, u = 0;\n              p = function p(e, t) {\n                u--, s(_n);\n                var a = r.id,\n                  i = e.reader,\n                  o = e.query;\n                if (!i.exceededTransferLimit) {\n                  if (d = !0, 0 !== t && !i.hasFeatures) {\n                    var _e = {\n                      id: a,\n                      addOrUpdate: i,\n                      end: 0 === u,\n                      type: \"append\"\n                    };\n                    return _n.add({\n                      message: _e,\n                      query: o\n                    }), void _this._onMessage(_e);\n                  }\n                  var _e2 = {\n                    id: a,\n                    addOrUpdate: i,\n                    end: 0 === u,\n                    type: \"append\"\n                  };\n                  return _n.add({\n                    message: _e2,\n                    query: o\n                  }), void _this._onMessage(_e2);\n                }\n                var c = {\n                  id: a,\n                  addOrUpdate: i,\n                  end: d && 0 === u,\n                  type: \"append\"\n                };\n                _n.add({\n                  message: c,\n                  query: o\n                }), _this._onMessage(c);\n              };\n              h = 0, m = 0;\n            case 4:\n              if (!(!d && m++ < o)) {\n                _context2.next = 19;\n                break;\n              }\n              _o2 = void 0;\n              _loop = /*#__PURE__*/_regeneratorRuntime().mark(function _loop() {\n                var s;\n                return _regeneratorRuntime().wrap(function _loop$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      s = c++;\n                      u++, _o2 = _this._fetchDataTilePage(r, s, _n).then(function (e) {\n                        return e && p(e, s);\n                      }).catch(function (s) {\n                        d = !0, a(s) || (t.getLogger(\"esri.views.2d.layers.features.sources.PagedFeatureSource\").error(new e(\"mapview-query-error\", \"Encountered error when fetching tile\", {\n                          tile: r,\n                          error: s\n                        })), _this._onMessage({\n                          id: r.id,\n                          addOrUpdate: null,\n                          end: d,\n                          type: \"append\"\n                        }));\n                      });\n                    case 2:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }, _loop);\n              });\n              _s = 0;\n            case 8:\n              if (!(_s < h + 1)) {\n                _context2.next = 13;\n                break;\n              }\n              return _context2.delegateYield(_loop(), \"t0\", 10);\n            case 10:\n              _s++;\n              _context2.next = 8;\n              break;\n            case 13:\n              _context2.next = 15;\n              return _o2;\n            case 15:\n              s(_n);\n              h = Math.min(h + 2, i);\n            case 17:\n              _context2.next = 4;\n              break;\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee, this);\n      }));\n      function _fetchDataTile(_x) {\n        return _fetchDataTile2.apply(this, arguments);\n      }\n      return _fetchDataTile;\n    }()\n  }, {\n    key: \"_fetchDataTilePage\",\n    value: function () {\n      var _fetchDataTilePage2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e, t, a) {\n        var o, _n2, d, _r, _i;\n        return _regeneratorRuntime().wrap(function _callee2$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              s(a);\n              o = this._queryInfo, _n2 = {\n                start: this.pageSize * t,\n                num: this.pageSize,\n                returnExceededLimitFeatures: !0,\n                quantizationParameters: e.getQuantizationParameters()\n              };\n              r(this.maxRecordCountFactor) && (_n2.maxRecordCountFactor = this.maxRecordCountFactor);\n              d = this.createTileQuery(e, _n2);\n              _context3.prev = 4;\n              _r = a.signal;\n              _context3.next = 8;\n              return this._queue.push({\n                tile: e,\n                query: d,\n                signal: _r,\n                depth: t\n              });\n            case 8:\n              _i = _context3.sent;\n              return _context3.abrupt(\"return\", (s(a), _i ? o !== this._queryInfo ? this._fetchDataTilePage(e, t, a) : {\n                reader: _i,\n                query: d\n              } : null));\n            case 12:\n              _context3.prev = 12;\n              _context3.t0 = _context3[\"catch\"](4);\n              return _context3.abrupt(\"return\", (i(_context3.t0), null));\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee2, this, [[4, 12]]);\n      }));\n      function _fetchDataTilePage(_x2, _x3, _x4) {\n        return _fetchDataTilePage2.apply(this, arguments);\n      }\n      return _fetchDataTilePage;\n    }()\n  }]);\n  return n;\n}(o);\nexport { n as PagedFeatureSource };","map":{"version":3,"names":["e","t","isSome","r","isAbortError","a","throwIfAborted","s","throwIfNotAbortError","i","BaseFeatureSource","o","n","_o","_inherits","_super","_createSuper","_classCallCheck","call","_createClass","key","value","_fetchDataTile2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this","_n","d","c","u","p","h","m","_o2","_loop","_s","wrap","_callee$","_context2","prev","next","_subscriptions","get","id","reader","query","exceededTransferLimit","hasFeatures","addOrUpdate","end","type","add","message","_onMessage","_loop$","_context","_fetchDataTilePage","then","catch","getLogger","error","tile","stop","delegateYield","Math","min","_fetchDataTile","_x","apply","arguments","_fetchDataTilePage2","_callee2","_n2","_r","_i","_callee2$","_context3","_queryInfo","start","pageSize","num","returnExceededLimitFeatures","quantizationParameters","getQuantizationParameters","maxRecordCountFactor","createTileQuery","signal","_queue","push","depth","sent","abrupt","t0","_x2","_x3","_x4","PagedFeatureSource"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/sources/PagedFeatureSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import t from\"../../../../../core/Logger.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{isAbortError as a,throwIfAborted as s,throwIfNotAbortError as i}from\"../../../../../core/promiseUtils.js\";import{BaseFeatureSource as o}from\"./BaseFeatureSource.js\";class n extends o{constructor(e){super(e)}async _fetchDataTile(r){const i=6,o=20,n=this._subscriptions.get(r.key.id);let d=!1,c=0,u=0;const p=(e,t)=>{u--,s(n);const a=r.id,i=e.reader,o=e.query;if(!i.exceededTransferLimit){if(d=!0,0!==t&&!i.hasFeatures){const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return n.add({message:e,query:o}),void this._onMessage(e)}const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return n.add({message:e,query:o}),void this._onMessage(e)}const c={id:a,addOrUpdate:i,end:d&&0===u,type:\"append\"};n.add({message:c,query:o}),this._onMessage(c)};let h=0,m=0;for(;!d&&m++<o;){let o;for(let s=0;s<h+1;s++){const s=c++;u++,o=this._fetchDataTilePage(r,s,n).then((e=>e&&p(e,s))).catch((s=>{d=!0,a(s)||(t.getLogger(\"esri.views.2d.layers.features.sources.PagedFeatureSource\").error(new e(\"mapview-query-error\",\"Encountered error when fetching tile\",{tile:r,error:s})),this._onMessage({id:r.id,addOrUpdate:null,end:d,type:\"append\"}))}))}await o,s(n),h=Math.min(h+2,i)}}async _fetchDataTilePage(e,t,a){s(a);const o=this._queryInfo,n={start:this.pageSize*t,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};r(this.maxRecordCountFactor)&&(n.maxRecordCountFactor=this.maxRecordCountFactor);const d=this.createTileQuery(e,n);try{const r=a.signal,i=await this._queue.push({tile:e,query:d,signal:r,depth:t});return s(a),i?o!==this._queryInfo?this._fetchDataTilePage(e,t,a):{reader:i,query:d}:null}catch(c){return i(c),null}}}export{n as PagedFeatureSource};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}