{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/CircularArray.js\";\nimport has from \"../../../../../core/has.js\";\nimport { isNone as t, isSome as s, unwrap as r } from \"../../../../../core/maybe.js\";\nimport { FeatureSetReaderJSON as i } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as d } from \"../support/UpdateToken.js\";\nclass a {\n  constructor(t, s) {\n    this.requests = {\n      done: new Array(),\n      stream: new e(10)\n    }, this._edits = null, this._abortController = new AbortController(), this._version = 0, this._done = !1, this.didSend = !1, this.tile = t, this._version = s;\n  }\n  get signal() {\n    return this._abortController.signal;\n  }\n  get options() {\n    return {\n      signal: this._abortController.signal\n    };\n  }\n  get empty() {\n    return !this.requests.done.length && t(this.edits);\n  }\n  get edits() {\n    return this._edits;\n  }\n  get done() {\n    return this._done;\n  }\n  end() {\n    this._done = !0;\n  }\n  clear() {\n    this.requests.done = [];\n  }\n  applyUpdate(e) {\n    this.requests.done.forEach(t => t.message.status.unset(e)), this._version = e.version, s(this._edits) && this._edits.status.unset(e);\n  }\n  add(e) {\n    e.message.status = e.message.status ?? d.empty(), e.message.status.version = this._version, has(\"esri-2d-update-debug\") && console.debug(this.tile.id, \"DataTileSubscription:add\", this._version), e.message.end && this.requests.done.forEach(e => {\n      s(e.message) && e.message.end && (e.message.end = !1);\n    }), this.requests.done.push(e);\n  }\n  edit(e, a) {\n    const o = e.getQuantizationTransform(),\n      n = e.fullSchema(),\n      h = Array.from(e.features()).filter(s),\n      u = [...a, ...h.map(e => e.objectId)];\n    if (this.removeIds(u), this._invalidate(), t(this._edits)) return void (this._edits = {\n      type: \"append\",\n      addOrUpdate: i.fromOptimizedFeatures(h, n, r(o)),\n      id: this.tile.id,\n      status: d.empty(),\n      end: !0\n    });\n    this.requests.done.forEach(e => e.message.end = !1);\n    r(this._edits.addOrUpdate).append(e.features());\n  }\n  *readers() {\n    for (const {\n      message: e\n    } of this.requests.done) s(e.addOrUpdate) && (yield e.addOrUpdate);\n    s(this._edits) && s(this._edits.addOrUpdate) && (yield this._edits.addOrUpdate);\n  }\n  _invalidate() {\n    for (const e of this.requests.done) e.message.status = d.empty();\n    s(this._edits) && (this._edits.status = d.empty());\n  }\n  removeIds(e) {\n    this._invalidate();\n    for (const {\n      message: t\n    } of this.requests.done) {\n      const r = t.addOrUpdate;\n      s(r) && (r.removeIds(e), r.isEmpty && (has(\"esri-2d-update-debug\") && console.debug(\"Removing FeatureSetReader\"), t.addOrUpdate = null));\n    }\n    s(this._edits) && s(this._edits.addOrUpdate) && this._edits.addOrUpdate.removeIds(e), this.requests.done = this.requests.done.filter(e => e.message.addOrUpdate || e.message.end);\n  }\n  abort() {\n    this._abortController.abort();\n  }\n}\nexport { a as DataTileSubscription };","map":{"version":3,"names":["e","has","isNone","t","isSome","s","unwrap","r","FeatureSetReaderJSON","i","UpdateToken","d","a","constructor","requests","done","Array","stream","_edits","_abortController","AbortController","_version","_done","didSend","tile","signal","options","empty","length","edits","end","clear","applyUpdate","forEach","message","status","unset","version","add","console","debug","id","push","edit","o","getQuantizationTransform","n","fullSchema","h","from","features","filter","u","map","objectId","removeIds","_invalidate","type","addOrUpdate","fromOptimizedFeatures","append","readers","isEmpty","abort","DataTileSubscription"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/sources/DataTileSubscription.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/CircularArray.js\";import has from\"../../../../../core/has.js\";import{isNone as t,isSome as s,unwrap as r}from\"../../../../../core/maybe.js\";import{FeatureSetReaderJSON as i}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as d}from\"../support/UpdateToken.js\";class a{constructor(t,s){this.requests={done:new Array,stream:new e(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._done=!1,this.didSend=!1,this.tile=t,this._version=s}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length&&t(this.edits)}get edits(){return this._edits}get done(){return this._done}end(){this._done=!0}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((t=>t.message.status.unset(e))),this._version=e.version,s(this._edits)&&this._edits.status.unset(e)}add(e){e.message.status=e.message.status??d.empty(),e.message.status.version=this._version,has(\"esri-2d-update-debug\")&&console.debug(this.tile.id,\"DataTileSubscription:add\",this._version),e.message.end&&this.requests.done.forEach((e=>{s(e.message)&&e.message.end&&(e.message.end=!1)})),this.requests.done.push(e)}edit(e,a){const o=e.getQuantizationTransform(),n=e.fullSchema(),h=Array.from(e.features()).filter(s),u=[...a,...h.map((e=>e.objectId))];if(this.removeIds(u),this._invalidate(),t(this._edits))return void(this._edits={type:\"append\",addOrUpdate:i.fromOptimizedFeatures(h,n,r(o)),id:this.tile.id,status:d.empty(),end:!0});this.requests.done.forEach((e=>e.message.end=!1));r(this._edits.addOrUpdate).append(e.features())}*readers(){for(const{message:e}of this.requests.done)s(e.addOrUpdate)&&(yield e.addOrUpdate);s(this._edits)&&s(this._edits.addOrUpdate)&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=d.empty();s(this._edits)&&(this._edits.status=d.empty())}removeIds(e){this._invalidate();for(const{message:t}of this.requests.done){const r=t.addOrUpdate;s(r)&&(r.removeIds(e),r.isEmpty&&(has(\"esri-2d-update-debug\")&&console.debug(\"Removing FeatureSetReader\"),t.addOrUpdate=null))}s(this._edits)&&s(this._edits.addOrUpdate)&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter((e=>e.message.addOrUpdate||e.message.end))}abort(){this._abortController.abort()}}export{a as DataTileSubscription};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}