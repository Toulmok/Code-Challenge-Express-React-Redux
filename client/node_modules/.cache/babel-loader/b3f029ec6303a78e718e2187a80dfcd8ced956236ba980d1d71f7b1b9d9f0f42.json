{"ast":null,"code":"/* Copyright 2017 Esri\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n */\n/*eslint-disable */\nimport esriConfig from '@arcgis/core/config';\nimport OAuthInfo from '@arcgis/core/identity/OAuthInfo';\nimport IdentityManager from '@arcgis/core/identity/IdentityManager';\nimport Portal from '@arcgis/core/portal/Portal';\n/* eslint-enable */\n\nimport { APP_ID, APP_PORTAL_URL } from '../constants/app-constants';\nimport { GET_IDENTITY, LOAD_PORTAL, SIGN_IN, SIGN_OUT } from '../constants/action-types';\nesriConfig.portalUrl = APP_PORTAL_URL;\nconst info = new OAuthInfo({\n  appId: APP_ID,\n  popup: false,\n  portalUrl: APP_PORTAL_URL\n});\nconst portal = new Portal({\n  authMode: 'immediate'\n});\nIdentityManager.registerOAuthInfos([info]);\n\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\nconst arcgisMiddleWare = store => next => action => {\n  switch (action.type) {\n    case GET_IDENTITY:\n      next(action);\n      return IdentityManager.checkSignInStatus(`${info.portalUrl}/sharing`).then(() => {\n        store.dispatch({\n          type: LOAD_PORTAL\n        });\n      });\n    case SIGN_IN:\n      IdentityManager.getCredential(`${info.portalUrl}/sharing`);\n      return next(action);\n    case SIGN_OUT:\n      IdentityManager.destroyCredentials();\n      window.location.reload();\n      return next(action);\n    default:\n      return next(action);\n  }\n};\nexport default arcgisMiddleWare;","map":{"version":3,"names":["esriConfig","OAuthInfo","IdentityManager","Portal","APP_ID","APP_PORTAL_URL","GET_IDENTITY","LOAD_PORTAL","SIGN_IN","SIGN_OUT","portalUrl","info","appId","popup","portal","authMode","registerOAuthInfos","arcgisMiddleWare","store","next","action","type","checkSignInStatus","then","dispatch","getCredential","destroyCredentials","window","location","reload"],"sources":["C:/code-challenge-react/frontend/src/middleware/arcgis-authentication.js"],"sourcesContent":["/* Copyright 2017 Esri\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n */\r\n/*eslint-disable */\r\nimport esriConfig from '@arcgis/core/config';\r\nimport OAuthInfo from '@arcgis/core/identity/OAuthInfo';\r\nimport IdentityManager from '@arcgis/core/identity/IdentityManager';\r\nimport Portal from '@arcgis/core/portal/Portal';\r\n/* eslint-enable */\r\n\r\nimport { APP_ID, APP_PORTAL_URL } from '../constants/app-constants'\r\n\r\nimport {\r\n  GET_IDENTITY,\r\n  LOAD_PORTAL,\r\n  SIGN_IN,\r\n  SIGN_OUT,\r\n} from '../constants/action-types'\r\n\r\n\r\nesriConfig.portalUrl = APP_PORTAL_URL;\r\nconst info = new OAuthInfo({ appId: APP_ID, popup: false, portalUrl: APP_PORTAL_URL })\r\nconst portal = new Portal({ authMode: 'immediate' });\r\n\r\nIdentityManager.registerOAuthInfos([info])\r\n\r\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\r\nconst arcgisMiddleWare = store => next => (action) => {\r\n  switch (action.type) {\r\n    case GET_IDENTITY:\r\n      next(action)\r\n      return IdentityManager.checkSignInStatus(`${info.portalUrl}/sharing`)\r\n        .then(() => {\r\n          store.dispatch({ type: LOAD_PORTAL })\r\n        })\r\n\r\n    case SIGN_IN:\r\n      IdentityManager.getCredential(`${info.portalUrl}/sharing`)\r\n      return next(action)\r\n\r\n    case SIGN_OUT:\r\n      IdentityManager.destroyCredentials()\r\n      window.location.reload()\r\n      return next(action)\r\n\r\n    default:\r\n      return next(action)\r\n  }\r\n}\r\n\r\nexport default arcgisMiddleWare"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,UAAU,MAAM,qBAAqB;AAC5C,OAAOC,SAAS,MAAM,iCAAiC;AACvD,OAAOC,eAAe,MAAM,uCAAuC;AACnE,OAAOC,MAAM,MAAM,4BAA4B;AAC/C;;AAEA,SAASC,MAAM,EAAEC,cAAc,QAAQ,4BAA4B;AAEnE,SACEC,YAAY,EACZC,WAAW,EACXC,OAAO,EACPC,QAAQ,QACH,2BAA2B;AAGlCT,UAAU,CAACU,SAAS,GAAGL,cAAc;AACrC,MAAMM,IAAI,GAAG,IAAIV,SAAS,CAAC;EAAEW,KAAK,EAAER,MAAM;EAAES,KAAK,EAAE,KAAK;EAAEH,SAAS,EAAEL;AAAe,CAAC,CAAC;AACtF,MAAMS,MAAM,GAAG,IAAIX,MAAM,CAAC;EAAEY,QAAQ,EAAE;AAAY,CAAC,CAAC;AAEpDb,eAAe,CAACc,kBAAkB,CAAC,CAACL,IAAI,CAAC,CAAC;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMM,gBAAgB,GAAGC,KAAK,IAAIC,IAAI,IAAKC,MAAM,IAAK;EACpD,QAAQA,MAAM,CAACC,IAAI;IACjB,KAAKf,YAAY;MACfa,IAAI,CAACC,MAAM,CAAC;MACZ,OAAOlB,eAAe,CAACoB,iBAAiB,CAAE,GAAEX,IAAI,CAACD,SAAU,UAAS,CAAC,CAClEa,IAAI,CAAC,MAAM;QACVL,KAAK,CAACM,QAAQ,CAAC;UAAEH,IAAI,EAAEd;QAAY,CAAC,CAAC;MACvC,CAAC,CAAC;IAEN,KAAKC,OAAO;MACVN,eAAe,CAACuB,aAAa,CAAE,GAAEd,IAAI,CAACD,SAAU,UAAS,CAAC;MAC1D,OAAOS,IAAI,CAACC,MAAM,CAAC;IAErB,KAAKX,QAAQ;MACXP,eAAe,CAACwB,kBAAkB,EAAE;MACpCC,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE;MACxB,OAAOV,IAAI,CAACC,MAAM,CAAC;IAErB;MACE,OAAOD,IAAI,CAACC,MAAM,CAAC;EAAA;AAEzB,CAAC;AAED,eAAeH,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}