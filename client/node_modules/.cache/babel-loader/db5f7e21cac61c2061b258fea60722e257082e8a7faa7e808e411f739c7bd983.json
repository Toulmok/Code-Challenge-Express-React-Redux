{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../../core/Accessor.js\";\nimport { isSome as r, isNone as a, destroyMaybe as s } from \"../../../../../core/maybe.js\";\nimport { isAborted as n, throwIfAborted as i } from \"../../../../../core/promiseUtils.js\";\nimport { property as o } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport { subclass as c } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c as l } from \"../../../../../chunks/mat4f64.js\";\nimport { b as h, e as d, m as u } from \"../../../../../chunks/vec3.js\";\nimport { c as m } from \"../../../../../chunks/vec3f64.js\";\nimport { c as p, f as _ } from \"../../../../../chunks/vec4f64.js\";\nimport f from \"../../../support/debugFlags.js\";\nimport { glLayout as g } from \"../../../support/buffer/glUtil.js\";\nimport { newLayout as I } from \"../../../support/buffer/InterleavedLayout.js\";\nimport { ShaderOutput as y } from \"../../core/shaderLibrary/ShaderOutput.js\";\nimport { Camera as C } from \"../Camera.js\";\nimport { Default3D as v } from \"../DefaultVertexAttributeLocations.js\";\nimport { IntersectorType as E } from \"../IntersectorInterfaces.js\";\nimport R from \"../Octree.js\";\nimport { RenderSlot as D } from \"../RenderSlot.js\";\nimport { assert as b } from \"../Util.js\";\nimport { VertexAttribute as A } from \"../VertexAttribute.js\";\nimport { InstanceData as T, StateFlags as L } from \"./InstanceData.js\";\nimport { InstanceOctree as O } from \"./InstanceOctree.js\";\nimport { LevelSelector as S } from \"./LevelSelector.js\";\nimport { LodLevel as j } from \"./LodLevel.js\";\nimport { RenderInstanceData as x } from \"./RenderInstanceData.js\";\nimport { colorMixModes as U } from \"../../materials/internal/MaterialUtil.js\";\nimport { encodeDoubleVec3 as N } from \"../../materials/renderers/utils.js\";\nimport { DefaultMaterialDrawParameters as M } from \"../../shaders/DefaultMaterialTechnique.js\";\nimport { TaskPriority as F, noBudget as V } from \"../../../../support/Scheduler.js\";\nimport { bindVertexBufferLayout as w, unbindVertexBufferLayout as B } from \"../../../../webgl/Util.js\";\nconst H = e => {\n  const t = e.baseBoundingSphere.radius,\n    r = e.levels.map(e => e.minScreenSpaceRadius);\n  return new S(t, r);\n};\nlet q = class extends t {\n  constructor(e, t) {\n    super(e), this.type = E.LOD, this.isGround = !1, this._levels = [], this._defaultRenderInstanceData = [], this._highlightRenderInstanceData = [], this._instanceIndex = 0, this._cycleStartIndex = 0, this._slicePlane = !1, this._camera = new C(), this._updateCyclesWithStaticCamera = -1, this._needFullCycle = !1, this.slots = [D.OPAQUE_MATERIAL, D.TRANSPARENT_MATERIAL], this.canRender = !0, this._instanceData = new T({\n      shaderTransformation: e.shaderTransformation\n    }, e.optionalFields), this._frameTask = t.registerTask(F.LOD_RENDERER, this);\n  }\n  initialize() {\n    this._instanceBufferLayout = k(this.optionalFields), this._glInstanceBufferLayout = g(this._instanceBufferLayout, 1), this._instanceData.events.on(\"instances-changed\", () => this._requestUpdateCycle()), this._instanceData.events.on(\"instance-transform-changed\", _ref => {\n      let {\n        index: e\n      } = _ref;\n      this._requestUpdateCycle(), this.metadata.notifyGraphicGeometryChanged(e);\n    }), this._instanceData.events.on(\"instance-visibility-changed\", _ref2 => {\n      let {\n        index: e\n      } = _ref2;\n      this._requestUpdateCycle(!0), this.metadata.notifyGraphicVisibilityChanged(e);\n    }), this._instanceData.events.on(\"instance-highlight-changed\", () => this._requestUpdateCycle(!0));\n  }\n  destroy() {\n    this._frameTask.remove();\n  }\n  get _enableLevelSelection() {\n    return this.symbol.levels.length > 1;\n  }\n  get levels() {\n    return this._levels;\n  }\n  get baseBoundingBox() {\n    return this._levels[this._levels.length - 1].boundingBox;\n  }\n  get baseBoundingSphere() {\n    return this._levels[this._levels.length - 1].boundingSphere;\n  }\n  get baseMaterial() {\n    return this._levels[this._levels.length - 1].components[0].material;\n  }\n  get slicePlaneEnabled() {\n    return this._slicePlane;\n  }\n  set slicePlaneEnabled(e) {\n    this._slicePlane = e;\n  }\n  get layerUid() {\n    return this.metadata.layerUid;\n  }\n  get instanceData() {\n    return this._instanceData;\n  }\n  get memoryUsage() {\n    const e = {\n      cpu: 0,\n      gpu: 0\n    };\n    return this._defaultRenderInstanceData.forEach(t => {\n      const r = t.memoryUsage;\n      e.cpu += r.cpu, e.gpu += r.gpu;\n    }), this._highlightRenderInstanceData.forEach(t => {\n      const r = t.memoryUsage;\n      e.cpu += r.cpu, e.gpu += r.gpu;\n    }), e;\n  }\n  get renderStats() {\n    const e = this._instanceData.size,\n      t = [];\n    return this._levels.forEach((e, r) => {\n      const a = this._defaultRenderInstanceData[r],\n        s = this._highlightRenderInstanceData[r],\n        n = a.size + s.size,\n        i = e.triangleCount;\n      t.push({\n        renderedInstances: n,\n        renderedTriangles: n * i,\n        trianglesPerInstance: i\n      });\n    }), {\n      totalInstances: e,\n      renderedInstances: t.reduce((e, t) => e + t.renderedInstances, 0),\n      renderedTriangles: t.reduce((e, t) => e + t.renderedTriangles, 0),\n      levels: t\n    };\n  }\n  async initializeRenderContext(e, t) {\n    this._context = e;\n    const a = e.renderContext.rctx,\n      s = await Promise.allSettled(this.symbol.levels.map(r => (this._defaultRenderInstanceData.push(new x(a, this._instanceBufferLayout)), this._highlightRenderInstanceData.push(new x(a, this._instanceBufferLayout)), j.create(e, r, t)))),\n      o = s.map(e => \"fulfilled\" === e.status ? e.value : null).filter(r);\n    if (n(t) || o.length !== s.length) {\n      o.forEach(e => e.destroy()), i(t);\n      for (const e of s) if (\"rejected\" === e.status) throw e.reason;\n    }\n    this._levels = o, this._levelSelector = H(this);\n  }\n  uninitializeRenderContext() {\n    this._invalidateOctree(), this._levels.forEach(e => e.destroy()), this._defaultRenderInstanceData.forEach(e => e.destroy()), this._highlightRenderInstanceData.forEach(e => e.destroy());\n  }\n  get needsTransparentPass() {\n    return this._levels.some(e => e.components.some(e => e.material.requiresSlot(D.TRANSPARENT_MATERIAL, y.Color)));\n  }\n  get needsHighlight() {\n    return this._highlightRenderInstanceData.some(e => e.size > 0);\n  }\n  prepareRender(e) {\n    if (!f.LOD_INSTANCE_RENDERER_DISABLE_UPDATES) {\n      if (this._enableLevelSelection) {\n        const t = e.bindParameters.contentCamera.equals(this._camera);\n        this._camera.copyFrom(e.bindParameters.contentCamera), t || this._requestUpdateCycle();\n      }\n      this._needFullCycle && (this.runTask(V), this._needFullCycle = !1);\n    }\n  }\n  render(e) {\n    if (!this.baseMaterial.isVisible() || !this.baseMaterial.isVisibleForOutput(e.output)) return;\n    e.rctx.bindVAO();\n    e.output !== y.Highlight && e.output !== y.ShadowHighlight && this._renderComponents(e, this._defaultRenderInstanceData);\n    e.output !== y.ShadowExcludeHighlight && this._renderComponents(e, this._highlightRenderInstanceData);\n  }\n  intersect(e, t, r, s) {\n    if (!this.baseMaterial.isVisible() || a(this._octree)) return;\n    const n = m();\n    h(n, s, r);\n    const i = a => {\n      this._instanceData.getCombinedModelTransform(a, K), e.transform.set(K), u(Y, r, e.transform.inverse), u(J, s, e.transform.inverse);\n      const n = this._instanceData.getState(a),\n        i = this._instanceData.getLodLevel(a),\n        o = this._levels.length;\n      b(0 != (n & L.ACTIVE), \"invalid instance state\"), b(i >= 0 && i < o, \"invaid lod level\"), this._levels[i].intersect(e, t, Y, J, a, this.metadata, o);\n    };\n    this.baseMaterial.parameters.verticalOffset ? this._octree.forEach(i) : this._octree.forEachAlongRay(r, n, i);\n  }\n  queryDepthRange(e) {\n    return this._queryDepthRangeOctree(e);\n  }\n  notifyShaderTransformationChanged() {\n    this._invalidateOctree(), this._requestUpdateCycle();\n  }\n  get _octree() {\n    if (a(this._octreeCached)) {\n      const e = this._instanceData,\n        t = e.view?.state;\n      if (!t) return null;\n      this._octreeCached = new O(e, this.baseBoundingSphere);\n      for (let r = 0; r < e.capacity; ++r) t.get(r) & L.ACTIVE && this._octreeCached.addInstance(r);\n    }\n    return this._octreeCached;\n  }\n  _invalidateOctree() {\n    this._octreeCached = s(this._octreeCached);\n  }\n  _queryDepthRangeOctree(e) {\n    if (a(this._octree)) return {\n      near: 1 / 0,\n      far: -1 / 0\n    };\n    const t = e.viewForward,\n      r = this._octree.findClosest(t, R.DepthOrder.FRONT_TO_BACK, e.frustum),\n      s = this._octree.findClosest(t, R.DepthOrder.BACK_TO_FRONT, e.frustum);\n    if (null == r || null == s) return {\n      near: 1 / 0,\n      far: -1 / 0\n    };\n    const n = e.eye,\n      i = this._instanceData.view;\n    i.boundingSphere.getVec(r, W), h(W, W, n);\n    const o = d(W, t) - W[3];\n    i.boundingSphere.getVec(s, W), h(W, W, n);\n    const c = d(W, t) + W[3];\n    return {\n      near: Math.max(e.near, o),\n      far: Math.min(e.far, c)\n    };\n  }\n  _requestUpdateCycle() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;\n    this._updateCyclesWithStaticCamera = -1, this._cycleStartIndex = this._instanceIndex, e && (this._needFullCycle = !0, this._context.requestRender());\n  }\n  _startUpdateCycle() {\n    this._updateCyclesWithStaticCamera++, this._defaultRenderInstanceData.forEach(e => e.startUpdateCycle()), this._highlightRenderInstanceData.forEach(e => e.startUpdateCycle());\n  }\n  get running() {\n    return this._instanceData.size > 0 && this._updateCyclesWithStaticCamera < 1;\n  }\n  runTask(e) {\n    const {\n      _enableLevelSelection: t,\n      _camera: a,\n      _levelSelector: s\n    } = this;\n    this._defaultRenderInstanceData.forEach(e => e.beginUpdate()), this._highlightRenderInstanceData.forEach(e => e.beginUpdate());\n    const n = this._instanceData,\n      i = n.view;\n    let o = n.size;\n    const c = n.capacity;\n    let l = this._instanceIndex;\n    for (let h = 0; h < o && !e.done; ++h) {\n      l === this._cycleStartIndex && this._startUpdateCycle();\n      const h = i.state.get(l);\n      let d = 0;\n      if (!(h & L.ALLOCATED)) {\n        l = l + 1 === c ? 0 : l + 1, o++;\n        continue;\n      }\n      const u = i.lodLevel.get(l);\n      if (h & L.DEFAULT_ACTIVE && this._defaultRenderInstanceData[u].freeTail(), h & L.HIGHLIGHT_ACTIVE && this._highlightRenderInstanceData[u].freeTail(), h & L.REMOVE) n.freeInstance(l);else if (h & L.VISIBLE) {\n        let e = 0;\n        t && (i.modelOrigin.getVec(l, z), e = s.selectLevel(z, n.getCombinedMedianScaleFactor(l), a)), d = h & ~(L.ACTIVE | L.TRANSFORM_CHANGED), e >= 0 && (h & L.HIGHLIGHT ? (P(this._highlightRenderInstanceData[e], i, l), d |= L.HIGHLIGHT_ACTIVE) : (P(this._defaultRenderInstanceData[e], i, l), d |= L.DEFAULT_ACTIVE)), i.state.set(l, d), i.lodLevel.set(l, e);\n      } else d = h & ~(L.ACTIVE | L.TRANSFORM_CHANGED), i.state.set(l, d);\n      if (r(this._octreeCached)) {\n        const e = !!(h & L.ACTIVE),\n          t = !!(d & L.ACTIVE);\n        !e && t ? this._octreeCached.addInstance(l) : e && !t ? this._octreeCached.removeInstance(l) : e && t && h & L.TRANSFORM_CHANGED && (this._octreeCached.removeInstance(l), this._octreeCached.addInstance(l));\n      }\n      l = l + 1 === c ? 0 : l + 1, e.madeProgress();\n    }\n    this._instanceIndex = l, this._defaultRenderInstanceData.forEach(e => e.endUpdate()), this._highlightRenderInstanceData.forEach(e => e.endUpdate()), this._context.requestRender();\n  }\n  _renderComponents(e, t) {\n    this.levels.forEach((r, a) => {\n      const s = r.components.map(r => this._beginComponent(e, t[a], r));\n      r.components.forEach((r, n) => this._renderComponent(e, s[n], t[a], r, a));\n    });\n  }\n  _beginComponent(e, t, a) {\n    const {\n      bindParameters: s,\n      rctx: n,\n      output: i\n    } = e;\n    if (0 === t.size || !a.material.requiresSlot(s.slot, e.output)) return null;\n    const o = a.glMaterials.load(n, s.slot, i);\n    return r(o) ? o.beginSlot(s) : null;\n  }\n  _renderComponent(e, t, r, s, n) {\n    if (a(t)) return;\n    const {\n        bindParameters: i,\n        rctx: o\n      } = e,\n      c = o.bindTechnique(t, s.material.parameters, i);\n    o.bindVAO(s.vao), t.ensureAttributeLocations(s.vao), c.bindDraw(Z, i, s.material.parameters), f.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL && e.output === y.Color && (c.setUniform4fv(\"externalColor\", Q[Math.min(n, Q.length - 1)]), c.setUniform1i(\"colorMixMode\", U.replace));\n    const l = o.capabilities.instancing,\n      h = r.capacity,\n      d = r.headIndex,\n      u = r.tailIndex,\n      m = r.firstIndex,\n      p = this._glInstanceBufferLayout,\n      _ = (e, a) => {\n        w(o, v, r.buffer, p, e), l.drawArraysInstanced(t.primitiveType, 0, s.vertexCount, a - e), B(o, v, r.buffer, p);\n      };\n    s.material.parameters.transparent && null != m ? d > u ? (b(m >= u && m <= d, \"invalid firstIndex\"), _(m, d), _(u, m)) : d < u && (m <= d ? (b(m >= 0 && m <= d, \"invalid firstIndex\"), _(m, d), _(u, h), _(0, m)) : (b(m >= u && m <= h, \"invalid firstIndex\"), _(m, h), _(0, d), _(u, m))) : d > u ? _(u, d) : d < u && (_(0, d), _(u, h)), o.bindVAO(null);\n  }\n};\nfunction P(e, t, r) {\n  const a = e.allocateHead();\n  G(t, r, e.view, a);\n}\nfunction G(e, t, r, a) {\n  N(e.modelOrigin, t, r.modelOriginHi, r.modelOriginLo, a), r.model.copyFrom(a, e.model, t), r.modelNormal.copyFrom(a, e.modelNormal, t), e.color && r.color && r.color.copyFrom(a, e.color, t), e.objectAndLayerIdColor && r.objectAndLayerIdColor && r.objectAndLayerIdColor.copyFrom(a, e.objectAndLayerIdColor, t), e.featureAttribute && r.featureAttribute && r.featureAttribute.copyFrom(a, e.featureAttribute, t);\n}\nfunction k(e) {\n  let t = I().vec3f(A.MODELORIGINHI).vec3f(A.MODELORIGINLO).mat3f(A.MODEL).mat3f(A.MODELNORMAL);\n  return r(e) && e.includes(\"color\") && (t = t.vec4f(A.INSTANCECOLOR)), r(e) && e.includes(\"featureAttribute\") && (t = t.vec4f(A.INSTANCEFEATUREATTRIBUTE)), r(e) && e.includes(\"objectAndLayerIdColor\") && (t = t.vec4u8(A.OBJECTANDLAYERIDCOLOR_INSTANCED)), t;\n}\ne([o({\n  constructOnly: !0\n})], q.prototype, \"symbol\", void 0), e([o({\n  constructOnly: !0\n})], q.prototype, \"optionalFields\", void 0), e([o({\n  constructOnly: !0\n})], q.prototype, \"metadata\", void 0), e([o({\n  constructOnly: !0\n})], q.prototype, \"shaderTransformation\", void 0), e([o()], q.prototype, \"_instanceData\", void 0), e([o()], q.prototype, \"_cycleStartIndex\", void 0), e([o({\n  readOnly: !0\n})], q.prototype, \"_enableLevelSelection\", null), e([o()], q.prototype, \"_updateCyclesWithStaticCamera\", void 0), e([o({\n  readOnly: !0\n})], q.prototype, \"running\", null), q = e([c(\"esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer\")], q);\nconst z = m(),\n  W = p(),\n  K = l(),\n  Y = m(),\n  J = m(),\n  Q = [_(1, 0, 1, 1), _(0, 0, 1, 1), _(0, 1, 0, 1), _(1, 1, 0, 1), _(1, 0, 0, 1)],\n  Z = new M();\nexport { q as LodRenderer };","map":{"version":3,"names":["_","e","t","isSome","r","isNone","a","destroyMaybe","s","isAborted","n","throwIfAborted","i","property","o","subclass","c","l","b","h","d","m","u","p","f","glLayout","g","newLayout","I","ShaderOutput","y","Camera","C","Default3D","v","IntersectorType","E","R","RenderSlot","D","assert","VertexAttribute","A","InstanceData","T","StateFlags","L","InstanceOctree","O","LevelSelector","S","LodLevel","j","RenderInstanceData","x","colorMixModes","U","encodeDoubleVec3","N","DefaultMaterialDrawParameters","M","TaskPriority","F","noBudget","V","bindVertexBufferLayout","w","unbindVertexBufferLayout","B","H","baseBoundingSphere","radius","levels","map","minScreenSpaceRadius","q","constructor","type","LOD","isGround","_levels","_defaultRenderInstanceData","_highlightRenderInstanceData","_instanceIndex","_cycleStartIndex","_slicePlane","_camera","_updateCyclesWithStaticCamera","_needFullCycle","slots","OPAQUE_MATERIAL","TRANSPARENT_MATERIAL","canRender","_instanceData","shaderTransformation","optionalFields","_frameTask","registerTask","LOD_RENDERER","initialize","_instanceBufferLayout","k","_glInstanceBufferLayout","events","on","_requestUpdateCycle","_ref","index","metadata","notifyGraphicGeometryChanged","_ref2","notifyGraphicVisibilityChanged","destroy","remove","_enableLevelSelection","symbol","length","baseBoundingBox","boundingBox","boundingSphere","baseMaterial","components","material","slicePlaneEnabled","layerUid","instanceData","memoryUsage","cpu","gpu","forEach","renderStats","size","triangleCount","push","renderedInstances","renderedTriangles","trianglesPerInstance","totalInstances","reduce","initializeRenderContext","_context","renderContext","rctx","Promise","allSettled","create","status","value","filter","reason","_levelSelector","uninitializeRenderContext","_invalidateOctree","needsTransparentPass","some","requiresSlot","Color","needsHighlight","prepareRender","LOD_INSTANCE_RENDERER_DISABLE_UPDATES","bindParameters","contentCamera","equals","copyFrom","runTask","render","isVisible","isVisibleForOutput","output","bindVAO","Highlight","ShadowHighlight","_renderComponents","ShadowExcludeHighlight","intersect","_octree","getCombinedModelTransform","K","transform","set","Y","inverse","J","getState","getLodLevel","ACTIVE","parameters","verticalOffset","forEachAlongRay","queryDepthRange","_queryDepthRangeOctree","notifyShaderTransformationChanged","_octreeCached","view","state","capacity","get","addInstance","near","far","viewForward","findClosest","DepthOrder","FRONT_TO_BACK","frustum","BACK_TO_FRONT","eye","getVec","W","Math","max","min","arguments","undefined","requestRender","_startUpdateCycle","startUpdateCycle","running","beginUpdate","done","ALLOCATED","lodLevel","DEFAULT_ACTIVE","freeTail","HIGHLIGHT_ACTIVE","REMOVE","freeInstance","VISIBLE","modelOrigin","z","selectLevel","getCombinedMedianScaleFactor","TRANSFORM_CHANGED","HIGHLIGHT","P","removeInstance","madeProgress","endUpdate","_beginComponent","_renderComponent","slot","glMaterials","load","beginSlot","bindTechnique","vao","ensureAttributeLocations","bindDraw","Z","LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL","setUniform4fv","Q","setUniform1i","replace","capabilities","instancing","headIndex","tailIndex","firstIndex","buffer","drawArraysInstanced","primitiveType","vertexCount","transparent","allocateHead","G","modelOriginHi","modelOriginLo","model","modelNormal","color","objectAndLayerIdColor","featureAttribute","vec3f","MODELORIGINHI","MODELORIGINLO","mat3f","MODEL","MODELNORMAL","includes","vec4f","INSTANCECOLOR","INSTANCEFEATUREATTRIBUTE","vec4u8","OBJECTANDLAYERIDCOLOR_INSTANCED","constructOnly","prototype","readOnly","LodRenderer"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodRenderer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Accessor.js\";import{isSome as r,isNone as a,destroyMaybe as s}from\"../../../../../core/maybe.js\";import{isAborted as n,throwIfAborted as i}from\"../../../../../core/promiseUtils.js\";import{property as o}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import{subclass as c}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{c as l}from\"../../../../../chunks/mat4f64.js\";import{b as h,e as d,m as u}from\"../../../../../chunks/vec3.js\";import{c as m}from\"../../../../../chunks/vec3f64.js\";import{c as p,f as _}from\"../../../../../chunks/vec4f64.js\";import f from\"../../../support/debugFlags.js\";import{glLayout as g}from\"../../../support/buffer/glUtil.js\";import{newLayout as I}from\"../../../support/buffer/InterleavedLayout.js\";import{ShaderOutput as y}from\"../../core/shaderLibrary/ShaderOutput.js\";import{Camera as C}from\"../Camera.js\";import{Default3D as v}from\"../DefaultVertexAttributeLocations.js\";import{IntersectorType as E}from\"../IntersectorInterfaces.js\";import R from\"../Octree.js\";import{RenderSlot as D}from\"../RenderSlot.js\";import{assert as b}from\"../Util.js\";import{VertexAttribute as A}from\"../VertexAttribute.js\";import{InstanceData as T,StateFlags as L}from\"./InstanceData.js\";import{InstanceOctree as O}from\"./InstanceOctree.js\";import{LevelSelector as S}from\"./LevelSelector.js\";import{LodLevel as j}from\"./LodLevel.js\";import{RenderInstanceData as x}from\"./RenderInstanceData.js\";import{colorMixModes as U}from\"../../materials/internal/MaterialUtil.js\";import{encodeDoubleVec3 as N}from\"../../materials/renderers/utils.js\";import{DefaultMaterialDrawParameters as M}from\"../../shaders/DefaultMaterialTechnique.js\";import{TaskPriority as F,noBudget as V}from\"../../../../support/Scheduler.js\";import{bindVertexBufferLayout as w,unbindVertexBufferLayout as B}from\"../../../../webgl/Util.js\";const H=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new S(t,r)};let q=class extends t{constructor(e,t){super(e),this.type=E.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new C,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[D.OPAQUE_MATERIAL,D.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new T({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=t.registerTask(F.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=k(this.optionalFields),this._glInstanceBufferLayout=g(this._instanceBufferLayout,1),this._instanceData.events.on(\"instances-changed\",(()=>this._requestUpdateCycle())),this._instanceData.events.on(\"instance-transform-changed\",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on(\"instance-visibility-changed\",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on(\"instance-highlight-changed\",(()=>this._requestUpdateCycle(!0)))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),this._highlightRenderInstanceData.forEach((t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const a=this._defaultRenderInstanceData[r],s=this._highlightRenderInstanceData[r],n=a.size+s.size,i=e.triangleCount;t.push({renderedInstances:n,renderedTriangles:n*i,trianglesPerInstance:i})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,t){this._context=e;const a=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map((r=>(this._defaultRenderInstanceData.push(new x(a,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new x(a,this._instanceBufferLayout)),j.create(e,r,t))))),o=s.map((e=>\"fulfilled\"===e.status?e.value:null)).filter(r);if(n(t)||o.length!==s.length){o.forEach((e=>e.destroy())),i(t);for(const e of s)if(\"rejected\"===e.status)throw e.reason}this._levels=o,this._levelSelector=H(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceData.forEach((e=>e.destroy()))}get needsTransparentPass(){return this._levels.some((e=>e.components.some((e=>e.material.requiresSlot(D.TRANSPARENT_MATERIAL,y.Color)))))}get needsHighlight(){return this._highlightRenderInstanceData.some((e=>e.size>0))}prepareRender(e){if(!f.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(V),this._needFullCycle=!1)}}render(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return;e.rctx.bindVAO();e.output!==y.Highlight&&e.output!==y.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData);e.output!==y.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData)}intersect(e,t,r,s){if(!this.baseMaterial.isVisible()||a(this._octree))return;const n=m();h(n,s,r);const i=a=>{this._instanceData.getCombinedModelTransform(a,K),e.transform.set(K),u(Y,r,e.transform.inverse),u(J,s,e.transform.inverse);const n=this._instanceData.getState(a),i=this._instanceData.getLodLevel(a),o=this._levels.length;b(0!=(n&L.ACTIVE),\"invalid instance state\"),b(i>=0&&i<o,\"invaid lod level\"),this._levels[i].intersect(e,t,Y,J,a,this.metadata,o)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(i):this._octree.forEachAlongRay(r,n,i)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(a(this._octreeCached)){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new O(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&L.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=s(this._octreeCached)}_queryDepthRangeOctree(e){if(a(this._octree))return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,R.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(t,R.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==s)return{near:1/0,far:-1/0};const n=e.eye,i=this._instanceData.view;i.boundingSphere.getVec(r,W),h(W,W,n);const o=d(W,t)-W[3];i.boundingSphere.getVec(s,W),h(W,W,n);const c=d(W,t)+W[3];return{near:Math.max(e.near,o),far:Math.min(e.far,c)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((e=>e.startUpdateCycle())),this._highlightRenderInstanceData.forEach((e=>e.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:a,_levelSelector:s}=this;this._defaultRenderInstanceData.forEach((e=>e.beginUpdate())),this._highlightRenderInstanceData.forEach((e=>e.beginUpdate()));const n=this._instanceData,i=n.view;let o=n.size;const c=n.capacity;let l=this._instanceIndex;for(let h=0;h<o&&!e.done;++h){l===this._cycleStartIndex&&this._startUpdateCycle();const h=i.state.get(l);let d=0;if(!(h&L.ALLOCATED)){l=l+1===c?0:l+1,o++;continue}const u=i.lodLevel.get(l);if(h&L.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[u].freeTail(),h&L.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[u].freeTail(),h&L.REMOVE)n.freeInstance(l);else if(h&L.VISIBLE){let e=0;t&&(i.modelOrigin.getVec(l,z),e=s.selectLevel(z,n.getCombinedMedianScaleFactor(l),a)),d=h&~(L.ACTIVE|L.TRANSFORM_CHANGED),e>=0&&(h&L.HIGHLIGHT?(P(this._highlightRenderInstanceData[e],i,l),d|=L.HIGHLIGHT_ACTIVE):(P(this._defaultRenderInstanceData[e],i,l),d|=L.DEFAULT_ACTIVE)),i.state.set(l,d),i.lodLevel.set(l,e)}else d=h&~(L.ACTIVE|L.TRANSFORM_CHANGED),i.state.set(l,d);if(r(this._octreeCached)){const e=!!(h&L.ACTIVE),t=!!(d&L.ACTIVE);!e&&t?this._octreeCached.addInstance(l):e&&!t?this._octreeCached.removeInstance(l):e&&t&&h&L.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===c?0:l+1,e.madeProgress()}this._instanceIndex=l,this._defaultRenderInstanceData.forEach((e=>e.endUpdate())),this._highlightRenderInstanceData.forEach((e=>e.endUpdate())),this._context.requestRender()}_renderComponents(e,t){this.levels.forEach(((r,a)=>{const s=r.components.map((r=>this._beginComponent(e,t[a],r)));r.components.forEach(((r,n)=>this._renderComponent(e,s[n],t[a],r,a)))}))}_beginComponent(e,t,a){const{bindParameters:s,rctx:n,output:i}=e;if(0===t.size||!a.material.requiresSlot(s.slot,e.output))return null;const o=a.glMaterials.load(n,s.slot,i);return r(o)?o.beginSlot(s):null}_renderComponent(e,t,r,s,n){if(a(t))return;const{bindParameters:i,rctx:o}=e,c=o.bindTechnique(t,s.material.parameters,i);o.bindVAO(s.vao),t.ensureAttributeLocations(s.vao),c.bindDraw(Z,i,s.material.parameters),f.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===y.Color&&(c.setUniform4fv(\"externalColor\",Q[Math.min(n,Q.length-1)]),c.setUniform1i(\"colorMixMode\",U.replace));const l=o.capabilities.instancing,h=r.capacity,d=r.headIndex,u=r.tailIndex,m=r.firstIndex,p=this._glInstanceBufferLayout,_=(e,a)=>{w(o,v,r.buffer,p,e),l.drawArraysInstanced(t.primitiveType,0,s.vertexCount,a-e),B(o,v,r.buffer,p)};s.material.parameters.transparent&&null!=m?d>u?(b(m>=u&&m<=d,\"invalid firstIndex\"),_(m,d),_(u,m)):d<u&&(m<=d?(b(m>=0&&m<=d,\"invalid firstIndex\"),_(m,d),_(u,h),_(0,m)):(b(m>=u&&m<=h,\"invalid firstIndex\"),_(m,h),_(0,d),_(u,m))):d>u?_(u,d):d<u&&(_(0,d),_(u,h)),o.bindVAO(null)}};function P(e,t,r){const a=e.allocateHead();G(t,r,e.view,a)}function G(e,t,r,a){N(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,a),r.model.copyFrom(a,e.model,t),r.modelNormal.copyFrom(a,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(a,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(a,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(a,e.featureAttribute,t)}function k(e){let t=I().vec3f(A.MODELORIGINHI).vec3f(A.MODELORIGINLO).mat3f(A.MODEL).mat3f(A.MODELNORMAL);return r(e)&&e.includes(\"color\")&&(t=t.vec4f(A.INSTANCECOLOR)),r(e)&&e.includes(\"featureAttribute\")&&(t=t.vec4f(A.INSTANCEFEATUREATTRIBUTE)),r(e)&&e.includes(\"objectAndLayerIdColor\")&&(t=t.vec4u8(A.OBJECTANDLAYERIDCOLOR_INSTANCED)),t}e([o({constructOnly:!0})],q.prototype,\"symbol\",void 0),e([o({constructOnly:!0})],q.prototype,\"optionalFields\",void 0),e([o({constructOnly:!0})],q.prototype,\"metadata\",void 0),e([o({constructOnly:!0})],q.prototype,\"shaderTransformation\",void 0),e([o()],q.prototype,\"_instanceData\",void 0),e([o()],q.prototype,\"_cycleStartIndex\",void 0),e([o({readOnly:!0})],q.prototype,\"_enableLevelSelection\",null),e([o()],q.prototype,\"_updateCyclesWithStaticCamera\",void 0),e([o({readOnly:!0})],q.prototype,\"running\",null),q=e([c(\"esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer\")],q);const z=m(),W=p(),K=l(),Y=m(),J=m(),Q=[_(1,0,1,1),_(0,0,1,1),_(0,1,0,1),_(1,1,0,1),_(1,0,0,1)],Z=new M;export{q as LodRenderer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}