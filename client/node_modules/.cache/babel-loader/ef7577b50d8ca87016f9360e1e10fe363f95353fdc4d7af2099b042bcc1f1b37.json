{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Error.js\";\nimport e from \"../../../../../core/Logger.js\";\nimport { isNone as i } from \"../../../../../core/maybe.js\";\nimport { create as s } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsXY as r } from \"../../../../../geometry/support/boundsUtils.js\";\nimport { getSpatialQueryOperator as o } from \"../../../../../layers/graphics/data/spatialQuerySupport.js\";\nimport { getTimeOperator as h } from \"../../../../../layers/graphics/data/timeSupport.js\";\nimport { normalizeQueryLike as a } from \"../../../../../layers/graphics/data/utils.js\";\nimport l from \"../../../../../rest/support/Query.js\";\nimport { featureAdapter as n } from \"../FeatureStore2D.js\";\nimport { createWhereClause as d } from \"./whereUtils.js\";\nconst m = 1,\n  _ = 2;\nclass p {\n  constructor(t) {\n    this._geometryBounds = s(), this._idToVisibility = new Map(), this._serviceInfo = t;\n  }\n  get hash() {\n    return this._hash;\n  }\n  check(t) {\n    return this._applyFilter(t);\n  }\n  clear() {\n    const t = this._resetAllHiddenIds();\n    return this.update(), {\n      show: t,\n      hide: []\n    };\n  }\n  invalidate() {\n    this._idToVisibility.forEach((t, e) => {\n      this._idToVisibility.set(e, 0);\n    });\n  }\n  setKnownIds(t) {\n    for (const e of t) this._idToVisibility.set(e, m);\n  }\n  setTrue(t) {\n    const e = [],\n      i = [],\n      s = new Set(t);\n    return this._idToVisibility.forEach((t, r) => {\n      const o = !!(this._idToVisibility.get(r) & m),\n        h = s.has(r);\n      !o && h ? e.push(r) : o && !h && i.push(r), this._idToVisibility.set(r, h ? m | _ : 0);\n    }), {\n      show: e,\n      hide: i\n    };\n  }\n  createQuery() {\n    const {\n      geometry: t,\n      spatialRel: e,\n      where: i,\n      timeExtent: s,\n      objectIds: r\n    } = this;\n    return l.fromJSON({\n      geometry: t,\n      spatialRel: e,\n      where: i,\n      timeExtent: s,\n      objectIds: r\n    });\n  }\n  async update(t, e) {\n    this._hash = JSON.stringify(t);\n    const i = await a(t, null, e);\n    await Promise.all([this._setGeometryFilter(i), this._setIdFilter(i), this._setAttributeFilter(i), this._setTimeFilter(i)]);\n  }\n  async _setAttributeFilter(t) {\n    if (!t || !t.where) return this._clause = null, void (this.where = null);\n    this._clause = await d(t.where, this._serviceInfo.fieldsIndex), this.where = t.where;\n  }\n  _setIdFilter(t) {\n    this._idsToShow = t && t.objectIds && new Set(t.objectIds), this._idsToHide = t && t.hiddenIds && new Set(t.hiddenIds), this.objectIds = t && t.objectIds;\n  }\n  async _setGeometryFilter(t) {\n    if (!t || !t.geometry) return this._spatialQueryOperator = null, this.geometry = null, void (this.spatialRel = null);\n    const e = t.geometry,\n      i = t.spatialRel || \"esriSpatialRelIntersects\",\n      s = await o(i, e, this._serviceInfo.geometryType, this._serviceInfo.hasZ, this._serviceInfo.hasM);\n    r(this._geometryBounds, e), this._spatialQueryOperator = s, this.geometry = e, this.spatialRel = i;\n  }\n  _setTimeFilter(i) {\n    if (this.timeExtent = this._timeOperator = null, i && i.timeExtent) if (this._serviceInfo.timeInfo) this.timeExtent = i.timeExtent, this._timeOperator = h(this._serviceInfo.timeInfo, i.timeExtent, n);else {\n      const s = new t(\"feature-layer-view:time-filter-not-available\", \"Unable to apply time filter, as layer doesn't have time metadata.\", i.timeExtent);\n      e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s);\n    }\n  }\n  _applyFilter(t) {\n    return this._filterByGeometry(t) && this._filterById(t) && this._filterByTime(t) && this._filterByExpression(t);\n  }\n  _filterByExpression(t) {\n    return !this.where || this._clause(t);\n  }\n  _filterById(t) {\n    return (!this._idsToHide || !this._idsToHide.size || !this._idsToHide.has(t.getObjectId())) && (!this._idsToShow || !this._idsToShow.size || this._idsToShow.has(t.getObjectId()));\n  }\n  _filterByGeometry(t) {\n    if (!this.geometry) return !0;\n    const e = t.readHydratedGeometry();\n    return !!e && this._spatialQueryOperator(e);\n  }\n  _filterByTime(t) {\n    return !!i(this._timeOperator) || this._timeOperator(t);\n  }\n  _resetAllHiddenIds() {\n    const t = [];\n    return this._idToVisibility.forEach((e, i) => {\n      e & m || (this._idToVisibility.set(i, m), t.push(i));\n    }), t;\n  }\n}\nexport { p as default };","map":{"version":3,"names":["t","e","isNone","i","create","s","getBoundsXY","r","getSpatialQueryOperator","o","getTimeOperator","h","normalizeQueryLike","a","l","featureAdapter","n","createWhereClause","d","m","_","p","constructor","_geometryBounds","_idToVisibility","Map","_serviceInfo","hash","_hash","check","_applyFilter","clear","_resetAllHiddenIds","update","show","hide","invalidate","forEach","set","setKnownIds","setTrue","Set","get","has","push","createQuery","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","JSON","stringify","Promise","all","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","geometryType","hasZ","hasM","_timeOperator","timeInfo","getLogger","error","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readHydratedGeometry","default"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilter.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{isNone as i}from\"../../../../../core/maybe.js\";import{create as s}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as r}from\"../../../../../geometry/support/boundsUtils.js\";import{getSpatialQueryOperator as o}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as h}from\"../../../../../layers/graphics/data/timeSupport.js\";import{normalizeQueryLike as a}from\"../../../../../layers/graphics/data/utils.js\";import l from\"../../../../../rest/support/Query.js\";import{featureAdapter as n}from\"../FeatureStore2D.js\";import{createWhereClause as d}from\"./whereUtils.js\";const m=1,_=2;class p{constructor(t){this._geometryBounds=s(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,m)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&m),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?m|_:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return l.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await a(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await d(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",s=await o(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r(this._geometryBounds,e),this._spatialQueryOperator=s,this.geometry=e,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i&&i.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=h(this._serviceInfo.timeInfo,i.timeExtent,n);else{const s=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",i.timeExtent);e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return!!i(this._timeOperator)||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{e&m||(this._idToVisibility.set(i,m),t.push(i))})),t}}export{p as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}