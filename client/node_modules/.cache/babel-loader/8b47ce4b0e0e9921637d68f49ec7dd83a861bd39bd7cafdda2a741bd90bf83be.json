{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport { isNone as t, isSome as s } from \"../../../../core/maybe.js\";\nimport { screenPointObjectToArray as o } from \"../../../../core/screenUtils.js\";\nimport { property as i } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { c, n as a, g as p, a as m } from \"../../../../chunks/vec3.js\";\nimport { a as l, c as d } from \"../../../../chunks/vec3f64.js\";\nimport { create as u, copy as h, fromPoints as f } from \"../../../../geometry/support/ray.js\";\nimport { sv2d as y } from \"../../../../geometry/support/vectorStacks.js\";\nimport { getObjectId as g } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nimport { LineOfSightIntersectionResult as I } from \"./LineOfSightIntersectionResult.js\";\nimport { isI3sIntersectorResult as j } from \"../../layers/i3s/Intersector.js\";\nimport { fromScreen as v } from \"../../support/geometryUtils/ray.js\";\nimport { isTerrainIntersectorResult as w } from \"../../terrain/Intersector.js\";\nimport { newIntersector as b } from \"../../webgl-engine/lib/Intersector.js\";\nimport { StoreResults as P, IntersectorType as R } from \"../../webgl-engine/lib/IntersectorInterfaces.js\";\nimport { toGraphic as S } from \"../../webgl-engine/lib/intersectorUtilsConversions.js\";\nlet U = class extends r {\n  constructor(e) {\n    super(e), this._terrainIntersectionOptionsLayerUids = new Set([\"terrain\"]);\n  }\n  initialize() {\n    this.intersector = b(this.view.state.viewingMode), this.intersector.options.hud = !1, this.intersector.options.store = P.MIN;\n  }\n  getScreenPointIntersection(e) {\n    const r = o(e, y.get()),\n      t = v(this.view.state.camera, r, _);\n    return this._getRayIntersection(t);\n  }\n  _getRayIntersection(e, r) {\n    if (t(e) || t(this.view.sceneIntersectionHelper)) return null;\n    this.intersector.options.store = P.MIN, this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e, this.intersector, r);\n    const o = this.intersector.results.min,\n      i = d();\n    if (!o.getIntersectionPoint(i)) return null;\n    const n = this.view.renderCoordsHelper.fromRenderCoords(i, this.view.spatialReference),\n      c = l(o.normal);\n    if (j(o)) return new I({\n      type: R.OBJECT,\n      id: `${o.target.layerUid}/${o.target.nodeIndex}/${o.target.componentIndex}`,\n      mapPoint: n,\n      renderPoint: i,\n      normal: c,\n      ray: h(e),\n      graphic: null\n    });\n    if (w(o)) return new I({\n      type: R.TERRAIN,\n      id: o.target.lij.slice(),\n      mapPoint: n,\n      renderPoint: i,\n      normal: c,\n      ray: h(e),\n      graphic: null\n    });\n    const a = S(o, this.view);\n    if (s(a)) {\n      const r = a.layer,\n        t = a.sourceLayer;\n      let s;\n      if (t) {\n        if (\"scene\" === t.type) s = g(a, t.objectIdField);else s = a.uid;\n      } else s = a.uid;\n      return new I({\n        type: R.OBJECT,\n        id: `${r?.uid}/${s}`,\n        mapPoint: n,\n        renderPoint: i,\n        normal: c,\n        ray: h(e),\n        graphic: a\n      });\n    }\n    return null;\n  }\n  updateFromGroundIntersection(e, r, t) {\n    const o = O,\n      i = C,\n      n = L,\n      d = T;\n    c(i, e), this.view.renderCoordsHelper.worldUpAtPosition(i, n), a(n, n);\n    const u = this.view.basemapTerrain.visibleElevationBounds,\n      h = u ? Math.abs(u.max - u.min) : 100,\n      y = r >= 0 ? 1 : -1;\n    p(d, n, y * (h + Math.abs(r))), m(o, i, d), f(o, i, _);\n    const g = this._getRayIntersection(_, {\n      include: this._terrainIntersectionOptionsLayerUids\n    });\n    return s(g) ? (p(d, n, y * r), m(t, g.renderPoint, d), l(g.normal)) : (c(t, e), null);\n  }\n};\ne([i()], U.prototype, \"view\", void 0), e([i()], U.prototype, \"intersector\", void 0), U = e([n(\"esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector\")], U);\nconst O = d(),\n  C = d(),\n  L = d(),\n  T = d(),\n  _ = u();\nexport { U as LineOfSightRayIntersector };","map":{"version":3,"names":["_","e","r","isNone","t","isSome","s","screenPointObjectToArray","o","property","i","subclass","n","c","a","g","p","m","l","d","create","u","copy","h","fromPoints","f","sv2d","y","getObjectId","LineOfSightIntersectionResult","I","isI3sIntersectorResult","j","fromScreen","v","isTerrainIntersectorResult","w","newIntersector","b","StoreResults","P","IntersectorType","R","toGraphic","S","U","constructor","_terrainIntersectionOptionsLayerUids","Set","initialize","intersector","view","state","viewingMode","options","hud","store","MIN","getScreenPointIntersection","get","camera","_getRayIntersection","sceneIntersectionHelper","intersectToolIntersectorRay","results","min","getIntersectionPoint","renderCoordsHelper","fromRenderCoords","spatialReference","normal","type","OBJECT","id","target","layerUid","nodeIndex","componentIndex","mapPoint","renderPoint","ray","graphic","TERRAIN","lij","slice","layer","sourceLayer","objectIdField","uid","updateFromGroundIntersection","O","C","L","T","worldUpAtPosition","basemapTerrain","visibleElevationBounds","Math","abs","max","include","prototype","LineOfSightRayIntersector"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/analysis/LineOfSight/LineOfSightRayIntersector.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t,isSome as s}from\"../../../../core/maybe.js\";import{screenPointObjectToArray as o}from\"../../../../core/screenUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{c,n as a,g as p,a as m}from\"../../../../chunks/vec3.js\";import{a as l,c as d}from\"../../../../chunks/vec3f64.js\";import{create as u,copy as h,fromPoints as f}from\"../../../../geometry/support/ray.js\";import{sv2d as y}from\"../../../../geometry/support/vectorStacks.js\";import{getObjectId as g}from\"../../../../layers/graphics/dehydratedFeatures.js\";import{LineOfSightIntersectionResult as I}from\"./LineOfSightIntersectionResult.js\";import{isI3sIntersectorResult as j}from\"../../layers/i3s/Intersector.js\";import{fromScreen as v}from\"../../support/geometryUtils/ray.js\";import{isTerrainIntersectorResult as w}from\"../../terrain/Intersector.js\";import{newIntersector as b}from\"../../webgl-engine/lib/Intersector.js\";import{StoreResults as P,IntersectorType as R}from\"../../webgl-engine/lib/IntersectorInterfaces.js\";import{toGraphic as S}from\"../../webgl-engine/lib/intersectorUtilsConversions.js\";let U=class extends r{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set([\"terrain\"])}initialize(){this.intersector=b(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=P.MIN}getScreenPointIntersection(e){const r=o(e,y.get()),t=v(this.view.state.camera,r,_);return this._getRayIntersection(t)}_getRayIntersection(e,r){if(t(e)||t(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=P.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,r);const o=this.intersector.results.min,i=d();if(!o.getIntersectionPoint(i))return null;const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference),c=l(o.normal);if(j(o))return new I({type:R.OBJECT,id:`${o.target.layerUid}/${o.target.nodeIndex}/${o.target.componentIndex}`,mapPoint:n,renderPoint:i,normal:c,ray:h(e),graphic:null});if(w(o))return new I({type:R.TERRAIN,id:o.target.lij.slice(),mapPoint:n,renderPoint:i,normal:c,ray:h(e),graphic:null});const a=S(o,this.view);if(s(a)){const r=a.layer,t=a.sourceLayer;let s;if(t)if(\"scene\"===t.type)s=g(a,t.objectIdField);else s=a.uid;else s=a.uid;return new I({type:R.OBJECT,id:`${r?.uid}/${s}`,mapPoint:n,renderPoint:i,normal:c,ray:h(e),graphic:a})}return null}updateFromGroundIntersection(e,r,t){const o=O,i=C,n=L,d=T;c(i,e),this.view.renderCoordsHelper.worldUpAtPosition(i,n),a(n,n);const u=this.view.basemapTerrain.visibleElevationBounds,h=u?Math.abs(u.max-u.min):100,y=r>=0?1:-1;p(d,n,y*(h+Math.abs(r))),m(o,i,d),f(o,i,_);const g=this._getRayIntersection(_,{include:this._terrainIntersectionOptionsLayerUids});return s(g)?(p(d,n,y*r),m(t,g.renderPoint,d),l(g.normal)):(c(t,e),null)}};e([i()],U.prototype,\"view\",void 0),e([i()],U.prototype,\"intersector\",void 0),U=e([n(\"esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector\")],U);const O=d(),C=d(),L=d(),T=d(),_=u();export{U as LineOfSightRayIntersector};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}