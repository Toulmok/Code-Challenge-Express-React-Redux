{"ast":null,"code":"import Portal from '@arcgis/core/portal/Portal';\nimport { LOAD_PORTAL, SET_IDENTITY, GET_USER_ITEMS, SET_USER_ITEMS } from '../constants/action-types';\nconst portal = new Portal({\n  authMode: 'immediate'\n});\nconst qParamArray = ['title', 'type', 'created', 'tag'];\n\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\nconst arcgisMiddleWare = store => next => action => {\n  switch (action.type) {\n    case LOAD_PORTAL:\n      portal.load().then(() => {\n        store.dispatch({\n          type: SET_IDENTITY,\n          username: portal.user.username,\n          fullname: portal.user.fullName,\n          email: portal.user.email,\n          thumbnailurl: portal.user.thumbnailUrl\n        });\n        store.dispatch({\n          type: GET_USER_ITEMS\n        });\n      });\n    case GET_USER_ITEMS:\n      next(action);\n\n      //Does this sanitize?\n      let myUrlGet = new URL(window.location.href);\n      console.log(myUrlGet.toString());\n      let myUrlHas = new URLSearchParams(myUrlGet.search);\n      let qString = '';\n      if (myUrlHas.has(\"dcreated\")) {\n        let qDCreated = myUrlHas.get(\"dcreated\");\n        console.log(qDCreated);\n      }\n      for (const field of qParamArray) {\n        if (myUrlHas.has(field)) {\n          if (myUrlGet.searchParams.get(field) != '') {\n            qString += ' AND ' + field + ':' + myUrlGet.searchParams.get(field);\n            //console.log(qString)\n          }\n        }\n      }\n\n      if (portal.user != null) {\n        console.log(qString);\n        console.log(portal.user.username);\n        try {\n          return portal.queryItems({\n            query: `owner:${portal.user.username}` + qString,\n            sortField: 'modified',\n            sortOrder: 'desc',\n            num: 15\n          }).then(_ref => {\n            let {\n              results\n            } = _ref;\n            return store.dispatch({\n              type: SET_USER_ITEMS,\n              userItems: results\n            });\n          });\n        } catch {\n          return 0;\n        } finally {\n          return 0;\n        }\n      }\n    default:\n      return next(action);\n  }\n};\nexport default arcgisMiddleWare;\n\n/*\r\npromiseForm = (params:any,qDCreated:any) => {\r\n  let created = new Date(qDCreated)\r\n  let createdUnix = created.getTime().toString()\r\n  if(params.get(\"rcreated\")==\"before\") {\r\n    createdUnix = '[0 TO ' + createdUnix + ']'\r\n  } else if (params.get(\"rcreated\")==\"after\") {\r\n    createdUnix = '[' + createdUnix + ' TO 99999999999999]'\r\n  }\r\n  params.set(\"created\",createdUnix); console.log(createdUnix)\r\n}\r\n\r\nsubmitForm() { console.log(\"form submitted\")\r\n  let myUrl = new URL(window.location.href); console.log(myUrl.toString())\r\n  let params = new URLSearchParams(myUrl.search)\r\n  let qDCreated = params.get(\"dcreated\"); console.log(qDCreated)\r\n\r\n  if (qDCreated) {\r\n    this.promiseForm(params, qDCreated)\r\n  }\r\n  myUrl.search = params.toString()\r\n  const new_url = myUrl.toString(); console.log(new_url)\r\n  window.location.href = new_url\r\n  window.history.replaceState('Object','',myUrl.search)\r\n  window.location.reload()\r\n*/","map":{"version":3,"names":["Portal","LOAD_PORTAL","SET_IDENTITY","GET_USER_ITEMS","SET_USER_ITEMS","portal","authMode","qParamArray","arcgisMiddleWare","store","next","action","type","load","then","dispatch","username","user","fullname","fullName","email","thumbnailurl","thumbnailUrl","myUrlGet","URL","window","location","href","console","log","toString","myUrlHas","URLSearchParams","search","qString","has","qDCreated","get","field","searchParams","queryItems","query","sortField","sortOrder","num","_ref","results","userItems"],"sources":["C:/code-challenge-react/frontend/src/middleware/arcgis-portal.js"],"sourcesContent":["import Portal from '@arcgis/core/portal/Portal'\r\n\r\nimport {\r\n  LOAD_PORTAL,\r\n  SET_IDENTITY,\r\n  GET_USER_ITEMS,\r\n  SET_USER_ITEMS,\r\n} from '../constants/action-types'\r\n\r\nconst portal = new Portal({ authMode: 'immediate' })\r\nconst qParamArray = ['title','type','created','tag']\r\n\r\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\r\nconst arcgisMiddleWare = store => next => (action) => {\r\n  switch (action.type) {\r\n    case LOAD_PORTAL:\r\n      portal.load()\r\n      .then(() => {\r\n        store.dispatch({\r\n          type: SET_IDENTITY,\r\n          username: portal.user.username,\r\n          fullname: portal.user.fullName,\r\n          email: portal.user.email,\r\n          thumbnailurl: portal.user.thumbnailUrl,\r\n        })\r\n        store.dispatch({ type: GET_USER_ITEMS })\r\n      })\r\n\r\n    case GET_USER_ITEMS:\r\n      next(action)\r\n\r\n      //Does this sanitize?\r\n      let myUrlGet = new URL(window.location.href); console.log(myUrlGet.toString())\r\n      let myUrlHas = new URLSearchParams(myUrlGet.search)\r\n      let qString = ''\r\n\r\n      if(myUrlHas.has(\"dcreated\")) {\r\n        let qDCreated = myUrlHas.get(\"dcreated\"); console.log(qDCreated)\r\n      }\r\n\r\n      for (const field of qParamArray) {\r\n        if(myUrlHas.has(field)) {\r\n          if((myUrlGet.searchParams.get(field) != '')){\r\n            qString += ' AND ' + field + ':' + myUrlGet.searchParams.get(field)\r\n            //console.log(qString)\r\n          }\r\n        }\r\n      }\r\n      \r\n      if (portal.user != null) {\r\n        console.log(qString)\r\n        console.log(portal.user.username)\r\n        try { \r\n          return portal.queryItems({\r\n            query: `owner:${portal.user.username}` + qString,\r\n            sortField: 'modified',\r\n            sortOrder: 'desc',\r\n            num: 15,\r\n          })\r\n          .then(({ results }) => store.dispatch({\r\n            type: SET_USER_ITEMS,\r\n            userItems: results,\r\n          }))\r\n        }\r\n        catch { return 0 }\r\n        finally { return 0 }\r\n      }\r\n\r\n    default:\r\n      return next(action)\r\n  }\r\n}\r\n\r\nexport default arcgisMiddleWare\r\n\r\n/*\r\npromiseForm = (params:any,qDCreated:any) => {\r\n  let created = new Date(qDCreated)\r\n  let createdUnix = created.getTime().toString()\r\n  if(params.get(\"rcreated\")==\"before\") {\r\n    createdUnix = '[0 TO ' + createdUnix + ']'\r\n  } else if (params.get(\"rcreated\")==\"after\") {\r\n    createdUnix = '[' + createdUnix + ' TO 99999999999999]'\r\n  }\r\n  params.set(\"created\",createdUnix); console.log(createdUnix)\r\n}\r\n\r\nsubmitForm() { console.log(\"form submitted\")\r\n  let myUrl = new URL(window.location.href); console.log(myUrl.toString())\r\n  let params = new URLSearchParams(myUrl.search)\r\n  let qDCreated = params.get(\"dcreated\"); console.log(qDCreated)\r\n\r\n  if (qDCreated) {\r\n    this.promiseForm(params, qDCreated)\r\n  }\r\n  myUrl.search = params.toString()\r\n  const new_url = myUrl.toString(); console.log(new_url)\r\n  window.location.href = new_url\r\n  window.history.replaceState('Object','',myUrl.search)\r\n  window.location.reload()\r\n*/"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}