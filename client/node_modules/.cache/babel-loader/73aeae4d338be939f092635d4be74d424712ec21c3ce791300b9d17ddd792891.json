{"ast":null,"code":"import _createForOfIteratorHelper from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _regeneratorRuntime from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/code-challenge-react/client/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport t from \"../../../../request.js\";\nimport r from \"../../../../core/Error.js\";\nimport s from \"../../../../core/Logger.js\";\nimport { isSome as o, isNone as i, unwrapOr as n, get as a } from \"../../../../core/maybe.js\";\nimport { createResolver as c } from \"../../../../core/promiseUtils.js\";\nimport { addQueryParameters as u } from \"../../../../core/urlUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport { subclass as d } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { WebSocketConnection as l } from \"./WebSocketConnection.js\";\nimport { executeQuery as f } from \"../../../../rest/query/operations/query.js\";\nimport h from \"../../../../rest/support/Query.js\";\nimport { fromJSON as g } from \"../../../../geometry/support/jsonUtils.js\";\nimport y from \"../../../../geometry/SpatialReference.js\";\nvar m = 1e4,\n  p = {\n    maxQueryDepth: 5,\n    maxRecordCountFactor: 3\n  };\nvar _ = /*#__PURE__*/function (_l) {\n  _inherits(_, _l);\n  var _super = _createSuper(_);\n  function _(e) {\n    var _this;\n    _classCallCheck(this, _);\n    _this = _super.call(this, _objectSpread(_objectSpread({}, p), e)), _this._buddyServicesQuery = null, _this._relatedFeatures = null;\n    return _this;\n  }\n  _createClass(_, [{\n    key: \"_open\",\n    value: function () {\n      var _open2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var e, t, _this$_config, r, o;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return this._fetchServiceDefinition(this._config.source);\n            case 2:\n              e = _context.sent;\n              e.timeInfo.trackIdField || s.getLogger(this.declaredClass).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");\n              t = this._fetchWebSocketUrl(e.streamUrls, this._config.spatialReference);\n              this._buddyServicesQuery || (this._buddyServicesQuery = this._queryBuddyServices());\n              _context.next = 8;\n              return this._buddyServicesQuery;\n            case 8:\n              _context.next = 10;\n              return this._tryCreateWebSocket(t);\n            case 10:\n              _this$_config = this._config, r = _this$_config.filter, o = _this$_config.outFields;\n              this.destroyed || this._setFilter(r, o);\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function _open() {\n        return _open2.apply(this, arguments);\n      }\n      return _open;\n    }()\n  }, {\n    key: \"_onMessage\",\n    value: function _onMessage(e) {\n      if (\"attributes\" in e) {\n        var _i;\n        try {\n          _i = this._enrich(e), o(this._featureZScaler) && this._featureZScaler(_i.geometry);\n        } catch (t) {\n          return void s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Failed to parse message\", t));\n        }\n        this.onFeature(_i);\n      } else this.onMessage(e);\n    }\n  }, {\n    key: \"_fetchServiceDefinition\",\n    value: function () {\n      var _fetchServiceDefinition2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e) {\n        var r, s, o;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              r = _objectSpread({\n                f: \"json\"\n              }, this._config.customParameters);\n              s = t(e.path, {\n                query: r,\n                responseType: \"json\"\n              });\n              _context2.next = 4;\n              return s;\n            case 4:\n              o = _context2.sent.data;\n              return _context2.abrupt(\"return\", (this._serviceDefinition = o, o));\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function _fetchServiceDefinition(_x) {\n        return _fetchServiceDefinition2.apply(this, arguments);\n      }\n      return _fetchServiceDefinition;\n    }()\n  }, {\n    key: \"_fetchWebSocketUrl\",\n    value: function _fetchWebSocketUrl(e, t) {\n      var r = e[0],\n        s = r.urls,\n        o = r.token,\n        i = this._inferWebSocketBaseUrl(s);\n      return u(\"\".concat(i, \"/subscribe\"), {\n        outSR: \"\" + t.wkid,\n        token: o\n      });\n    }\n  }, {\n    key: \"_inferWebSocketBaseUrl\",\n    value: function _inferWebSocketBaseUrl(e) {\n      if (1 === e.length) return e[0];\n      var _iterator = _createForOfIteratorHelper(e),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _t = _step.value;\n          if (_t.includes(\"wss\")) return _t;\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Unable to infer WebSocket url\", e)), null;\n    }\n  }, {\n    key: \"_setFilter\",\n    value: function () {\n      var _setFilter2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e, t) {\n        var _this2 = this;\n        var o, n, a, u, d, l;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              o = this._websocket;\n              if (!(i(o) || i(e) && i(t))) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 3:\n              n = JSON.stringify({\n                filter: this._serializeFilter(e, t)\n              });\n              a = !1;\n              u = c(), d = function d() {\n                a || (_this2.destroyed || _this2._websocket !== o || s.getLogger(_this2.declaredClass).error(new r(\"geoevent-connection\", \"Server timed out when setting filter\")), u.reject());\n              }, l = function l(e) {\n                var t = JSON.parse(e.data);\n                t.filter && (t.error && (s.getLogger(_this2.declaredClass).error(new r(\"geoevent-connection\", \"Failed to set service filter\", t.error)), _this2._set(\"errorString\", \"Could not set service filter - \".concat(t.error)), u.reject(t.error)), _this2._setWebSocketJSONParseHandler(o), a = !0, u.resolve());\n              };\n              return _context3.abrupt(\"return\", (o.onmessage = l, o.send(n), setTimeout(d, m), u.promise));\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function _setFilter(_x2, _x3) {\n        return _setFilter2.apply(this, arguments);\n      }\n      return _setFilter;\n    }()\n  }, {\n    key: \"_serializeFilter\",\n    value: function _serializeFilter(e, t) {\n      var n = {};\n      if (i(e) && i(t)) return n;\n      if (o(e) && e.geometry) try {\n        var _t2 = g(e.geometry);\n        if (\"extent\" !== _t2.type) throw new r(\"Expected extent but found type \".concat(_t2.type));\n        n.geometry = JSON.stringify(_t2.shiftCentralMeridian());\n      } catch (a) {\n        s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Encountered an error when setting connection geometryDefinition\", a));\n      }\n      return o(e) && e.where && \"1 = 1\" !== e.where && \"1=1\" !== e.where && (n.where = e.where), o(t) && (n.outFields = t.join(\",\")), n;\n    }\n  }, {\n    key: \"_enrich\",\n    value: function _enrich(e) {\n      if (!this._relatedFeatures) return e;\n      var t = this._serviceDefinition.relatedFeatures.joinField,\n        o = e.attributes[t],\n        i = this._relatedFeatures.get(o);\n      if (!i) return s.getLogger(this.declaredClass).warn(\"geoevent-connection\", \"Feature join failed. Is the join field configured correctly?\", e), e;\n      var n = i.attributes,\n        a = i.geometry;\n      for (var _r in n) e.attributes[_r] = n[_r];\n      return a && (e.geometry = a), e.geometry || e.centroid || s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Found malformed feature - no geometry found\", e)), e;\n    }\n  }, {\n    key: \"_queryBuddyServices\",\n    value: function () {\n      var _queryBuddyServices2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var _this$_serviceDefinit, _e, _t3, _r2, _s, _o, _iterator2, _step2, _i2;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _this$_serviceDefinit = this._serviceDefinition, _e = _this$_serviceDefinit.relatedFeatures, _t3 = _this$_serviceDefinit.keepLatestArchive, _r2 = this._queryRelatedFeatures(_e), _s = this._queryArchive(_t3);\n              _context4.next = 4;\n              return _r2;\n            case 4:\n              _context4.next = 6;\n              return _s;\n            case 6:\n              _o = _context4.sent;\n              if (_o) {\n                _context4.next = 9;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 9:\n              _iterator2 = _createForOfIteratorHelper(_o.features);\n              try {\n                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                  _i2 = _step2.value;\n                  this.onFeature(this._enrich(_i2));\n                }\n              } catch (err) {\n                _iterator2.e(err);\n              } finally {\n                _iterator2.f();\n              }\n              _context4.next = 16;\n              break;\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](0);\n              s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Encountered an error when querying buddy services\", {\n                error: _context4.t0\n              }));\n            case 16:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 13]]);\n      }));\n      function _queryBuddyServices() {\n        return _queryBuddyServices2.apply(this, arguments);\n      }\n      return _queryBuddyServices;\n    }()\n  }, {\n    key: \"_queryRelatedFeatures\",\n    value: function () {\n      var _queryRelatedFeatures2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (e) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              _context5.next = 4;\n              return this._queryBuddy(e.featuresUrl);\n            case 4:\n              t = _context5.sent;\n              this._addRelatedFeatures(t);\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function _queryRelatedFeatures(_x4) {\n        return _queryRelatedFeatures2.apply(this, arguments);\n      }\n      return _queryRelatedFeatures;\n    }()\n  }, {\n    key: \"_queryArchive\",\n    value: function () {\n      var _queryArchive2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(e) {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!e) {\n                _context6.next = 2;\n                break;\n              }\n              return _context6.abrupt(\"return\", this._queryBuddy(e.featuresUrl));\n            case 2:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function _queryArchive(_x5) {\n        return _queryArchive2.apply(this, arguments);\n      }\n      return _queryArchive;\n    }()\n  }, {\n    key: \"_queryBuddy\",\n    value: function () {\n      var _queryBuddy2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(e) {\n        var t, _yield$t$load, r, s, o, i, c, u, d, l, g;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return import(\"../../../FeatureLayer.js\");\n            case 2:\n              _context7.t0 = _context7.sent.default;\n              _context7.t1 = {\n                url: e\n              };\n              t = new _context7.t0(_context7.t1);\n              _context7.next = 7;\n              return t.load();\n            case 7:\n              _yield$t$load = _context7.sent;\n              r = _yield$t$load.capabilities;\n              s = r.query.supportsMaxRecordCountFactor;\n              o = r.query.supportsPagination;\n              i = r.query.supportsCentroid;\n              c = this._config.maxRecordCountFactor;\n              u = t.capabilities.query.maxRecordCount;\n              d = s ? u * c : u;\n              l = new h();\n              if (!(l.outFields = n(this._config.outFields, [\"*\"]), l.where = n(a(this._config.filter, \"where\"), \"1=1\"), l.returnGeometry = !0, l.returnExceededLimitFeatures = !0, l.outSpatialReference = y.fromJSON(this._config.spatialReference), i && (l.returnCentroid = !0), s && (l.maxRecordCountFactor = c), o)) {\n                _context7.next = 18;\n                break;\n              }\n              return _context7.abrupt(\"return\", (l.num = d, t.destroy(), this._queryPages(e, l)));\n            case 18:\n              _context7.next = 20;\n              return f(e, l, this._config.sourceSpatialReference);\n            case 20:\n              g = _context7.sent;\n              return _context7.abrupt(\"return\", (t.destroy(), g.data));\n            case 22:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function _queryBuddy(_x6) {\n        return _queryBuddy2.apply(this, arguments);\n      }\n      return _queryBuddy;\n    }()\n  }, {\n    key: \"_queryPages\",\n    value: function () {\n      var _queryPages2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e, t) {\n        var _this$_config$maxQuer;\n        var r,\n          s,\n          _yield$f,\n          i,\n          _args8 = arguments;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              r = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : [];\n              s = _args8.length > 3 && _args8[3] !== undefined ? _args8[3] : 0;\n              t.start = o(t.num) ? s * t.num : null;\n              _context8.next = 5;\n              return f(e, t, this._config.sourceSpatialReference);\n            case 5:\n              _yield$f = _context8.sent;\n              i = _yield$f.data;\n              return _context8.abrupt(\"return\", i.exceededTransferLimit && s < ((_this$_config$maxQuer = this._config.maxQueryDepth) !== null && _this$_config$maxQuer !== void 0 ? _this$_config$maxQuer : 0) ? (i.features.forEach(function (e) {\n                return r.push(e);\n              }), this._queryPages(e, t, r, s + 1)) : (r.forEach(function (e) {\n                return i.features.push(e);\n              }), i));\n            case 8:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8, this);\n      }));\n      function _queryPages(_x7, _x8) {\n        return _queryPages2.apply(this, arguments);\n      }\n      return _queryPages;\n    }()\n  }, {\n    key: \"_addRelatedFeatures\",\n    value: function _addRelatedFeatures(e) {\n      var t = new Map(),\n        r = e.features,\n        s = this._serviceDefinition.relatedFeatures.joinField;\n      var _iterator3 = _createForOfIteratorHelper(r),\n        _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var _o2 = _step3.value;\n          var _e2 = _o2.attributes[s];\n          t.set(_e2, _o2);\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n      this._relatedFeatures = t;\n    }\n  }]);\n  return _;\n}(l);\n_ = e([d(\"esri.layers.graphics.sources.connections.GeoEventConnection\")], _);\nvar w = _;\nexport { w as default };","map":{"version":3,"names":["_","e","t","r","s","isSome","o","isNone","i","unwrapOr","n","get","a","createResolver","c","addQueryParameters","u","subclass","d","WebSocketConnection","l","executeQuery","f","h","fromJSON","g","y","m","p","maxQueryDepth","maxRecordCountFactor","_l","_inherits","_super","_createSuper","_this","_classCallCheck","call","_objectSpread","_buddyServicesQuery","_relatedFeatures","_createClass","key","value","_open2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$_config","wrap","_callee$","_context","prev","next","_fetchServiceDefinition","_config","source","sent","timeInfo","trackIdField","getLogger","declaredClass","warn","_fetchWebSocketUrl","streamUrls","spatialReference","_queryBuddyServices","_tryCreateWebSocket","filter","outFields","destroyed","_setFilter","stop","_open","apply","arguments","_onMessage","_enrich","_featureZScaler","geometry","error","onFeature","onMessage","_fetchServiceDefinition2","_callee2","_callee2$","_context2","customParameters","path","query","responseType","data","abrupt","_serviceDefinition","_x","urls","token","_inferWebSocketBaseUrl","concat","outSR","wkid","length","_iterator","_createForOfIteratorHelper","_step","done","includes","err","_setFilter2","_callee3","_this2","_callee3$","_context3","_websocket","JSON","stringify","_serializeFilter","reject","parse","_set","_setWebSocketJSONParseHandler","resolve","onmessage","send","setTimeout","promise","_x2","_x3","type","shiftCentralMeridian","where","join","relatedFeatures","joinField","attributes","centroid","_queryBuddyServices2","_callee4","_this$_serviceDefinit","_e","_t3","_r2","_s","_o","_iterator2","_step2","_i2","_callee4$","_context4","keepLatestArchive","_queryRelatedFeatures","_queryArchive","features","t0","_queryRelatedFeatures2","_callee5","_callee5$","_context5","_queryBuddy","featuresUrl","_addRelatedFeatures","_x4","_queryArchive2","_callee6","_callee6$","_context6","_x5","_queryBuddy2","_callee7","_yield$t$load","_callee7$","_context7","default","t1","url","load","capabilities","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","returnCentroid","num","destroy","_queryPages","sourceSpatialReference","_x6","_queryPages2","_callee8","_this$_config$maxQuer","_yield$f","_args8","_callee8$","_context8","undefined","start","exceededTransferLimit","forEach","push","_x7","_x8","Map","_iterator3","_step3","set","w"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{isSome as o,isNone as i,unwrapOr as n,get as a}from\"../../../../core/maybe.js\";import{createResolver as c}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as u}from\"../../../../core/urlUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as d}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WebSocketConnection as l}from\"./WebSocketConnection.js\";import{executeQuery as f}from\"../../../../rest/query/operations/query.js\";import h from\"../../../../rest/support/Query.js\";import{fromJSON as g}from\"../../../../geometry/support/jsonUtils.js\";import y from\"../../../../geometry/SpatialReference.js\";const m=1e4,p={maxQueryDepth:5,maxRecordCountFactor:3};let _=class extends l{constructor(e){super({...p,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||s.getLogger(this.declaredClass).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){if(\"attributes\"in e){let i;try{i=this._enrich(e),o(this._featureZScaler)&&this._featureZScaler(i.geometry)}catch(t){return void s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Failed to parse message\",t))}this.onFeature(i)}else this.onMessage(e)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},s=t(e.path,{query:r,responseType:\"json\"}),o=(await s).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:s,token:o}=r,i=this._inferWebSocketBaseUrl(s);return u(`${i}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const o=this._websocket;if(i(o)||i(e)&&i(t))return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const u=c(),d=()=>{a||(this.destroyed||this._websocket!==o||s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),u.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),u.reject(t.error)),this._setWebSocketJSONParseHandler(o),a=!0,u.resolve())};return o.onmessage=l,o.send(n),setTimeout(d,m),u.promise}_serializeFilter(e,t){const n={};if(i(e)&&i(t))return n;if(o(e)&&e.geometry)try{const t=g(e.geometry);if(\"extent\"!==t.type)throw new r(`Expected extent but found type ${t.type}`);n.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(a){s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",a))}return o(e)&&e.where&&\"1 = 1\"!==e.where&&\"1=1\"!==e.where&&(n.where=e.where),o(t)&&(n.outFields=t.join(\",\")),n}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t],i=this._relatedFeatures.get(o);if(!i)return s.getLogger(this.declaredClass).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:n,geometry:a}=i;for(const r in n)e.attributes[r]=n[r];return a&&(e.geometry=a),e.geometry||e.centroid||s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),s=this._queryArchive(t);await r;const o=await s;if(!o)return;for(const i of o.features)this.onFeature(this._enrich(i))}catch(e){s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),s=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,i=r.query.supportsCentroid,c=this._config.maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,d=s?u*c:u,l=new h;if(l.outFields=n(this._config.outFields,[\"*\"]),l.where=n(a(this._config.filter,\"where\"),\"1=1\"),l.returnGeometry=!0,l.returnExceededLimitFeatures=!0,l.outSpatialReference=y.fromJSON(this._config.spatialReference),i&&(l.returnCentroid=!0),s&&(l.maxRecordCountFactor=c),o)return l.num=d,t.destroy(),this._queryPages(e,l);const g=await f(e,l,this._config.sourceSpatialReference);return t.destroy(),g.data}async _queryPages(e,t,r=[],s=0){t.start=o(t.num)?s*t.num:null;const{data:i}=await f(e,t,this._config.sourceSpatialReference);return i.exceededTransferLimit&&s<(this._config.maxQueryDepth??0)?(i.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,s+1)):(r.forEach((e=>i.features.push(e))),i)}_addRelatedFeatures(e){const t=new Map,r=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[s];t.set(e,o)}this._relatedFeatures=t}};_=e([d(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],_);const w=_;export{w as default};\n"],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAC,QAAK,iCAAiC;AAAC,OAAM,yBAAyB;AAAC,OAAOC,CAAC,MAAK,wBAAwB;AAAC,OAAOC,CAAC,MAAK,2BAA2B;AAAC,OAAOC,CAAC,MAAK,4BAA4B;AAAC,SAAOC,MAAM,IAAIC,CAAC,EAACC,MAAM,IAAIC,CAAC,EAACC,QAAQ,IAAIC,CAAC,EAACC,GAAG,IAAIC,CAAC,QAAK,2BAA2B;AAAC,SAAOC,cAAc,IAAIC,CAAC,QAAK,kCAAkC;AAAC,SAAOC,kBAAkB,IAAIC,CAAC,QAAK,8BAA8B;AAAC,OAAM,gDAAgD;AAAC,OAAM,gCAAgC;AAAC,OAAM,yBAAyB;AAAC,SAAOC,QAAQ,IAAIC,CAAC,QAAK,yDAAyD;AAAC,SAAOC,mBAAmB,IAAIC,CAAC,QAAK,0BAA0B;AAAC,SAAOC,YAAY,IAAIC,CAAC,QAAK,4CAA4C;AAAC,OAAOC,CAAC,MAAK,mCAAmC;AAAC,SAAOC,QAAQ,IAAIC,CAAC,QAAK,2CAA2C;AAAC,OAAOC,CAAC,MAAK,0CAA0C;AAAC,IAAMC,CAAC,GAAC,GAAG;EAACC,CAAC,GAAC;IAACC,aAAa,EAAC,CAAC;IAACC,oBAAoB,EAAC;EAAC,CAAC;AAAC,IAAI9B,CAAC,0BAAA+B,EAAA;EAAAC,SAAA,CAAAhC,CAAA,EAAA+B,EAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAlC,CAAA;EAAiB,SAAAA,EAAYC,CAAC,EAAC;IAAA,IAAAkC,KAAA;IAAAC,eAAA,OAAApC,CAAA;IAACmC,KAAA,GAAAF,MAAA,CAAAI,IAAA,OAAAC,aAAA,CAAAA,aAAA,KAAUV,CAAC,GAAI3B,CAAC,IAAGkC,KAAA,CAAKI,mBAAmB,GAAC,IAAI,EAACJ,KAAA,CAAKK,gBAAgB,GAAC,IAAI;IAAA,OAAAL,KAAA;EAAA;EAACM,YAAA,CAAAzC,CAAA;IAAA0C,GAAA;IAAAC,KAAA;MAAA,IAAAC,MAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;QAAA,IAAA/C,CAAA,EAAAC,CAAA,EAAA+C,aAAA,EAAA9C,CAAA,EAAAG,CAAA;QAAA,OAAAwC,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAE,IAAA;cAAA,OAA4B,IAAI,CAACC,uBAAuB,CAAC,IAAI,CAACC,OAAO,CAACC,MAAM,CAAC;YAAA;cAAzDxD,CAAC,GAAAmD,QAAA,CAAAM,IAAA;cAAyDzD,CAAC,CAAC0D,QAAQ,CAACC,YAAY,IAAExD,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACC,IAAI,CAAC,iLAAiL,CAAC;cAAO7D,CAAC,GAAC,IAAI,CAAC8D,kBAAkB,CAAC/D,CAAC,CAACgE,UAAU,EAAC,IAAI,CAACT,OAAO,CAACU,gBAAgB,CAAC;cAAC,IAAI,CAAC3B,mBAAmB,KAAG,IAAI,CAACA,mBAAmB,GAAC,IAAI,CAAC4B,mBAAmB,EAAE,CAAC;cAAAf,QAAA,CAAAE,IAAA;cAAA,OAAO,IAAI,CAACf,mBAAmB;YAAA;cAAAa,QAAA,CAAAE,IAAA;cAAA,OAAO,IAAI,CAACc,mBAAmB,CAAClE,CAAC,CAAC;YAAA;cAAA+C,aAAA,GAA6B,IAAI,CAACO,OAAO,EAA3BrD,CAAC,GAAA8C,aAAA,CAARoB,MAAM,EAAa/D,CAAC,GAAA2C,aAAA,CAAXqB,SAAS;cAAiB,IAAI,CAACC,SAAS,IAAE,IAAI,CAACC,UAAU,CAACrE,CAAC,EAACG,CAAC,CAAC;YAAA;YAAA;cAAA,OAAA8C,QAAA,CAAAqB,IAAA;UAAA;QAAA,GAAAzB,OAAA;MAAA,CAAC;MAAA,SAAA0B,MAAA;QAAA,OAAA9B,MAAA,CAAA+B,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAF,KAAA;IAAA;EAAA;IAAAhC,GAAA;IAAAC,KAAA,WAAAkC,WAAW5E,CAAC,EAAC;MAAC,IAAG,YAAY,IAAGA,CAAC,EAAC;QAAC,IAAIO,EAAC;QAAC,IAAG;UAACA,EAAC,GAAC,IAAI,CAACsE,OAAO,CAAC7E,CAAC,CAAC,EAACK,CAAC,CAAC,IAAI,CAACyE,eAAe,CAAC,IAAE,IAAI,CAACA,eAAe,CAACvE,EAAC,CAACwE,QAAQ,CAAC;QAAA,CAAC,QAAM9E,CAAC,EAAC;UAAC,OAAO,KAAKE,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,yBAAyB,EAACD,CAAC,CAAC,CAAC;QAAA;QAAC,IAAI,CAACgF,SAAS,CAAC1E,EAAC,CAAC;MAAA,CAAC,MAAK,IAAI,CAAC2E,SAAS,CAAClF,CAAC,CAAC;IAAA;EAAC;IAAAyC,GAAA;IAAAC,KAAA;MAAA,IAAAyC,wBAAA,GAAAvC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAsC,SAA8BpF,CAAC;QAAA,IAAAE,CAAA,EAAAC,CAAA,EAAAE,CAAA;QAAA,OAAAwC,mBAAA,GAAAI,IAAA,UAAAoC,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAlC,IAAA,GAAAkC,SAAA,CAAAjC,IAAA;YAAA;cAAQnD,CAAC,GAAAmC,aAAA;gBAAEhB,CAAC,EAAC;cAAM,GAAI,IAAI,CAACkC,OAAO,CAACgC,gBAAgB;cAAEpF,CAAC,GAACF,CAAC,CAACD,CAAC,CAACwF,IAAI,EAAC;gBAACC,KAAK,EAACvF,CAAC;gBAACwF,YAAY,EAAC;cAAM,CAAC,CAAC;cAAAJ,SAAA,CAAAjC,IAAA;cAAA,OAAUlD,CAAC;YAAA;cAAVE,CAAC,GAAAiF,SAAA,CAAA7B,IAAA,CAAWkC,IAAI;cAAA,OAAAL,SAAA,CAAAM,MAAA,YAAQ,IAAI,CAACC,kBAAkB,GAACxF,CAAC,EAACA,CAAC;YAAA;YAAA;cAAA,OAAAiF,SAAA,CAAAd,IAAA;UAAA;QAAA,GAAAY,QAAA;MAAA,CAAC;MAAA,SAAA9B,wBAAAwC,EAAA;QAAA,OAAAX,wBAAA,CAAAT,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAArB,uBAAA;IAAA;EAAA;IAAAb,GAAA;IAAAC,KAAA,WAAAqB,mBAAmB/D,CAAC,EAACC,CAAC,EAAC;MAAO,IAAAC,CAAC,GAACF,CAAC,CAAC,CAAC,CAAC;QAAOG,CAAC,GAAUD,CAAC,CAAjB6F,IAAI;QAAS1F,CAAC,GAAEH,CAAC,CAAV8F,KAAK;QAAMzF,CAAC,GAAC,IAAI,CAAC0F,sBAAsB,CAAC9F,CAAC,CAAC;MAAC,OAAOY,CAAC,IAAAmF,MAAA,CAAI3F,CAAC,iBAAa;QAAC4F,KAAK,EAAC,EAAE,GAAClG,CAAC,CAACmG,IAAI;QAACJ,KAAK,EAAC3F;MAAC,CAAC,CAAC;IAAA;EAAC;IAAAoC,GAAA;IAAAC,KAAA,WAAAuD,uBAAuBjG,CAAC,EAAC;MAAC,IAAG,CAAC,KAAGA,CAAC,CAACqG,MAAM,EAAC,OAAOrG,CAAC,CAAC,CAAC,CAAC;MAAC,IAAAsG,SAAA,GAAAC,0BAAA,CAAevG,CAAC;QAAAwG,KAAA;MAAA;QAAhB,KAAAF,SAAA,CAAAnG,CAAA,MAAAqG,KAAA,GAAAF,SAAA,CAAA7F,CAAA,IAAAgG,IAAA,GAAiB;UAAA,IAAPxG,EAAC,GAAAuG,KAAA,CAAA9D,KAAA;UAAM,IAAGzC,EAAC,CAACyG,QAAQ,CAAC,KAAK,CAAC,EAAC,OAAOzG,EAAC;QAAA;MAAC,SAAA0G,GAAA;QAAAL,SAAA,CAAAtG,CAAA,CAAA2G,GAAA;MAAA;QAAAL,SAAA,CAAAjF,CAAA;MAAA;MAAA,OAAOlB,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,+BAA+B,EAACF,CAAC,CAAC,CAAC,EAAC,IAAI;IAAA;EAAC;IAAAyC,GAAA;IAAAC,KAAA;MAAA,IAAAkE,WAAA,GAAAhE,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAA+D,SAAiB7G,CAAC,EAACC,CAAC;QAAA,IAAA6G,MAAA;QAAA,IAAAzG,CAAA,EAAAI,CAAA,EAAAE,CAAA,EAAAI,CAAA,EAAAE,CAAA,EAAAE,CAAA;QAAA,OAAA0B,mBAAA,GAAAI,IAAA,UAAA8D,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAA5D,IAAA,GAAA4D,SAAA,CAAA3D,IAAA;YAAA;cAAQhD,CAAC,GAAC,IAAI,CAAC4G,UAAU;cAAA,MAAI1G,CAAC,CAACF,CAAC,CAAC,IAAEE,CAAC,CAACP,CAAC,CAAC,IAAEO,CAAC,CAACN,CAAC,CAAC;gBAAA+G,SAAA,CAAA3D,IAAA;gBAAA;cAAA;cAAA,OAAA2D,SAAA,CAAApB,MAAA;YAAA;cAAcnF,CAAC,GAACyG,IAAI,CAACC,SAAS,CAAC;gBAAC/C,MAAM,EAAC,IAAI,CAACgD,gBAAgB,CAACpH,CAAC,EAACC,CAAC;cAAC,CAAC,CAAC;cAAKU,CAAC,GAAC,CAAC,CAAC;cAAOI,CAAC,GAACF,CAAC,EAAE,EAACI,CAAC,GAAC,SAAFA,CAACA,CAAA,EAAK;gBAACN,CAAC,KAAGmG,MAAI,CAACxC,SAAS,IAAEwC,MAAI,CAACG,UAAU,KAAG5G,CAAC,IAAEF,CAAC,CAACyD,SAAS,CAACkD,MAAI,CAACjD,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,sCAAsC,CAAC,CAAC,EAACa,CAAC,CAACsG,MAAM,EAAE,CAAC;cAAA,CAAC,EAAClG,CAAC,GAAC,SAAFA,CAACA,CAACnB,CAAC,EAAE;gBAAC,IAAMC,CAAC,GAACiH,IAAI,CAACI,KAAK,CAACtH,CAAC,CAAC2F,IAAI,CAAC;gBAAC1F,CAAC,CAACmE,MAAM,KAAGnE,CAAC,CAAC+E,KAAK,KAAG7E,CAAC,CAACyD,SAAS,CAACkD,MAAI,CAACjD,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,8BAA8B,EAACD,CAAC,CAAC+E,KAAK,CAAC,CAAC,EAAC8B,MAAI,CAACS,IAAI,CAAC,aAAa,oCAAArB,MAAA,CAAmCjG,CAAC,CAAC+E,KAAK,EAAG,EAACjE,CAAC,CAACsG,MAAM,CAACpH,CAAC,CAAC+E,KAAK,CAAC,CAAC,EAAC8B,MAAI,CAACU,6BAA6B,CAACnH,CAAC,CAAC,EAACM,CAAC,GAAC,CAAC,CAAC,EAACI,CAAC,CAAC0G,OAAO,EAAE,CAAC;cAAA,CAAC;cAAA,OAAAT,SAAA,CAAApB,MAAA,YAAQvF,CAAC,CAACqH,SAAS,GAACvG,CAAC,EAACd,CAAC,CAACsH,IAAI,CAAClH,CAAC,CAAC,EAACmH,UAAU,CAAC3G,CAAC,EAACS,CAAC,CAAC,EAACX,CAAC,CAAC8G,OAAO;YAAA;YAAA;cAAA,OAAAb,SAAA,CAAAxC,IAAA;UAAA;QAAA,GAAAqC,QAAA;MAAA,CAAC;MAAA,SAAAtC,WAAAuD,GAAA,EAAAC,GAAA;QAAA,OAAAnB,WAAA,CAAAlC,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAJ,UAAA;IAAA;EAAA;IAAA9B,GAAA;IAAAC,KAAA,WAAA0E,iBAAiBpH,CAAC,EAACC,CAAC,EAAC;MAAC,IAAMQ,CAAC,GAAC,CAAC,CAAC;MAAC,IAAGF,CAAC,CAACP,CAAC,CAAC,IAAEO,CAAC,CAACN,CAAC,CAAC,EAAC,OAAOQ,CAAC;MAAC,IAAGJ,CAAC,CAACL,CAAC,CAAC,IAAEA,CAAC,CAAC+E,QAAQ,EAAC,IAAG;QAAC,IAAM9E,GAAC,GAACuB,CAAC,CAACxB,CAAC,CAAC+E,QAAQ,CAAC;QAAC,IAAG,QAAQ,KAAG9E,GAAC,CAAC+H,IAAI,EAAC,MAAM,IAAI9H,CAAC,mCAAAgG,MAAA,CAAmCjG,GAAC,CAAC+H,IAAI,EAAG;QAACvH,CAAC,CAACsE,QAAQ,GAACmC,IAAI,CAACC,SAAS,CAAClH,GAAC,CAACgI,oBAAoB,EAAE,CAAC;MAAA,CAAC,QAAMtH,CAAC,EAAC;QAACR,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,iEAAiE,EAACS,CAAC,CAAC,CAAC;MAAA;MAAC,OAAON,CAAC,CAACL,CAAC,CAAC,IAAEA,CAAC,CAACkI,KAAK,IAAE,OAAO,KAAGlI,CAAC,CAACkI,KAAK,IAAE,KAAK,KAAGlI,CAAC,CAACkI,KAAK,KAAGzH,CAAC,CAACyH,KAAK,GAAClI,CAAC,CAACkI,KAAK,CAAC,EAAC7H,CAAC,CAACJ,CAAC,CAAC,KAAGQ,CAAC,CAAC4D,SAAS,GAACpE,CAAC,CAACkI,IAAI,CAAC,GAAG,CAAC,CAAC,EAAC1H,CAAC;IAAA;EAAC;IAAAgC,GAAA;IAAAC,KAAA,WAAAmC,QAAQ7E,CAAC,EAAC;MAAC,IAAG,CAAC,IAAI,CAACuC,gBAAgB,EAAC,OAAOvC,CAAC;MAAC,IAAMC,CAAC,GAAC,IAAI,CAAC4F,kBAAkB,CAACuC,eAAe,CAACC,SAAS;QAAChI,CAAC,GAACL,CAAC,CAACsI,UAAU,CAACrI,CAAC,CAAC;QAACM,CAAC,GAAC,IAAI,CAACgC,gBAAgB,CAAC7B,GAAG,CAACL,CAAC,CAAC;MAAC,IAAG,CAACE,CAAC,EAAC,OAAOJ,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACC,IAAI,CAAC,qBAAqB,EAAC,8DAA8D,EAAC9D,CAAC,CAAC,EAACA,CAAC;MAAC,IAAiBS,CAAC,GAAaF,CAAC,CAA1B+H,UAAU;QAAY3H,CAAC,GAAEJ,CAAC,CAAbwE,QAAQ;MAAM,KAAI,IAAM7E,EAAC,IAAIO,CAAC,EAACT,CAAC,CAACsI,UAAU,CAACpI,EAAC,CAAC,GAACO,CAAC,CAACP,EAAC,CAAC;MAAC,OAAOS,CAAC,KAAGX,CAAC,CAAC+E,QAAQ,GAACpE,CAAC,CAAC,EAACX,CAAC,CAAC+E,QAAQ,IAAE/E,CAAC,CAACuI,QAAQ,IAAEpI,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,6CAA6C,EAACF,CAAC,CAAC,CAAC,EAACA,CAAC;IAAA;EAAC;IAAAyC,GAAA;IAAAC,KAAA;MAAA,IAAA8F,oBAAA,GAAA5F,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAA2F,SAAA;QAAA,IAAAC,qBAAA,EAAAC,EAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,UAAA,EAAAC,MAAA,EAAAC,GAAA;QAAA,OAAArG,mBAAA,GAAAI,IAAA,UAAAkG,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAhG,IAAA,GAAAgG,SAAA,CAAA/F,IAAA;YAAA;cAAA+F,SAAA,CAAAhG,IAAA;cAAAsF,qBAAA,GAA6E,IAAI,CAAC7C,kBAAkB,EAA9C7F,EAAC,GAAA0I,qBAAA,CAAjBN,eAAe,EAAqBnI,GAAC,GAAAyI,qBAAA,CAAnBW,iBAAiB,EAA4BnJ,GAAC,GAAC,IAAI,CAACoJ,qBAAqB,CAACtJ,EAAC,CAAC,EAACG,EAAC,GAAC,IAAI,CAACoJ,aAAa,CAACtJ,GAAC,CAAC;cAAAmJ,SAAA,CAAA/F,IAAA;cAAA,OAAOnD,GAAC;YAAA;cAAAkJ,SAAA,CAAA/F,IAAA;cAAA,OAAelD,EAAC;YAAA;cAATE,EAAC,GAAA+I,SAAA,CAAA3F,IAAA;cAAA,IAAapD,EAAC;gBAAA+I,SAAA,CAAA/F,IAAA;gBAAA;cAAA;cAAA,OAAA+F,SAAA,CAAAxD,MAAA;YAAA;cAAAoD,UAAA,GAAAzC,0BAAA,CAAuBlG,EAAC,CAACmJ,QAAQ;cAAA;gBAAzB,KAAAR,UAAA,CAAA7I,CAAA,MAAA8I,MAAA,GAAAD,UAAA,CAAAvI,CAAA,IAAAgG,IAAA,GAA0B;kBAAhBlG,GAAC,GAAA0I,MAAA,CAAAvG,KAAA;kBAAe,IAAI,CAACuC,SAAS,CAAC,IAAI,CAACJ,OAAO,CAACtE,GAAC,CAAC,CAAC;gBAAD;cAAC,SAAAoG,GAAA;gBAAAqC,UAAA,CAAAhJ,CAAA,CAAA2G,GAAA;cAAA;gBAAAqC,UAAA,CAAA3H,CAAA;cAAA;cAAA+H,SAAA,CAAA/F,IAAA;cAAA;YAAA;cAAA+F,SAAA,CAAAhG,IAAA;cAAAgG,SAAA,CAAAK,EAAA,GAAAL,SAAA;cAAUjJ,CAAC,CAACyD,SAAS,CAAC,IAAI,CAACC,aAAa,CAAC,CAACmB,KAAK,CAAC,IAAI9E,CAAC,CAAC,qBAAqB,EAAC,mDAAmD,EAAC;gBAAC8E,KAAK,EAAAoE,SAAA,CAAAK;cAAE,CAAC,CAAC,CAAC;YAAA;YAAA;cAAA,OAAAL,SAAA,CAAA5E,IAAA;UAAA;QAAA,GAAAiE,QAAA;MAAA,CAAE;MAAA,SAAAvE,oBAAA;QAAA,OAAAsE,oBAAA,CAAA9D,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAT,mBAAA;IAAA;EAAA;IAAAzB,GAAA;IAAAC,KAAA;MAAA,IAAAgH,sBAAA,GAAA9G,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAA6G,SAA4B3J,CAAC;QAAA,IAAAC,CAAA;QAAA,OAAA4C,mBAAA,GAAAI,IAAA,UAAA2G,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAzG,IAAA,GAAAyG,SAAA,CAAAxG,IAAA;YAAA;cAAA,IAAMrD,CAAC;gBAAA6J,SAAA,CAAAxG,IAAA;gBAAA;cAAA;cAAA,OAAAwG,SAAA,CAAAjE,MAAA;YAAA;cAAAiE,SAAA,CAAAxG,IAAA;cAAA,OAAsB,IAAI,CAACyG,WAAW,CAAC9J,CAAC,CAAC+J,WAAW,CAAC;YAAA;cAAvC9J,CAAC,GAAA4J,SAAA,CAAApG,IAAA;cAAuC,IAAI,CAACuG,mBAAmB,CAAC/J,CAAC,CAAC;YAAA;YAAA;cAAA,OAAA4J,SAAA,CAAArF,IAAA;UAAA;QAAA,GAAAmF,QAAA;MAAA,CAAC;MAAA,SAAAL,sBAAAW,GAAA;QAAA,OAAAP,sBAAA,CAAAhF,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAA2E,qBAAA;IAAA;EAAA;IAAA7G,GAAA;IAAAC,KAAA;MAAA,IAAAwH,cAAA,GAAAtH,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAqH,SAAoBnK,CAAC;QAAA,OAAA6C,mBAAA,GAAAI,IAAA,UAAAmH,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAjH,IAAA,GAAAiH,SAAA,CAAAhH,IAAA;YAAA;cAAA,KAAKrD,CAAC;gBAAAqK,SAAA,CAAAhH,IAAA;gBAAA;cAAA;cAAA,OAAAgH,SAAA,CAAAzE,MAAA,WAAQ,IAAI,CAACkE,WAAW,CAAC9J,CAAC,CAAC+J,WAAW,CAAC;YAAA;YAAA;cAAA,OAAAM,SAAA,CAAA7F,IAAA;UAAA;QAAA,GAAA2F,QAAA;MAAA,CAAC;MAAA,SAAAZ,cAAAe,GAAA;QAAA,OAAAJ,cAAA,CAAAxF,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAA4E,aAAA;IAAA;EAAA;IAAA9G,GAAA;IAAAC,KAAA;MAAA,IAAA6H,YAAA,GAAA3H,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAA0H,SAAkBxK,CAAC;QAAA,IAAAC,CAAA,EAAAwK,aAAA,EAAAvK,CAAA,EAAAC,CAAA,EAAAE,CAAA,EAAAE,CAAA,EAAAM,CAAA,EAAAE,CAAA,EAAAE,CAAA,EAAAE,CAAA,EAAAK,CAAA;QAAA,OAAAqB,mBAAA,GAAAI,IAAA,UAAAyH,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAvH,IAAA,GAAAuH,SAAA,CAAAtH,IAAA;YAAA;cAAAsH,SAAA,CAAAtH,IAAA;cAAA,OAAqB,MAAM,CAAC,0BAA0B,CAAC;YAAA;cAAAsH,SAAA,CAAAlB,EAAA,GAAAkB,SAAA,CAAAlH,IAAA,CAAEmH,OAAO;cAAAD,SAAA,CAAAE,EAAA,GAAE;gBAACC,GAAG,EAAC9K;cAAC,CAAC;cAAjEC,CAAC,OAAA0K,SAAA,CAAAlB,EAAA,CAAAkB,SAAA,CAAAE,EAAA;cAAAF,SAAA,CAAAtH,IAAA;cAAA,OAAyFpD,CAAC,CAAC8K,IAAI,EAAE;YAAA;cAAAN,aAAA,GAAAE,SAAA,CAAAlH,IAAA;cAAjBvD,CAAC,GAAAuK,aAAA,CAAdO,YAAY;cAAmB7K,CAAC,GAACD,CAAC,CAACuF,KAAK,CAACwF,4BAA4B;cAAC5K,CAAC,GAACH,CAAC,CAACuF,KAAK,CAACyF,kBAAkB;cAAC3K,CAAC,GAACL,CAAC,CAACuF,KAAK,CAAC0F,gBAAgB;cAACtK,CAAC,GAAC,IAAI,CAAC0C,OAAO,CAAC1B,oBAAoB;cAACd,CAAC,GAACd,CAAC,CAAC+K,YAAY,CAACvF,KAAK,CAAC2F,cAAc;cAACnK,CAAC,GAACd,CAAC,GAACY,CAAC,GAACF,CAAC,GAACE,CAAC;cAACI,CAAC,GAAC,IAAIG,CAAC;cAAA,MAAIH,CAAC,CAACkD,SAAS,GAAC5D,CAAC,CAAC,IAAI,CAAC8C,OAAO,CAACc,SAAS,EAAC,CAAC,GAAG,CAAC,CAAC,EAAClD,CAAC,CAAC+G,KAAK,GAACzH,CAAC,CAACE,CAAC,CAAC,IAAI,CAAC4C,OAAO,CAACa,MAAM,EAAC,OAAO,CAAC,EAAC,KAAK,CAAC,EAACjD,CAAC,CAACkK,cAAc,GAAC,CAAC,CAAC,EAAClK,CAAC,CAACmK,2BAA2B,GAAC,CAAC,CAAC,EAACnK,CAAC,CAACoK,mBAAmB,GAAC9J,CAAC,CAACF,QAAQ,CAAC,IAAI,CAACgC,OAAO,CAACU,gBAAgB,CAAC,EAAC1D,CAAC,KAAGY,CAAC,CAACqK,cAAc,GAAC,CAAC,CAAC,CAAC,EAACrL,CAAC,KAAGgB,CAAC,CAACU,oBAAoB,GAAChB,CAAC,CAAC,EAACR,CAAC;gBAAAsK,SAAA,CAAAtH,IAAA;gBAAA;cAAA;cAAA,OAAAsH,SAAA,CAAA/E,MAAA,YAAQzE,CAAC,CAACsK,GAAG,GAACxK,CAAC,EAAChB,CAAC,CAACyL,OAAO,EAAE,EAAC,IAAI,CAACC,WAAW,CAAC3L,CAAC,EAACmB,CAAC,CAAC;YAAA;cAAAwJ,SAAA,CAAAtH,IAAA;cAAA,OAAehC,CAAC,CAACrB,CAAC,EAACmB,CAAC,EAAC,IAAI,CAACoC,OAAO,CAACqI,sBAAsB,CAAC;YAAA;cAAlDpK,CAAC,GAAAmJ,SAAA,CAAAlH,IAAA;cAAA,OAAAkH,SAAA,CAAA/E,MAAA,YAAyD3F,CAAC,CAACyL,OAAO,EAAE,EAAClK,CAAC,CAACmE,IAAI;YAAA;YAAA;cAAA,OAAAgF,SAAA,CAAAnG,IAAA;UAAA;QAAA,GAAAgG,QAAA;MAAA,CAAC;MAAA,SAAAV,YAAA+B,GAAA;QAAA,OAAAtB,YAAA,CAAA7F,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAmF,WAAA;IAAA;EAAA;IAAArH,GAAA;IAAAC,KAAA;MAAA,IAAAoJ,YAAA,GAAAlJ,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAiJ,SAAkB/L,CAAC,EAACC,CAAC;QAAA,IAAA+L,qBAAA;QAAA,IAAA9L,CAAA;UAAAC,CAAA;UAAA8L,QAAA;UAAA1L,CAAA;UAAA2L,MAAA,GAAAvH,SAAA;QAAA,OAAA9B,mBAAA,GAAAI,IAAA,UAAAkJ,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAhJ,IAAA,GAAAgJ,SAAA,CAAA/I,IAAA;YAAA;cAACnD,CAAC,GAAAgM,MAAA,CAAA7F,MAAA,QAAA6F,MAAA,QAAAG,SAAA,GAAAH,MAAA,MAAC,EAAE;cAAC/L,CAAC,GAAA+L,MAAA,CAAA7F,MAAA,QAAA6F,MAAA,QAAAG,SAAA,GAAAH,MAAA,MAAC,CAAC;cAAEjM,CAAC,CAACqM,KAAK,GAACjM,CAAC,CAACJ,CAAC,CAACwL,GAAG,CAAC,GAACtL,CAAC,GAACF,CAAC,CAACwL,GAAG,GAAC,IAAI;cAACW,SAAA,CAAA/I,IAAA;cAAA,OAAoBhC,CAAC,CAACrB,CAAC,EAACC,CAAC,EAAC,IAAI,CAACsD,OAAO,CAACqI,sBAAsB,CAAC;YAAA;cAAAK,QAAA,GAAAG,SAAA,CAAA3I,IAAA;cAAnDlD,CAAC,GAAA0L,QAAA,CAANtG,IAAI;cAAA,OAAAyG,SAAA,CAAAxG,MAAA,WAA4DrF,CAAC,CAACgM,qBAAqB,IAAEpM,CAAC,KAAA6L,qBAAA,GAAE,IAAI,CAACzI,OAAO,CAAC3B,aAAa,cAAAoK,qBAAA,cAAAA,qBAAA,GAAE,CAAC,CAAC,IAAEzL,CAAC,CAACiJ,QAAQ,CAACgD,OAAO,CAAE,UAAAxM,CAAC;gBAAA,OAAEE,CAAC,CAACuM,IAAI,CAACzM,CAAC,CAAC;cAAA,EAAE,EAAC,IAAI,CAAC2L,WAAW,CAAC3L,CAAC,EAACC,CAAC,EAACC,CAAC,EAACC,CAAC,GAAC,CAAC,CAAC,KAAGD,CAAC,CAACsM,OAAO,CAAE,UAAAxM,CAAC;gBAAA,OAAEO,CAAC,CAACiJ,QAAQ,CAACiD,IAAI,CAACzM,CAAC,CAAC;cAAA,EAAE,EAACO,CAAC,CAAC;YAAA;YAAA;cAAA,OAAA6L,SAAA,CAAA5H,IAAA;UAAA;QAAA,GAAAuH,QAAA;MAAA,CAAC;MAAA,SAAAJ,YAAAe,GAAA,EAAAC,GAAA;QAAA,OAAAb,YAAA,CAAApH,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAgH,WAAA;IAAA;EAAA;IAAAlJ,GAAA;IAAAC,KAAA,WAAAsH,oBAAoBhK,CAAC,EAAC;MAAC,IAAMC,CAAC,GAAC,IAAI2M,GAAG;QAAC1M,CAAC,GAACF,CAAC,CAACwJ,QAAQ;QAACrJ,CAAC,GAAC,IAAI,CAAC0F,kBAAkB,CAACuC,eAAe,CAACC,SAAS;MAAC,IAAAwE,UAAA,GAAAtG,0BAAA,CAAerG,CAAC;QAAA4M,MAAA;MAAA;QAAhB,KAAAD,UAAA,CAAA1M,CAAA,MAAA2M,MAAA,GAAAD,UAAA,CAAApM,CAAA,IAAAgG,IAAA,GAAiB;UAAA,IAAPpG,GAAC,GAAAyM,MAAA,CAAApK,KAAA;UAAO,IAAM1C,GAAC,GAACK,GAAC,CAACiI,UAAU,CAACnI,CAAC,CAAC;UAACF,CAAC,CAAC8M,GAAG,CAAC/M,GAAC,EAACK,GAAC,CAAC;QAAA;MAAC,SAAAsG,GAAA;QAAAkG,UAAA,CAAA7M,CAAA,CAAA2G,GAAA;MAAA;QAAAkG,UAAA,CAAAxL,CAAA;MAAA;MAAA,IAAI,CAACkB,gBAAgB,GAACtC,CAAC;IAAA;EAAC;EAAA,OAAAF,CAAA;AAAA,EAAn4JoB,CAAC,CAAm4J;AAACpB,CAAC,GAACC,CAAC,CAAC,CAACiB,CAAC,CAAC,6DAA6D,CAAC,CAAC,EAAClB,CAAC,CAAC;AAAC,IAAMiN,CAAC,GAACjN,CAAC;AAAC,SAAOiN,CAAC,IAAIpC,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}