{"ast":null,"code":"/* Copyright 2017 Esri\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n */ /*eslint-disable */import esriConfig from'@arcgis/core/config';import OAuthInfo from'@arcgis/core/identity/OAuthInfo';import IdentityManager from'@arcgis/core/identity/IdentityManager';/* eslint-enable */import{APP_ID,APP_PORTAL_URL}from'../constants/app-constants';import{GET_IDENTITY,LOAD_PORTAL,SIGN_IN,SIGN_OUT}from'../constants/action-types';esriConfig.portalUrl=APP_PORTAL_URL;var info=new OAuthInfo({appId:APP_ID,popup:false,portalUrl:APP_PORTAL_URL});IdentityManager.registerOAuthInfos([info]);/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */var arcgisMiddleWare=function arcgisMiddleWare(store){return function(next){return function(action){switch(action.type){case GET_IDENTITY:next(action);return IdentityManager.checkSignInStatus(\"\".concat(info.portalUrl,\"/sharing\")).then(function(result){//console.log(result)\nstore.dispatch({type:LOAD_PORTAL});});case SIGN_IN:IdentityManager.getCredential(\"\".concat(info.portalUrl,\"/sharing\"));return next(action);case SIGN_OUT:IdentityManager.destroyCredentials();window.location.reload();return next(action);default:return next(action);}};};};export default arcgisMiddleWare;","map":{"version":3,"names":["esriConfig","OAuthInfo","IdentityManager","APP_ID","APP_PORTAL_URL","GET_IDENTITY","LOAD_PORTAL","SIGN_IN","SIGN_OUT","portalUrl","info","appId","popup","registerOAuthInfos","arcgisMiddleWare","store","next","action","type","checkSignInStatus","concat","then","result","dispatch","getCredential","destroyCredentials","window","location","reload"],"sources":["C:/code-challenge-react/frontend/src/middleware/arcgis-authentication.js"],"sourcesContent":["/* Copyright 2017 Esri\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n */\r\n/*eslint-disable */\r\nimport esriConfig from '@arcgis/core/config';\r\nimport OAuthInfo from '@arcgis/core/identity/OAuthInfo';\r\nimport IdentityManager from '@arcgis/core/identity/IdentityManager';\r\n/* eslint-enable */\r\n\r\nimport { APP_ID, APP_PORTAL_URL } from '../constants/app-constants'\r\n\r\nimport {\r\n  GET_IDENTITY,\r\n  LOAD_PORTAL,\r\n  SIGN_IN,\r\n  SIGN_OUT,\r\n} from '../constants/action-types'\r\n\r\n\r\nesriConfig.portalUrl = APP_PORTAL_URL;\r\nconst info = new OAuthInfo({ appId: APP_ID, popup: false, portalUrl: APP_PORTAL_URL })\r\n\r\nIdentityManager.registerOAuthInfos([info])\r\n\r\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\r\nconst arcgisMiddleWare = store => next => (action) => {\r\n  switch (action.type) {\r\n    case GET_IDENTITY:\r\n      next(action)\r\n      return IdentityManager.checkSignInStatus(`${info.portalUrl}/sharing`)\r\n        .then((result) => { //console.log(result)\r\n          store.dispatch({ type: LOAD_PORTAL })\r\n        })\r\n\r\n    case SIGN_IN:\r\n      IdentityManager.getCredential(`${info.portalUrl}/sharing`)\r\n      return next(action)\r\n\r\n    case SIGN_OUT:\r\n      IdentityManager.destroyCredentials()\r\n      window.location.reload()\r\n      return next(action)\r\n\r\n    default:\r\n      return next(action)\r\n  }\r\n}\r\n\r\nexport default arcgisMiddleWare"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAdA,CAeA,mBACA,MAAO,CAAAA,UAAU,KAAM,qBAAqB,CAC5C,MAAO,CAAAC,SAAS,KAAM,iCAAiC,CACvD,MAAO,CAAAC,eAAe,KAAM,uCAAuC,CACnE,mBAEA,OAASC,MAAM,CAAEC,cAAc,KAAQ,4BAA4B,CAEnE,OACEC,YAAY,CACZC,WAAW,CACXC,OAAO,CACPC,QAAQ,KACH,2BAA2B,CAGlCR,UAAU,CAACS,SAAS,CAAGL,cAAc,CACrC,GAAM,CAAAM,IAAI,CAAG,GAAI,CAAAT,SAAS,CAAC,CAAEU,KAAK,CAAER,MAAM,CAAES,KAAK,CAAE,KAAK,CAAEH,SAAS,CAAEL,cAAe,CAAC,CAAC,CAEtFF,eAAe,CAACW,kBAAkB,CAAC,CAACH,IAAI,CAAC,CAAC,CAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,GAAM,CAAAI,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAGC,KAAK,QAAI,UAAAC,IAAI,QAAI,UAACC,MAAM,CAAK,CACpD,OAAQA,MAAM,CAACC,IAAI,EACjB,IAAK,CAAAb,YAAY,CACfW,IAAI,CAACC,MAAM,CAAC,CACZ,MAAO,CAAAf,eAAe,CAACiB,iBAAiB,IAAAC,MAAA,CAAIV,IAAI,CAACD,SAAS,aAAW,CAClEY,IAAI,CAAC,SAACC,MAAM,CAAK,CAAE;AAClBP,KAAK,CAACQ,QAAQ,CAAC,CAAEL,IAAI,CAAEZ,WAAY,CAAC,CAAC,CACvC,CAAC,CAAC,CAEN,IAAK,CAAAC,OAAO,CACVL,eAAe,CAACsB,aAAa,IAAAJ,MAAA,CAAIV,IAAI,CAACD,SAAS,aAAW,CAC1D,MAAO,CAAAO,IAAI,CAACC,MAAM,CAAC,CAErB,IAAK,CAAAT,QAAQ,CACXN,eAAe,CAACuB,kBAAkB,EAAE,CACpCC,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE,CACxB,MAAO,CAAAZ,IAAI,CAACC,MAAM,CAAC,CAErB,QACE,MAAO,CAAAD,IAAI,CAACC,MAAM,CAAC,EAEzB,CAAC,KAED,cAAe,CAAAH,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}