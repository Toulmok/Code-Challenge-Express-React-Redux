{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t } from \"../../../../../core/maybe.js\";\nimport { NestedMap as r } from \"../../../../../core/NestedMap.js\";\nimport { ShaderTechniqueConfiguration as s } from \"./ShaderTechniqueConfiguration.js\";\nclass n {\n  constructor(e) {\n    this._context = e, this._perConstructorInstances = new r(), this._frameCounter = 0, this._keepAliveFrameCount = c;\n  }\n  get viewingMode() {\n    return this._context.viewingMode;\n  }\n  get constructionContext() {\n    return this._context;\n  }\n  destroy() {\n    this._perConstructorInstances.forEach(e => e.forEach(e => e.technique.destroy())), this._perConstructorInstances.clear();\n  }\n  acquire(t) {\n    let r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : i;\n    const s = r.key;\n    let n = this._perConstructorInstances.get(t, s);\n    if (e(n)) {\n      const e = new t(this._context, r, () => this.release(e));\n      n = new o(e), this._perConstructorInstances.set(t, s, n);\n    }\n    return ++n.refCount, n.technique;\n  }\n  releaseAndAcquire(e, r, s) {\n    if (t(s)) {\n      if (r.key === s.key) return s;\n      this.release(s);\n    }\n    return this.acquire(e, r);\n  }\n  release(t) {\n    if (e(t) || this._perConstructorInstances.empty) return;\n    const r = this._perConstructorInstances.get(t.constructor, t.key);\n    e(r) || (--r.refCount, 0 === r.refCount && (r.refZeroFrame = this._frameCounter));\n  }\n  frameUpdate() {\n    this._frameCounter++, this._keepAliveFrameCount !== c && this._perConstructorInstances.forEach((e, t) => {\n      e.forEach((e, r) => {\n        0 === e.refCount && e.refZeroFrame + this._keepAliveFrameCount < this._frameCounter && (e.technique.destroy(), this._perConstructorInstances.delete(t, r));\n      });\n    });\n  }\n  async reloadAll() {\n    const e = new Array();\n    this._perConstructorInstances.forEach((t, r) => {\n      const s = async (e, t) => {\n        const r = t.shader;\n        r && (await r.reload(), e.forEach(e => e.technique.reload(this._context)));\n      };\n      e.push(s(t, r));\n    }), await Promise.all(e);\n  }\n}\nclass o {\n  constructor(e) {\n    this.technique = e, this.refCount = 0, this.refZeroFrame = 0;\n  }\n}\nconst c = -1,\n  i = new s();\nexport { n as ShaderTechniqueRepository };","map":{"version":3,"names":["isNone","e","isSome","t","NestedMap","r","ShaderTechniqueConfiguration","s","n","constructor","_context","_perConstructorInstances","_frameCounter","_keepAliveFrameCount","c","viewingMode","constructionContext","destroy","forEach","technique","clear","acquire","arguments","length","undefined","i","key","get","release","o","set","refCount","releaseAndAcquire","empty","refZeroFrame","frameUpdate","delete","reloadAll","Array","shader","reload","push","Promise","all","ShaderTechniqueRepository"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t}from\"../../../../../core/maybe.js\";import{NestedMap as r}from\"../../../../../core/NestedMap.js\";import{ShaderTechniqueConfiguration as s}from\"./ShaderTechniqueConfiguration.js\";class n{constructor(e){this._context=e,this._perConstructorInstances=new r,this._frameCounter=0,this._keepAliveFrameCount=c}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(t,r=i){const s=r.key;let n=this._perConstructorInstances.get(t,s);if(e(n)){const e=new t(this._context,r,(()=>this.release(e)));n=new o(e),this._perConstructorInstances.set(t,s,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,s){if(t(s)){if(r.key===s.key)return s;this.release(s)}return this.acquire(e,r)}release(t){if(e(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);e(r)||(--r.refCount,0===r.refCount&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==c&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{const s=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))};e.push(s(t,r))})),await Promise.all(e)}}class o{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const c=-1,i=new s;export{n as ShaderTechniqueRepository};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}