{"ast":null,"code":"import{default as storeState}from'../store/store';import{GET_IDENTITY,LOAD_PORTAL,SIGN_OUT}from'../constants/action-types';/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */var arcgisMiddleWare=function arcgisMiddleWare(store){return function(next){return function(action){switch(action.type){case GET_IDENTITY:next(action);fetch('/refresh').then(function(res){return res.json();})//.json is asynch; .parse is sync\n.then(function(jsonRes){//console.log(jsonRes)\nif(jsonRes.refresh){store.dispatch({type:LOAD_PORTAL});}});case SIGN_OUT:next(action);storeState.getState().user.username='';window.location.replace('/signOut');default:return next(action);}};};};export default arcgisMiddleWare;","map":{"version":3,"names":["default","storeState","GET_IDENTITY","LOAD_PORTAL","SIGN_OUT","arcgisMiddleWare","store","next","action","type","fetch","then","res","json","jsonRes","refresh","dispatch","getState","user","username","window","location","replace"],"sources":["C:/code-challenge-react/client/src/middleware/arcgis-authentication.js"],"sourcesContent":["import { default as storeState } from '../store/store'\r\nimport {\r\n  GET_IDENTITY,\r\n  LOAD_PORTAL,\r\n  SIGN_OUT,\r\n} from '../constants/action-types'\r\n\r\n/**\r\n * Middleware function with the signature\r\n *\r\n * storeInstance =>\r\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\r\n * actionThatDispatchWasCalledWith =>\r\n * valueToUseAsTheReturnValueOfTheDispatchCall\r\n *\r\n * Typically written as\r\n *\r\n * store => next => action => result\r\n */\r\nconst arcgisMiddleWare = store => next => (action) => {\r\n  switch (action.type) {\r\n    case GET_IDENTITY:\r\n        next(action)\r\n        fetch('/refresh')\r\n        .then(res => res.json()) //.json is asynch; .parse is sync\r\n        .then(jsonRes => { //console.log(jsonRes)\r\n            if(jsonRes.refresh){ store.dispatch({ type: LOAD_PORTAL })}\r\n        })\r\n    \r\n    case SIGN_OUT:\r\n      next(action)\r\n      storeState.getState().user.username = ''\r\n      window.location.replace('/signOut')\r\n\r\n    default:\r\n      return next(action)\r\n  }\r\n}\r\n\r\nexport default arcgisMiddleWare"],"mappings":"AAAA,OAASA,OAAO,GAAI,CAAAC,UAAU,KAAQ,gBAAgB,CACtD,OACEC,YAAY,CACZC,WAAW,CACXC,QAAQ,KACH,2BAA2B,CAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,GAAM,CAAAC,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAGC,KAAK,QAAI,UAAAC,IAAI,QAAI,UAACC,MAAM,CAAK,CACpD,OAAQA,MAAM,CAACC,IAAI,EACjB,IAAK,CAAAP,YAAY,CACbK,IAAI,CAACC,MAAM,CAAC,CACZE,KAAK,CAAC,UAAU,CAAC,CAChBC,IAAI,CAAC,SAAAC,GAAG,QAAI,CAAAA,GAAG,CAACC,IAAI,EAAE,GAAE;AAAA,CACxBF,IAAI,CAAC,SAAAG,OAAO,CAAI,CAAE;AACf,GAAGA,OAAO,CAACC,OAAO,CAAC,CAAET,KAAK,CAACU,QAAQ,CAAC,CAAEP,IAAI,CAAEN,WAAY,CAAC,CAAC,EAC9D,CAAC,CAAC,CAEN,IAAK,CAAAC,QAAQ,CACXG,IAAI,CAACC,MAAM,CAAC,CACZP,UAAU,CAACgB,QAAQ,EAAE,CAACC,IAAI,CAACC,QAAQ,CAAG,EAAE,CACxCC,MAAM,CAACC,QAAQ,CAACC,OAAO,CAAC,UAAU,CAAC,CAErC,QACE,MAAO,CAAAf,IAAI,CAACC,MAAM,CAAC,EAEzB,CAAC,KAED,cAAe,CAAAH,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}