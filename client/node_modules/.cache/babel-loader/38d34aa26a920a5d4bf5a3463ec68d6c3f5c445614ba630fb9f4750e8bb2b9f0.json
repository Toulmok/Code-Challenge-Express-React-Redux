{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { equals as t } from \"../../../../../core/arrayUtils.js\";\nimport { AsyncSequence as i } from \"../../../../../core/AsyncSequence.js\";\nimport { createTask as s } from \"../../../../../core/asyncUtils.js\";\nimport { HandleOwner as r } from \"../../../../../core/HandleOwner.js\";\nimport { makeHandle as o } from \"../../../../../core/handleUtils.js\";\nimport n from \"../../../../../core/Logger.js\";\nimport { isSome as a, isNone as l, unwrap as u } from \"../../../../../core/maybe.js\";\nimport { throwIfAbortError as c } from \"../../../../../core/promiseUtils.js\";\nimport { sync as d } from \"../../../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport f from \"../../../../../geometry/Extent.js\";\nimport { toExtent as y } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { unquantizeOptimizedFeatureSet as g, convertFromFeatureSet as m } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { isHostedAgolService as _ } from \"../../../../../layers/support/arcgisLayerUrl.js\";\nimport { OptimizedFeatureSetParserContext as b } from \"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport { executeQueryForExtent as F, executeQueryPBF as T, executeQuery as P } from \"../../../../../rest/query/operations/query.js\";\nimport I from \"../../../../../rest/support/Query.js\";\nimport { StateType as v, PendingFeatureTile as O } from \"./PendingFeatureTile.js\";\nlet C = class extends r {\n  get _minimumVerticesPerFeature() {\n    switch (this.store?.featureStore.geometryType) {\n      case \"esriGeometryPoint\":\n      case \"esriGeometryMultipoint\":\n        return 1;\n      case \"esriGeometryPolygon\":\n        return 4;\n      case \"esriGeometryPolyline\":\n        return 2;\n    }\n  }\n  set filter(e) {\n    const t = this._get(\"filter\"),\n      i = this._filterProperties(e);\n    JSON.stringify(t) !== JSON.stringify(i) && this._set(\"filter\", i);\n  }\n  set customParameters(e) {\n    const t = this._get(\"customParameters\");\n    JSON.stringify(t) !== JSON.stringify(e) && this._set(\"customParameters\", e);\n  }\n  get _configuration() {\n    return {\n      filter: this.filter,\n      customParameters: this.customParameters,\n      tileInfo: this.tileInfo,\n      tileSize: this.tileSize\n    };\n  }\n  set tileInfo(e) {\n    const t = this._get(\"tileInfo\");\n    t !== e && (a(e) && a(t) && JSON.stringify(e) === JSON.stringify(t) || (this._set(\"tileInfo\", e), this.store.tileInfo = e));\n  }\n  set tileSize(e) {\n    this._get(\"tileSize\") !== e && this._set(\"tileSize\", e);\n  }\n  get updating() {\n    return this.updatingExcludingEdits || this._pendingEdits.updating;\n  }\n  get updatingExcludingEdits() {\n    return this.updatingHandles.updating;\n  }\n  get hasZ() {\n    return this.store.featureStore.hasZ;\n  }\n  constructor(e) {\n    super(e), this.tilesOfInterest = [], this.availability = 0, this._pendingTiles = new Map(), this._pendingEdits = new i(), this._pendingEditsAbortController = new AbortController();\n  }\n  initialize() {\n    this._initializeFetchExtent(), this.updatingHandles.add(() => this._configuration, () => this.refresh()), this.updatingHandles.add(() => this.tilesOfInterest, (e, i) => {\n      t(e, i, (_ref, _ref2) => {\n        let {\n          id: e\n        } = _ref;\n        let {\n          id: t\n        } = _ref2;\n        return e === t;\n      }) || this._process();\n    }, d);\n  }\n  destroy() {\n    this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._pendingTiles.clear(), this.store.destroy(), this.tilesOfInterest.length = 0, this._pendingEditsAbortController.abort(), this._pendingEditsAbortController = null;\n  }\n  refresh() {\n    this.store.refresh(), this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._process();\n  }\n  applyEdits(e) {\n    this._pendingEdits.push(e, async e => {\n      if (0 === e.addedFeatures.length && 0 === e.updatedFeatures.length && 0 === e.deletedFeatures.length) return;\n      for (const [, i] of this._pendingTiles) i.reset();\n      const t = {\n        ...e,\n        deletedFeatures: e.deletedFeatures.map(_ref3 => {\n          let {\n            objectId: e,\n            globalId: t\n          } = _ref3;\n          return e && -1 !== e ? e : this._lookupObjectIdByGlobalId(t);\n        })\n      };\n      await this.updatingHandles.addPromise(this.store.processEdits(t, (e, t) => this._queryFeaturesById(e, t), this._pendingEditsAbortController.signal)), this._processPendingTiles();\n    });\n  }\n  _initializeFetchExtent() {\n    if (!this.capabilities.query.supportsExtent || !_(this.url)) return;\n    const e = s(async e => {\n      try {\n        const t = await F(this.url, new I({\n          where: \"1=1\",\n          outSpatialReference: this.spatialReference,\n          cacheHint: !!this.capabilities.query.supportsCacheHint || void 0\n        }), {\n          query: this._configuration.customParameters,\n          signal: e\n        });\n        this.store.extent = f.fromJSON(t.data?.extent);\n      } catch (t) {\n        c(t), n.getLogger(this.declaredClass).warn(\"Failed to fetch data extent\", t);\n      }\n    });\n    this.updatingHandles.addPromise(e.promise.then(() => this._process())), this.handles.add(o(() => e.abort()));\n  }\n  get debugInfo() {\n    return {\n      numberOfFeatures: this.store.featureStore.numFeatures,\n      tilesOfInterest: this.tilesOfInterest,\n      pendingTiles: Array.from(this._pendingTiles.values()).map(e => e.debugInfo),\n      storedTiles: this.store.debugInfo\n    };\n  }\n  _process() {\n    this._markTilesNotAlive(), this._createPendingTiles(), this._deletePendingTiles(), this._processPendingTiles();\n  }\n  _markTilesNotAlive() {\n    for (const [, e] of this._pendingTiles) e.alive = !1;\n  }\n  _createPendingTiles() {\n    const e = this._collectMissingTilesInfo();\n    if (this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea), !l(e)) for (const {\n      data: t,\n      resolution: i\n    } of e.missingTiles) {\n      const e = this._pendingTiles.get(t.id);\n      e ? (e.resolution = i, e.alive = !0) : this._createPendingTile(t, i);\n    }\n  }\n  _collectMissingTilesInfo() {\n    let e = null;\n    for (let t = this.tilesOfInterest.length - 1; t >= 0; t--) {\n      const i = this.tilesOfInterest[t],\n        s = this.store.process(i, (e, t) => this._verifyTileComplexity(e, t));\n      l(e) ? e = s : e.prepend(s);\n    }\n    return e;\n  }\n  _deletePendingTiles() {\n    for (const [, e] of this._pendingTiles) e.alive || this._deletePendingTile(e);\n  }\n  _processPendingTiles() {\n    const e = {\n      fetchCount: (e, t) => this._fetchCount(e, t),\n      fetchFeatures: (e, t, i) => this._fetchFeatures(e, t, i),\n      finish: (e, t) => this._finishPendingTile(e, t),\n      resume: () => this._processPendingTiles()\n    };\n    if (this._ensureFetchAllCounts(e)) for (const [, t] of this._pendingTiles) this._verifyTileComplexity(this.store.getFeatureCount(t.data), t.resolution) && this.updatingHandles.addPromise(t.process(e));\n  }\n  _verifyTileComplexity(e, t) {\n    return this._verifyVertexComplexity(e) && this._verifyFeatureDensity(e, t);\n  }\n  _verifyVertexComplexity(e) {\n    return e * this._minimumVerticesPerFeature < x;\n  }\n  _verifyFeatureDensity(e, t) {\n    if (l(this.tileInfo)) return !1;\n    const i = this.tileSize * t;\n    return e * (j / (i * i)) < w;\n  }\n  _ensureFetchAllCounts(e) {\n    let t = !0;\n    for (const [, i] of this._pendingTiles) i.state.type < v.FETCHED_COUNT && this.updatingHandles.addPromise(i.process(e)), i.state.type <= v.FETCH_COUNT && (t = !1);\n    return t;\n  }\n  _finishPendingTile(e, t) {\n    this.store.add(e.data, t), this._deletePendingTile(e), this._updateAvailability();\n  }\n  _updateAvailability() {\n    const e = this._collectMissingTilesInfo();\n    this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea);\n  }\n  _setAvailability(e) {\n    this._set(\"availability\", e);\n  }\n  _createPendingTile(e, t) {\n    const i = new O(e, t);\n    return this._pendingTiles.set(e.id, i), i;\n  }\n  _deletePendingTile(e) {\n    e.reset(), this._pendingTiles.delete(e.data.id);\n  }\n  async _fetchCount(e, t) {\n    return this.store.fetchCount(e.data, this.url, this._createCountQuery(e), {\n      query: this.customParameters,\n      timeout: S,\n      signal: t\n    });\n  }\n  async _fetchFeatures(e, t, i) {\n    let s = 0;\n    const r = [];\n    let o = 0,\n      n = t;\n    for (;;) {\n      const a = this._createFeaturesQuery(e),\n        l = this._setPagingParameters(a, s, n),\n        {\n          features: c,\n          exceededTransferLimit: d\n        } = await this._queryFeatures(a, i);\n      l && (s += u(a.num)), o += c.length;\n      for (const e of c) r.push(e);\n      if (n = t - o, !l || !d || n <= 0) return r;\n    }\n  }\n  _filterProperties(e) {\n    return l(e) ? {\n      where: \"1=1\",\n      gdbVersion: void 0,\n      timeExtent: void 0\n    } : {\n      where: e.where || \"1=1\",\n      timeExtent: e.timeExtent,\n      gdbVersion: e.gdbVersion\n    };\n  }\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.globalIdField,\n      i = this.objectIdField;\n    if (l(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let s = null;\n    if (this.store.featureStore.forEach(r => {\n      e === r.attributes[t] && (s = r.objectId ?? r.attributes[i]);\n    }), l(s)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return s;\n  }\n  _queryFeaturesById(e, t) {\n    const i = this._createFeaturesQuery();\n    return i.objectIds = e, this._queryFeatures(i, t);\n  }\n  _queryFeatures(e, t) {\n    return this.capabilities.query.supportsFormatPBF ? this._queryFeaturesPBF(e, t) : this._queryFeaturesJSON(e, t);\n  }\n  async _queryFeaturesPBF(e, t) {\n    const {\n        sourceSpatialReference: i\n      } = this,\n      {\n        data: s\n      } = await T(this.url, e, new b({\n        sourceSpatialReference: i\n      }), {\n        query: this._configuration.customParameters,\n        timeout: S,\n        signal: t\n      });\n    return g(s);\n  }\n  async _queryFeaturesJSON(e, t) {\n    const {\n        sourceSpatialReference: i\n      } = this,\n      {\n        data: s\n      } = await P(this.url, e, i, {\n        query: this._configuration.customParameters,\n        timeout: S,\n        signal: t\n      });\n    return m(s, this.objectIdField);\n  }\n  _createCountQuery(e) {\n    const t = this._createBaseQuery(e);\n    return this.capabilities.query.supportsCacheHint && (t.cacheHint = !0), t;\n  }\n  _createFeaturesQuery() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    const t = this._createBaseQuery(e);\n    return t.outFields = this.globalIdField ? [this.globalIdField, this.objectIdField] : [this.objectIdField], t.returnGeometry = !0, a(e) && (this.capabilities.query.supportsResultType ? t.resultType = \"tile\" : this.capabilities.query.supportsCacheHint && (t.cacheHint = !0)), t;\n  }\n  _createBaseQuery(e) {\n    const t = new I({\n        returnZ: this.hasZ,\n        returnM: !1,\n        geometry: a(this.tileInfo) && a(e) ? y(e.data.extent, this.tileInfo.spatialReference) : void 0\n      }),\n      i = this._configuration.filter;\n    return a(i) && (t.where = i.where, t.gdbVersion = i.gdbVersion, t.timeExtent = i.timeExtent), t.outSpatialReference = this.spatialReference, t;\n  }\n  _setPagingParameters(e, t, i) {\n    if (!this.capabilities.query.supportsPagination) return !1;\n    const {\n        supportsMaxRecordCountFactor: s,\n        supportsCacheHint: r,\n        tileMaxRecordCount: o,\n        maxRecordCount: n,\n        supportsResultType: a\n      } = this.capabilities.query,\n      l = s ? I.MAX_MAX_RECORD_COUNT_FACTOR : 1,\n      u = l * ((a || r) && o ? o : n || E);\n    return e.start = t, s ? (e.maxRecordCountFactor = Math.min(l, Math.ceil(i / u)), e.num = Math.min(i, e.maxRecordCountFactor * u)) : e.num = Math.min(i, u), !0;\n  }\n};\ne([h({\n  constructOnly: !0\n})], C.prototype, \"url\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"objectIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"globalIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"capabilities\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"sourceSpatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"spatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"store\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"_minimumVerticesPerFeature\", null), e([h()], C.prototype, \"filter\", null), e([h()], C.prototype, \"customParameters\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"_configuration\", null), e([h()], C.prototype, \"tileInfo\", null), e([h()], C.prototype, \"tileSize\", null), e([h()], C.prototype, \"tilesOfInterest\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"updating\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"updatingExcludingEdits\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"availability\", void 0), e([h()], C.prototype, \"hasZ\", null), C = e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")], C);\nconst E = 2e3,\n  S = 6e5,\n  x = 1e6,\n  j = 25,\n  w = 1;\nexport { C as FeatureServiceTiledFetcher };","map":{"version":3,"names":["_","e","equals","t","AsyncSequence","i","createTask","s","HandleOwner","r","makeHandle","o","n","isSome","a","isNone","l","unwrap","u","throwIfAbortError","c","sync","d","property","h","subclass","p","f","toExtent","y","unquantizeOptimizedFeatureSet","g","convertFromFeatureSet","m","isHostedAgolService","OptimizedFeatureSetParserContext","b","executeQueryForExtent","F","executeQueryPBF","T","executeQuery","P","I","StateType","v","PendingFeatureTile","O","C","_minimumVerticesPerFeature","store","featureStore","geometryType","filter","_get","_filterProperties","JSON","stringify","_set","customParameters","_configuration","tileInfo","tileSize","updating","updatingExcludingEdits","_pendingEdits","updatingHandles","hasZ","constructor","tilesOfInterest","availability","_pendingTiles","Map","_pendingEditsAbortController","AbortController","initialize","_initializeFetchExtent","add","refresh","_ref","_ref2","id","_process","destroy","forEach","_deletePendingTile","clear","length","abort","applyEdits","push","addedFeatures","updatedFeatures","deletedFeatures","reset","map","_ref3","objectId","globalId","_lookupObjectIdByGlobalId","addPromise","processEdits","_queryFeaturesById","signal","_processPendingTiles","capabilities","query","supportsExtent","url","where","outSpatialReference","spatialReference","cacheHint","supportsCacheHint","extent","fromJSON","data","getLogger","declaredClass","warn","promise","then","handles","debugInfo","numberOfFeatures","numFeatures","pendingTiles","Array","from","values","storedTiles","_markTilesNotAlive","_createPendingTiles","_deletePendingTiles","alive","_collectMissingTilesInfo","_setAvailability","coveredArea","fullArea","resolution","missingTiles","get","_createPendingTile","process","_verifyTileComplexity","prepend","fetchCount","_fetchCount","fetchFeatures","_fetchFeatures","finish","_finishPendingTile","resume","_ensureFetchAllCounts","getFeatureCount","_verifyVertexComplexity","_verifyFeatureDensity","x","j","w","state","type","FETCHED_COUNT","FETCH_COUNT","_updateAvailability","set","delete","_createCountQuery","timeout","S","_createFeaturesQuery","_setPagingParameters","features","exceededTransferLimit","_queryFeatures","num","gdbVersion","timeExtent","globalIdField","objectIdField","Error","attributes","objectIds","supportsFormatPBF","_queryFeaturesPBF","_queryFeaturesJSON","sourceSpatialReference","_createBaseQuery","arguments","undefined","outFields","returnGeometry","supportsResultType","resultType","returnZ","returnM","geometry","supportsPagination","supportsMaxRecordCountFactor","tileMaxRecordCount","maxRecordCount","MAX_MAX_RECORD_COUNT_FACTOR","E","start","maxRecordCountFactor","Math","min","ceil","constructOnly","prototype","readOnly","FeatureServiceTiledFetcher"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiledFetcher.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{equals as t}from\"../../../../../core/arrayUtils.js\";import{AsyncSequence as i}from\"../../../../../core/AsyncSequence.js\";import{createTask as s}from\"../../../../../core/asyncUtils.js\";import{HandleOwner as r}from\"../../../../../core/HandleOwner.js\";import{makeHandle as o}from\"../../../../../core/handleUtils.js\";import n from\"../../../../../core/Logger.js\";import{isSome as a,isNone as l,unwrap as u}from\"../../../../../core/maybe.js\";import{throwIfAbortError as c}from\"../../../../../core/promiseUtils.js\";import{sync as d}from\"../../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../../../geometry/Extent.js\";import{toExtent as y}from\"../../../../../geometry/support/aaBoundingRect.js\";import{unquantizeOptimizedFeatureSet as g,convertFromFeatureSet as m}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{isHostedAgolService as _}from\"../../../../../layers/support/arcgisLayerUrl.js\";import{OptimizedFeatureSetParserContext as b}from\"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import{executeQueryForExtent as F,executeQueryPBF as T,executeQuery as P}from\"../../../../../rest/query/operations/query.js\";import I from\"../../../../../rest/support/Query.js\";import{StateType as v,PendingFeatureTile as O}from\"./PendingFeatureTile.js\";let C=class extends r{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case\"esriGeometryPoint\":case\"esriGeometryMultipoint\":return 1;case\"esriGeometryPolygon\":return 4;case\"esriGeometryPolyline\":return 2}}set filter(e){const t=this._get(\"filter\"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set(\"filter\",i)}set customParameters(e){const t=this._get(\"customParameters\");JSON.stringify(t)!==JSON.stringify(e)&&this._set(\"customParameters\",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get(\"tileInfo\");t!==e&&(a(e)&&a(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set(\"tileInfo\",e),this.store.tileInfo=e))}set tileSize(e){this._get(\"tileSize\")!==e&&this._set(\"tileSize\",e)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this.updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._pendingEdits=new i,this._pendingEditsAbortController=new AbortController}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((e,i)=>{t(e,i,(({id:e},{id:t})=>e===t))||this._process()}),d)}destroy(){this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null}refresh(){this.store.refresh(),this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}applyEdits(e){this._pendingEdits.push(e,(async e=>{if(0===e.addedFeatures.length&&0===e.updatedFeatures.length&&0===e.deletedFeatures.length)return;for(const[,i]of this._pendingTiles)i.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))};await this.updatingHandles.addPromise(this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),this._pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!_(this.url))return;const e=s((async e=>{try{const t=await F(this.url,new I({where:\"1=1\",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=f.fromJSON(t.data?.extent)}catch(t){c(t),n.getLogger(this.declaredClass).warn(\"Failed to fetch data extent\",t)}}));this.updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.handles.add(o((()=>e.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this._pendingTiles)e.alive=!1}_createPendingTiles(){const e=this._collectMissingTilesInfo();if(this._setAvailability(l(e)?1:e.coveredArea/e.fullArea),!l(e))for(const{data:t,resolution:i}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const i=this.tilesOfInterest[t],s=this.store.process(i,((e,t)=>this._verifyTileComplexity(e,t)));l(e)?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this._pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,t]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this.updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<x}_verifyFeatureDensity(e,t){if(l(this.tileInfo))return!1;const i=this.tileSize*t;return e*(j/(i*i))<w}_ensureFetchAllCounts(e){let t=!0;for(const[,i]of this._pendingTiles)i.state.type<v.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=v.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(l(e)?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set(\"availability\",e)}_createPendingTile(e,t){const i=new O(e,t);return this._pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:S,signal:t})}async _fetchFeatures(e,t,i){let s=0;const r=[];let o=0,n=t;for(;;){const a=this._createFeaturesQuery(e),l=this._setPagingParameters(a,s,n),{features:c,exceededTransferLimit:d}=await this._queryFeatures(a,i);l&&(s+=u(a.num)),o+=c.length;for(const e of c)r.push(e);if(n=t-o,!l||!d||n<=0)return r}}_filterProperties(e){return l(e)?{where:\"1=1\",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||\"1=1\",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if(l(t))throw new Error(\"Expected globalIdField to be defined\");let s=null;if(this.store.featureStore.forEach((r=>{e===r.attributes[t]&&(s=r.objectId??r.attributes[i])})),l(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery();return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await T(this.url,e,new b({sourceSpatialReference:i}),{query:this._configuration.customParameters,timeout:S,signal:t});return g(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await P(this.url,e,i,{query:this._configuration.customParameters,timeout:S,signal:t});return m(s,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,a(e)&&(this.capabilities.query.supportsResultType?t.resultType=\"tile\":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new I({returnZ:this.hasZ,returnM:!1,geometry:a(this.tileInfo)&&a(e)?y(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return a(i)&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:r,tileMaxRecordCount:o,maxRecordCount:n,supportsResultType:a}=this.capabilities.query,l=s?I.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||r)&&o?o:n||E);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};e([h({constructOnly:!0})],C.prototype,\"url\",void 0),e([h({constructOnly:!0})],C.prototype,\"objectIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"globalIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"capabilities\",void 0),e([h({constructOnly:!0})],C.prototype,\"sourceSpatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"spatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"store\",void 0),e([h({readOnly:!0})],C.prototype,\"_minimumVerticesPerFeature\",null),e([h()],C.prototype,\"filter\",null),e([h()],C.prototype,\"customParameters\",null),e([h({readOnly:!0})],C.prototype,\"_configuration\",null),e([h()],C.prototype,\"tileInfo\",null),e([h()],C.prototype,\"tileSize\",null),e([h()],C.prototype,\"tilesOfInterest\",void 0),e([h({readOnly:!0})],C.prototype,\"updating\",null),e([h({readOnly:!0})],C.prototype,\"updatingExcludingEdits\",null),e([h({readOnly:!0})],C.prototype,\"availability\",void 0),e([h()],C.prototype,\"hasZ\",null),C=e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")],C);const E=2e3,S=6e5,x=1e6,j=25,w=1;export{C as FeatureServiceTiledFetcher};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}