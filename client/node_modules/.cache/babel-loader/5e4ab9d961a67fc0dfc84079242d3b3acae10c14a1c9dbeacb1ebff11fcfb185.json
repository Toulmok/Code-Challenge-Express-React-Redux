{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport t from \"../../../../../core/Logger.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { isAbortError as a, throwIfAborted as s, throwIfNotAbortError as i } from \"../../../../../core/promiseUtils.js\";\nimport { BaseFeatureSource as o } from \"./BaseFeatureSource.js\";\nclass n extends o {\n  constructor(e) {\n    super(e);\n  }\n  async _fetchDataTile(r) {\n    const i = 6,\n      o = 20,\n      n = this._subscriptions.get(r.key.id);\n    let d = !1,\n      c = 0,\n      u = 0;\n    const p = (e, t) => {\n      u--, s(n);\n      const a = r.id,\n        i = e.reader,\n        o = e.query;\n      if (!i.exceededTransferLimit) {\n        if (d = !0, 0 !== t && !i.hasFeatures) {\n          const e = {\n            id: a,\n            addOrUpdate: i,\n            end: 0 === u,\n            type: \"append\"\n          };\n          return n.add({\n            message: e,\n            query: o\n          }), void this._onMessage(e);\n        }\n        const e = {\n          id: a,\n          addOrUpdate: i,\n          end: 0 === u,\n          type: \"append\"\n        };\n        return n.add({\n          message: e,\n          query: o\n        }), void this._onMessage(e);\n      }\n      const c = {\n        id: a,\n        addOrUpdate: i,\n        end: d && 0 === u,\n        type: \"append\"\n      };\n      n.add({\n        message: c,\n        query: o\n      }), this._onMessage(c);\n    };\n    let h = 0,\n      m = 0;\n    for (; !d && m++ < o;) {\n      let o;\n      for (let s = 0; s < h + 1; s++) {\n        const s = c++;\n        u++, o = this._fetchDataTilePage(r, s, n).then(e => e && p(e, s)).catch(s => {\n          d = !0, a(s) || (t.getLogger(\"esri.views.2d.layers.features.sources.PagedFeatureSource\").error(new e(\"mapview-query-error\", \"Encountered error when fetching tile\", {\n            tile: r,\n            error: s\n          })), this._onMessage({\n            id: r.id,\n            addOrUpdate: null,\n            end: d,\n            type: \"append\"\n          }));\n        });\n      }\n      await o, s(n), h = Math.min(h + 2, i);\n    }\n  }\n  async _fetchDataTilePage(e, t, a) {\n    s(a);\n    const o = this._queryInfo,\n      n = {\n        start: this.pageSize * t,\n        num: this.pageSize,\n        returnExceededLimitFeatures: !0,\n        quantizationParameters: e.getQuantizationParameters()\n      };\n    r(this.maxRecordCountFactor) && (n.maxRecordCountFactor = this.maxRecordCountFactor);\n    const d = this.createTileQuery(e, n);\n    try {\n      const r = a.signal,\n        i = await this._queue.push({\n          tile: e,\n          query: d,\n          signal: r,\n          depth: t\n        });\n      return s(a), i ? o !== this._queryInfo ? this._fetchDataTilePage(e, t, a) : {\n        reader: i,\n        query: d\n      } : null;\n    } catch (c) {\n      return i(c), null;\n    }\n  }\n}\nexport { n as PagedFeatureSource };","map":{"version":3,"names":["e","t","isSome","r","isAbortError","a","throwIfAborted","s","throwIfNotAbortError","i","BaseFeatureSource","o","n","constructor","_fetchDataTile","_subscriptions","get","key","id","d","c","u","p","reader","query","exceededTransferLimit","hasFeatures","addOrUpdate","end","type","add","message","_onMessage","h","m","_fetchDataTilePage","then","catch","getLogger","error","tile","Math","min","_queryInfo","start","pageSize","num","returnExceededLimitFeatures","quantizationParameters","getQuantizationParameters","maxRecordCountFactor","createTileQuery","signal","_queue","push","depth","PagedFeatureSource"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/sources/PagedFeatureSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import t from\"../../../../../core/Logger.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{isAbortError as a,throwIfAborted as s,throwIfNotAbortError as i}from\"../../../../../core/promiseUtils.js\";import{BaseFeatureSource as o}from\"./BaseFeatureSource.js\";class n extends o{constructor(e){super(e)}async _fetchDataTile(r){const i=6,o=20,n=this._subscriptions.get(r.key.id);let d=!1,c=0,u=0;const p=(e,t)=>{u--,s(n);const a=r.id,i=e.reader,o=e.query;if(!i.exceededTransferLimit){if(d=!0,0!==t&&!i.hasFeatures){const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return n.add({message:e,query:o}),void this._onMessage(e)}const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return n.add({message:e,query:o}),void this._onMessage(e)}const c={id:a,addOrUpdate:i,end:d&&0===u,type:\"append\"};n.add({message:c,query:o}),this._onMessage(c)};let h=0,m=0;for(;!d&&m++<o;){let o;for(let s=0;s<h+1;s++){const s=c++;u++,o=this._fetchDataTilePage(r,s,n).then((e=>e&&p(e,s))).catch((s=>{d=!0,a(s)||(t.getLogger(\"esri.views.2d.layers.features.sources.PagedFeatureSource\").error(new e(\"mapview-query-error\",\"Encountered error when fetching tile\",{tile:r,error:s})),this._onMessage({id:r.id,addOrUpdate:null,end:d,type:\"append\"}))}))}await o,s(n),h=Math.min(h+2,i)}}async _fetchDataTilePage(e,t,a){s(a);const o=this._queryInfo,n={start:this.pageSize*t,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};r(this.maxRecordCountFactor)&&(n.maxRecordCountFactor=this.maxRecordCountFactor);const d=this.createTileQuery(e,n);try{const r=a.signal,i=await this._queue.push({tile:e,query:d,signal:r,depth:t});return s(a),i?o!==this._queryInfo?this._fetchDataTilePage(e,t,a):{reader:i,query:d}:null}catch(c){return i(c),null}}}export{n as PagedFeatureSource};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}