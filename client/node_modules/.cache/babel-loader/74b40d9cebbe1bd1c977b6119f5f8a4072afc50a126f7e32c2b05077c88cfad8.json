{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as i } from \"../../../../core/maybe.js\";\nimport o from \"../../../../core/PooledArray.js\";\nimport { NodeState as s } from \"./I3SNode.js\";\nimport { FadeDirection as d } from \"../support/I3SLayerView.js\";\nclass t {\n  constructor(e) {\n    this._layerView = e, this._lodGlobalDirty = !1;\n  }\n  startNodeLoading(e, i, o, s) {\n    this._maxLodLevel = s.maxLodLevel, this._index = o, this._isNodeInScaleBounds = e, this._removeNodes = i;\n  }\n  shouldLoadNode(i) {\n    if (e(i)) return !1;\n    const o = this._index.nodeTraversalState(i);\n    return !!this._isChosenMaxLOD(o) || !!o.isChosen && this._childrenRequireLoading(i);\n  }\n  setLodGlobalDirty() {\n    this._lodGlobalDirty = !0;\n  }\n  get requiresLODGlobalHandling() {\n    return null != this._index && !0 === this._lodGlobalDirty;\n  }\n  lodGlobalHandling(e) {\n    if (!this.requiresLODGlobalHandling) return !1;\n    this._lodGlobalDirty = !1;\n    const i = this._layerView.view.resourceController.memoryController.usedMemory,\n      o = Math.max(0, Math.floor(10 * (i - 1)));\n    r.clear(), this._lodGlobalHandling(this._index.rootNode, o, !1, !!this._layerView.nodeCrossfadingEnabled);\n    const s = r.length;\n    this._removeNodes(r, e);\n    const d = r.length < s;\n    return 0 !== r.length && (this._lodGlobalDirty = !0), r.clear(), d;\n  }\n  _lodGlobalHandling(o, t, l, n) {\n    if (e(o)) return !1;\n    const a = o.index,\n      h = this._index,\n      _ = this._layerView,\n      u = h.nodeTraversalState(o),\n      c = this._isChosenMaxLOD(u),\n      x = !o.resources.hasFeatureData;\n    if (c && x) return o.childrenLoaded > 0 && this._removeChildrenRecursive(o), !0;\n    const L = _.isNodeLoaded(a);\n    if (n && L && c) {\n      const e = !l && this.hasNoVisibleChildren(o);\n      _.fadeNode(a, d.FadeIn, !e);\n    }\n    const N = L && (!_.isNodeFullyFadedIn || _.isNodeFullyFadedIn(a));\n    if (L && (_.updateNodeState(a, c ? s.Leaf : s.Hole), c)) return N && this._removeChildrenRecursive(o), N;\n    const m = o.childCount > 0;\n    let y = m;\n    if (m) for (let e = 0; e < o.childCount; e++) {\n      const o = h.getChildIndex(a, e),\n        s = h.getNode(o);\n      if (i(s)) {\n        !(!h.isGeometryVisible(o) || this._lodGlobalHandling(s, t, l || N, n)) && this._isNodeInScaleBounds(s) && (y = !1);\n      } else h.isNodeVisible(o) && (y = !1);\n    }\n    const b = L && !c && (y || r.length < t);\n    b && r.push(a), !n || b || !L || l || y || _.fadeNode(a, d.FadeIn, !1);\n    const f = !o.resources.hasFeatureData;\n    return y || N && !b || f;\n  }\n  _removeChildrenRecursive(e) {\n    this._index.traverseChildren(e, e => ((this._layerView.isNodeLoaded(e.index) || this._layerView.isNodeReloading(e.index)) && r.push(e.index), e.childrenLoaded > 0));\n  }\n  hasNoVisibleChildren(e) {\n    let i = !0;\n    return this._index.traverseChildren(e, e => !(!i || !this._index.isNodeVisible(e.index)) && (this._layerView.isNodeLoaded(e.index) ? (i = !1, !1) : e.childrenLoaded > 0)), i;\n  }\n  _childrenRequireLoading(e) {\n    let i = !1,\n      o = !0;\n    return this._index.traverseChildren(e, e => {\n      if (!o || !this._index.isNodeVisible(e.index)) return !1;\n      const s = this._index.nodeTraversalState(e);\n      return this._isChosenMaxLOD(s) && this._index.isGeometryVisible(e.index) && (i = !0), this._layerView.isNodeLoaded(e.index) ? (o = !1, !1) : e.childrenLoaded > 0;\n    }), o && i;\n  }\n  _isChosenMaxLOD(e) {\n    return e.isChosen && (!e.nodeHasLOD || e.lodLevel === this._maxLodLevel);\n  }\n}\nconst r = new o({\n  deallocator: null\n});\nexport { t as default };","map":{"version":3,"names":["isNone","e","isSome","i","o","NodeState","s","FadeDirection","d","t","constructor","_layerView","_lodGlobalDirty","startNodeLoading","_maxLodLevel","maxLodLevel","_index","_isNodeInScaleBounds","_removeNodes","shouldLoadNode","nodeTraversalState","_isChosenMaxLOD","isChosen","_childrenRequireLoading","setLodGlobalDirty","requiresLODGlobalHandling","lodGlobalHandling","view","resourceController","memoryController","usedMemory","Math","max","floor","r","clear","_lodGlobalHandling","rootNode","nodeCrossfadingEnabled","length","l","n","a","index","h","_","u","c","x","resources","hasFeatureData","childrenLoaded","_removeChildrenRecursive","L","isNodeLoaded","hasNoVisibleChildren","fadeNode","FadeIn","N","isNodeFullyFadedIn","updateNodeState","Leaf","Hole","m","childCount","y","getChildIndex","getNode","isGeometryVisible","isNodeVisible","b","push","f","traverseChildren","isNodeReloading","nodeHasLOD","lodLevel","deallocator","default"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/layers/i3s/I3SLodHandling.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as i}from\"../../../../core/maybe.js\";import o from\"../../../../core/PooledArray.js\";import{NodeState as s}from\"./I3SNode.js\";import{FadeDirection as d}from\"../support/I3SLayerView.js\";class t{constructor(e){this._layerView=e,this._lodGlobalDirty=!1}startNodeLoading(e,i,o,s){this._maxLodLevel=s.maxLodLevel,this._index=o,this._isNodeInScaleBounds=e,this._removeNodes=i}shouldLoadNode(i){if(e(i))return!1;const o=this._index.nodeTraversalState(i);return!!this._isChosenMaxLOD(o)||!!o.isChosen&&this._childrenRequireLoading(i)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this._layerView.view.resourceController.memoryController.usedMemory,o=Math.max(0,Math.floor(10*(i-1)));r.clear(),this._lodGlobalHandling(this._index.rootNode,o,!1,!!this._layerView.nodeCrossfadingEnabled);const s=r.length;this._removeNodes(r,e);const d=r.length<s;return 0!==r.length&&(this._lodGlobalDirty=!0),r.clear(),d}_lodGlobalHandling(o,t,l,n){if(e(o))return!1;const a=o.index,h=this._index,_=this._layerView,u=h.nodeTraversalState(o),c=this._isChosenMaxLOD(u),x=!o.resources.hasFeatureData;if(c&&x)return o.childrenLoaded>0&&this._removeChildrenRecursive(o),!0;const L=_.isNodeLoaded(a);if(n&&L&&c){const e=!l&&this.hasNoVisibleChildren(o);_.fadeNode(a,d.FadeIn,!e)}const N=L&&(!_.isNodeFullyFadedIn||_.isNodeFullyFadedIn(a));if(L&&(_.updateNodeState(a,c?s.Leaf:s.Hole),c))return N&&this._removeChildrenRecursive(o),N;const m=o.childCount>0;let y=m;if(m)for(let e=0;e<o.childCount;e++){const o=h.getChildIndex(a,e),s=h.getNode(o);if(i(s)){!(!h.isGeometryVisible(o)||this._lodGlobalHandling(s,t,l||N,n))&&this._isNodeInScaleBounds(s)&&(y=!1)}else h.isNodeVisible(o)&&(y=!1)}const b=L&&!c&&(y||r.length<t);b&&r.push(a),!n||b||!L||l||y||_.fadeNode(a,d.FadeIn,!1);const f=!o.resources.hasFeatureData;return y||N&&!b||f}_removeChildrenRecursive(e){this._index.traverseChildren(e,(e=>((this._layerView.isNodeLoaded(e.index)||this._layerView.isNodeReloading(e.index))&&r.push(e.index),e.childrenLoaded>0)))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseChildren(e,(e=>!(!i||!this._index.isNodeVisible(e.index))&&(this._layerView.isNodeLoaded(e.index)?(i=!1,!1):e.childrenLoaded>0))),i}_childrenRequireLoading(e){let i=!1,o=!0;return this._index.traverseChildren(e,(e=>{if(!o||!this._index.isNodeVisible(e.index))return!1;const s=this._index.nodeTraversalState(e);return this._isChosenMaxLOD(s)&&this._index.isGeometryVisible(e.index)&&(i=!0),this._layerView.isNodeLoaded(e.index)?(o=!1,!1):e.childrenLoaded>0})),o&&i}_isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}}const r=new o({deallocator:null});export{t as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}