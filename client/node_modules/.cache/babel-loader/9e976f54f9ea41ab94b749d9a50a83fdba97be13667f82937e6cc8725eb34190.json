{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Handles.js\";\nimport { clamp as t, lerp as s, smoothstep as i } from \"../../../core/mathUtils.js\";\nimport { isNone as r } from \"../../../core/maybe.js\";\nimport { watch as a } from \"../../../core/reactiveUtils.js\";\nimport { s as o } from \"../../../chunks/vec2.js\";\nimport { p as n } from \"../../../chunks/vec3.js\";\nimport { s as h } from \"../../../chunks/vec4.js\";\nimport { earth as d } from \"../../../geometry/support/Ellipsoid.js\";\nimport { AtmosphereType as u } from \"./AtmosphereType.js\";\nimport { atmosphereHeight as p, innerAtmosphereDepth as m, computeInnerAltitudeFade as l } from \"./atmosphereUtils.js\";\nimport { ChapmanAtmospherePassParameters as _, ChapmanAtmosphereTechnique as c } from \"./ChapmanAtmosphereTechnique.js\";\nimport { ChapmanAtmosphereTechniqueConfiguration as f } from \"./ChapmanAtmosphereTechniqueConfiguration.js\";\nimport { Pos2Tex as T } from \"../webgl-engine/lib/DefaultVertexBufferLayouts.js\";\nimport { createQuadVAO as v } from \"../webgl-engine/lib/glUtil3D.js\";\nimport { PrimitiveType as b } from \"../../webgl/enums.js\";\nclass R {\n  constructor(t, s) {\n    this._view = t, this.type = u.Realistic, this._handles = new e(), this._passParameters = new _(), this._rootTileElevationMin = NaN, this._lowerBoundEarthRadius = d.radius, this._fadeHaze = 0, this._updateRadius(d.radius);\n    const i = s.renderContext.rctx;\n    this._updateRootTileElevationBounds(), this._handles.add([a(() => this._view.basemapTerrain.rootTileElevationBounds, () => this._updateRootTileElevationBounds()), a(() => this._view.basemapTerrain.visibleElevationBounds, () => this._updateVisibleElevationBounds())]);\n    const r = new f();\n    r.haze = !1, this._atmosphereTechnique = s.techniqueRepository.acquire(c, r), r.haze = !0, this._atmosphereHazeTechnique = s.techniqueRepository.acquire(c, r), this._vao = v(i, T);\n  }\n  destroy() {\n    this._atmosphereTechnique.release(), this._atmosphereHazeTechnique.release(), this._vao.dispose(), this._handles.destroy();\n  }\n  render(e) {\n    this._render(e, this._atmosphereTechnique, e.offscreenRenderingHelper.depthTexture);\n  }\n  renderHaze(e, t) {\n    this._fadeHaze = t, this._render(e, this._atmosphereHazeTechnique, e.offscreenRenderingHelper.linearDepthTexture);\n  }\n  _render(e, t, s) {\n    if (r(s)) return;\n    this._update(e.bindParameters.camera), this._passParameters.depthTex = s;\n    const i = e.rctx.bindTechnique(t, this._passParameters, e.bindParameters);\n    e.offscreenRenderingHelper.renderDepthDetached(() => this._renderCommon(i, e));\n  }\n  _renderCommon(e, t) {\n    r(this._vao) || (t.rctx.bindVAO(this._vao), e.assertCompatibleVertexAttributeLocations(this._vao), t.rctx.drawArrays(b.TRIANGLE_STRIP, 0, 4));\n  }\n  _adjustRadiusForTesselation(e) {\n    return e * Math.cos(Math.PI / 16 / 16);\n  }\n  _updateRootTileElevationBounds() {\n    const e = this._view.basemapTerrain.rootTileElevationBounds.min;\n    e !== this._rootTileElevationMin && (this._rootTileElevationMin = e, this._lowerBoundEarthRadius = d.radius, this._updateVisibleElevationBounds());\n  }\n  _updateVisibleElevationBounds() {\n    const e = this._adjustRadiusForTesselation(d.radius + this._view.basemapTerrain.visibleElevationBounds.min);\n    e < this._lowerBoundEarthRadius && this._updateRadius(e);\n  }\n  _updateRadius(e) {\n    this._lowerBoundEarthRadius = e, o(this._passParameters.radii, e, e + p), this._passParameters.innerFadeDistance = 2 * Math.sqrt((2 * e - m) * m);\n  }\n  _update(e) {\n    if (r(e)) return;\n    const a = n(e.eye),\n      o = Math.sqrt(a),\n      u = a - this._passParameters.radii[1] * this._passParameters.radii[1],\n      m = t((o - this._passParameters.radii[0]) / p, 0, 1);\n    h(this._passParameters.heightParameters, o, a, u, m), this._passParameters.altitudeFade = l(o - this._lowerBoundEarthRadius), this._passParameters.hazeStrength = s(s(.6, 1, i(9500, 10500, o - d.radius)), 1, this._fadeHaze);\n  }\n  static isSupported(e) {\n    return e.renderContext.rctx.capabilities.depthTexture;\n  }\n}\nexport { R as ChapmanAtmosphere };","map":{"version":3,"names":["e","clamp","t","lerp","s","smoothstep","i","isNone","r","watch","a","o","p","n","h","earth","d","AtmosphereType","u","atmosphereHeight","innerAtmosphereDepth","m","computeInnerAltitudeFade","l","ChapmanAtmospherePassParameters","_","ChapmanAtmosphereTechnique","c","ChapmanAtmosphereTechniqueConfiguration","f","Pos2Tex","T","createQuadVAO","v","PrimitiveType","b","R","constructor","_view","type","Realistic","_handles","_passParameters","_rootTileElevationMin","NaN","_lowerBoundEarthRadius","radius","_fadeHaze","_updateRadius","renderContext","rctx","_updateRootTileElevationBounds","add","basemapTerrain","rootTileElevationBounds","visibleElevationBounds","_updateVisibleElevationBounds","haze","_atmosphereTechnique","techniqueRepository","acquire","_atmosphereHazeTechnique","_vao","destroy","release","dispose","render","_render","offscreenRenderingHelper","depthTexture","renderHaze","linearDepthTexture","_update","bindParameters","camera","depthTex","bindTechnique","renderDepthDetached","_renderCommon","bindVAO","assertCompatibleVertexAttributeLocations","drawArrays","TRIANGLE_STRIP","_adjustRadiusForTesselation","Math","cos","PI","min","radii","innerFadeDistance","sqrt","eye","heightParameters","altitudeFade","hazeStrength","isSupported","capabilities","ChapmanAtmosphere"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphere.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Handles.js\";import{clamp as t,lerp as s,smoothstep as i}from\"../../../core/mathUtils.js\";import{isNone as r}from\"../../../core/maybe.js\";import{watch as a}from\"../../../core/reactiveUtils.js\";import{s as o}from\"../../../chunks/vec2.js\";import{p as n}from\"../../../chunks/vec3.js\";import{s as h}from\"../../../chunks/vec4.js\";import{earth as d}from\"../../../geometry/support/Ellipsoid.js\";import{AtmosphereType as u}from\"./AtmosphereType.js\";import{atmosphereHeight as p,innerAtmosphereDepth as m,computeInnerAltitudeFade as l}from\"./atmosphereUtils.js\";import{ChapmanAtmospherePassParameters as _,ChapmanAtmosphereTechnique as c}from\"./ChapmanAtmosphereTechnique.js\";import{ChapmanAtmosphereTechniqueConfiguration as f}from\"./ChapmanAtmosphereTechniqueConfiguration.js\";import{Pos2Tex as T}from\"../webgl-engine/lib/DefaultVertexBufferLayouts.js\";import{createQuadVAO as v}from\"../webgl-engine/lib/glUtil3D.js\";import{PrimitiveType as b}from\"../../webgl/enums.js\";class R{constructor(t,s){this._view=t,this.type=u.Realistic,this._handles=new e,this._passParameters=new _,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=d.radius,this._fadeHaze=0,this._updateRadius(d.radius);const i=s.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([a((()=>this._view.basemapTerrain.rootTileElevationBounds),(()=>this._updateRootTileElevationBounds())),a((()=>this._view.basemapTerrain.visibleElevationBounds),(()=>this._updateVisibleElevationBounds()))]);const r=new f;r.haze=!1,this._atmosphereTechnique=s.techniqueRepository.acquire(c,r),r.haze=!0,this._atmosphereHazeTechnique=s.techniqueRepository.acquire(c,r),this._vao=v(i,T)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,t){this._fadeHaze=t,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,t,s){if(r(s))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=s;const i=e.rctx.bindTechnique(t,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached((()=>this._renderCommon(i,e)))}_renderCommon(e,t){r(this._vao)||(t.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),t.rctx.drawArrays(b.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=d.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(d.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,o(this._passParameters.radii,e,e+p),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-m)*m)}_update(e){if(r(e))return;const a=n(e.eye),o=Math.sqrt(a),u=a-this._passParameters.radii[1]*this._passParameters.radii[1],m=t((o-this._passParameters.radii[0])/p,0,1);h(this._passParameters.heightParameters,o,a,u,m),this._passParameters.altitudeFade=l(o-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=s(s(.6,1,i(9500,10500,o-d.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}}export{R as ChapmanAtmosphere};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}