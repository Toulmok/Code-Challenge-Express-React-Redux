{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport e from \"../../../core/Error.js\";\nimport has from \"../../../core/has.js\";\nimport { unwrap as s } from \"../../../core/maybe.js\";\nimport { eachAlways as r, createAbortError as a } from \"../../../core/promiseUtils.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/arrayUtils.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport n from \"./BaseRaster.js\";\nimport m from \"./InMemoryRaster.js\";\nimport { parsePAMInfo as l } from \"./pamParser.js\";\nimport { getFormat as p } from \"../rasterFormats/RasterCodec.js\";\nimport { estimateStatisticsFromHistograms as c } from \"../rasterFunctions/stretchUtils.js\";\nimport f from \"../rasterTransforms/PolynomialTransform.js\";\nimport u from \"../../../geometry/SpatialReference.js\";\nimport h from \"../../../geometry/Extent.js\";\nlet d = class extends n {\n  async open(t) {\n    await this.init();\n    const e = await this._fetchData(t);\n    let {\n      spatialReference: s,\n      statistics: r,\n      histograms: a,\n      transform: o\n    } = await this._fetchAuxiliaryData(t);\n    const i = !s;\n    i && (s = new u({\n      wkid: 3857\n    })), a?.length && null == r && (r = c(a));\n    const {\n      width: n,\n      height: l\n    } = e;\n    let p = new h({\n      xmin: -.5,\n      ymin: .5 - l,\n      xmax: n - .5,\n      ymax: .5,\n      spatialReference: s\n    });\n    const f = o ? o.forwardTransform(p) : p;\n    let d = !0;\n    if (o) {\n      const t = o.forwardCoefficients;\n      d = t && 0 === t[1] && 0 === t[2], d && (o = null, p = f);\n    }\n    const w = new m({\n      data: {\n        extent: f,\n        nativeExtent: p,\n        transform: o,\n        pixelBlock: e,\n        statistics: r,\n        histograms: a,\n        keyProperties: {\n          DateType: \"Processed\"\n        },\n        isPseudoSpatialReference: i\n      }\n    });\n    await w.open(), w.data = null, this._set(\"rasterInfo\", w.rasterInfo), this._inMemoryRaster = w;\n  }\n  fetchRawTile(t, e, s) {\n    let r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    return this._inMemoryRaster.fetchRawTile(t, e, s, r);\n  }\n  async _fetchData(t) {\n    const {\n        data: s\n      } = await this.request(this.url, {\n        responseType: \"array-buffer\",\n        signal: t?.signal\n      }),\n      r = p(s).toUpperCase();\n    if (\"JPG\" !== r && \"PNG\" !== r && \"GIF\" !== r && \"BMP\" !== r) throw new e(\"image-aux-raster:open\", \"the data is not a supported format\");\n    this._set(\"datasetFormat\", r);\n    const a = r.toLowerCase(),\n      o = \"gif\" === a || \"bmp\" === a || !has(\"ios\"),\n      i = await this.decodePixelBlock(s, {\n        format: a,\n        useCanvas: o,\n        hasNoZlibMask: !0\n      });\n    if (null == i) throw new e(\"image-aux-raster:open\", \"the data cannot be decoded\");\n    return i;\n  }\n  async _fetchAuxiliaryData(t) {\n    const e = s(t?.signal),\n      o = this.ioConfig.skipExtensions ?? [],\n      i = o.includes(\"aux.xml\") ? null : this.request(this.url + \".aux.xml\", {\n        responseType: \"xml\",\n        signal: e\n      }),\n      n = this.datasetFormat,\n      m = \"JPG\" === n ? \"jgw\" : \"PNG\" === n ? \"pgw\" : \"BMP\" === n ? \"bpw\" : null,\n      p = m && o.includes(m) ? null : this.request(this.url.slice(0, this.url.lastIndexOf(\".\")) + \".\" + m, {\n        responseType: \"text\",\n        signal: e\n      }),\n      c = await r([i, p]);\n    if (e?.aborted) throw a();\n    const u = l(c[0].value?.data);\n    if (!u.transform) {\n      const t = c[1].value ? c[1].value.data.split(\"\\n\").slice(0, 6).map(t => Number(t)) : null;\n      u.transform = 6 === t?.length ? new f({\n        forwardCoefficients: [t[4], t[5], t[0], -t[1], t[2], -t[3]]\n      }) : null;\n    }\n    return u;\n  }\n};\nt([o({\n  type: String,\n  json: {\n    write: !0\n  }\n})], d.prototype, \"datasetFormat\", void 0), d = t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")], d);\nconst w = d;\nexport { w as default };","map":{"version":3,"names":["_","t","e","has","unwrap","s","eachAlways","r","createAbortError","a","property","o","subclass","i","n","m","parsePAMInfo","l","getFormat","p","estimateStatisticsFromHistograms","c","f","u","h","d","open","init","_fetchData","spatialReference","statistics","histograms","transform","_fetchAuxiliaryData","wkid","length","width","height","xmin","ymin","xmax","ymax","forwardTransform","forwardCoefficients","w","data","extent","nativeExtent","pixelBlock","keyProperties","DateType","isPseudoSpatialReference","_set","rasterInfo","_inMemoryRaster","fetchRawTile","arguments","undefined","request","url","responseType","signal","toUpperCase","toLowerCase","decodePixelBlock","format","useCanvas","hasNoZlibMask","ioConfig","skipExtensions","includes","datasetFormat","slice","lastIndexOf","aborted","value","split","map","Number","type","String","json","write","prototype","default"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/layers/support/rasterDatasets/ImageAuxRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import e from\"../../../core/Error.js\";import has from\"../../../core/has.js\";import{unwrap as s}from\"../../../core/maybe.js\";import{eachAlways as r,createAbortError as a}from\"../../../core/promiseUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"./BaseRaster.js\";import m from\"./InMemoryRaster.js\";import{parsePAMInfo as l}from\"./pamParser.js\";import{getFormat as p}from\"../rasterFormats/RasterCodec.js\";import{estimateStatisticsFromHistograms as c}from\"../rasterFunctions/stretchUtils.js\";import f from\"../rasterTransforms/PolynomialTransform.js\";import u from\"../../../geometry/SpatialReference.js\";import h from\"../../../geometry/Extent.js\";let d=class extends n{async open(t){await this.init();const e=await this._fetchData(t);let{spatialReference:s,statistics:r,histograms:a,transform:o}=await this._fetchAuxiliaryData(t);const i=!s;i&&(s=new u({wkid:3857})),a?.length&&null==r&&(r=c(a));const{width:n,height:l}=e;let p=new h({xmin:-.5,ymin:.5-l,xmax:n-.5,ymax:.5,spatialReference:s});const f=o?o.forwardTransform(p):p;let d=!0;if(o){const t=o.forwardCoefficients;d=t&&0===t[1]&&0===t[2],d&&(o=null,p=f)}const w=new m({data:{extent:f,nativeExtent:p,transform:o,pixelBlock:e,statistics:r,histograms:a,keyProperties:{DateType:\"Processed\"},isPseudoSpatialReference:i}});await w.open(),w.data=null,this._set(\"rasterInfo\",w.rasterInfo),this._inMemoryRaster=w}fetchRawTile(t,e,s,r={}){return this._inMemoryRaster.fetchRawTile(t,e,s,r)}async _fetchData(t){const{data:s}=await this.request(this.url,{responseType:\"array-buffer\",signal:t?.signal}),r=p(s).toUpperCase();if(\"JPG\"!==r&&\"PNG\"!==r&&\"GIF\"!==r&&\"BMP\"!==r)throw new e(\"image-aux-raster:open\",\"the data is not a supported format\");this._set(\"datasetFormat\",r);const a=r.toLowerCase(),o=\"gif\"===a||\"bmp\"===a||!has(\"ios\"),i=await this.decodePixelBlock(s,{format:a,useCanvas:o,hasNoZlibMask:!0});if(null==i)throw new e(\"image-aux-raster:open\",\"the data cannot be decoded\");return i}async _fetchAuxiliaryData(t){const e=s(t?.signal),o=this.ioConfig.skipExtensions??[],i=o.includes(\"aux.xml\")?null:this.request(this.url+\".aux.xml\",{responseType:\"xml\",signal:e}),n=this.datasetFormat,m=\"JPG\"===n?\"jgw\":\"PNG\"===n?\"pgw\":\"BMP\"===n?\"bpw\":null,p=m&&o.includes(m)?null:this.request(this.url.slice(0,this.url.lastIndexOf(\".\"))+\".\"+m,{responseType:\"text\",signal:e}),c=await r([i,p]);if(e?.aborted)throw a();const u=l(c[0].value?.data);if(!u.transform){const t=c[1].value?c[1].value.data.split(\"\\n\").slice(0,6).map((t=>Number(t))):null;u.transform=6===t?.length?new f({forwardCoefficients:[t[4],t[5],t[0],-t[1],t[2],-t[3]]}):null}return u}};t([o({type:String,json:{write:!0}})],d.prototype,\"datasetFormat\",void 0),d=t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")],d);const w=d;export{w as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}