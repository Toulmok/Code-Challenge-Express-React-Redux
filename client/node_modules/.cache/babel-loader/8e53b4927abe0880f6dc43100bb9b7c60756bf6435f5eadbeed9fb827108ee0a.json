{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { id as t } from \"../../kernel.js\";\nimport r from \"../../request.js\";\nimport { isNone as e, isSome as a } from \"../../core/maybe.js\";\nimport { throwIfAbortError as i } from \"../../core/promiseUtils.js\";\nimport s from \"../FeatureLayer.js\";\nimport n from \"../../portal/Portal.js\";\nimport o from \"../../portal/PortalItem.js\";\nclass l {\n  constructor(t, r, e, a) {\n    this._parsedUrl = t, this._portalItem = r, this._apiKey = e, this.signal = a, this._rootDocument = null;\n    const i = this._parsedUrl?.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);\n    i && (this._urlParts = {\n      root: i[1],\n      layerId: parseInt(i[2], 10)\n    });\n  }\n  async fetch() {\n    if (!this._urlParts) return null;\n    const t = this._portalItem ?? (await this._portalItemFromServiceItemId());\n    if (e(t)) return this._loadFromUrl();\n    const r = await this._findAndLoadRelatedPortalItem(t);\n    return e(r) ? null : this._loadFeatureLayerFromPortalItem(r);\n  }\n  async fetchPortalItem() {\n    if (!this._urlParts) return null;\n    const t = this._portalItem ?? (await this._portalItemFromServiceItemId());\n    return e(t) ? null : this._findAndLoadRelatedPortalItem(t);\n  }\n  async _fetchRootDocument() {\n    if (a(this._rootDocument)) return this._rootDocument;\n    if (e(this._urlParts)) return this._rootDocument = {}, {};\n    const t = {\n        query: {\n          f: \"json\",\n          token: this._apiKey\n        },\n        responseType: \"json\",\n        signal: this.signal\n      },\n      i = `${this._urlParts.root}/SceneServer`;\n    try {\n      const e = await r(i, t);\n      this._rootDocument = e.data;\n    } catch {\n      this._rootDocument = {};\n    }\n    return this._rootDocument;\n  }\n  async _fetchServiceOwningPortalUrl() {\n    const e = this._parsedUrl?.path,\n      a = e ? t?.findServerInfo(e) : null;\n    if (a?.owningSystemUrl) return a.owningSystemUrl;\n    const s = e ? e.replace(/(.*\\/rest)\\/.*/i, \"$1\") + \"/info\" : null;\n    try {\n      const t = (await r(s, {\n        query: {\n          f: \"json\"\n        },\n        responseType: \"json\",\n        signal: this.signal\n      })).data.owningSystemUrl;\n      if (t) return t;\n    } catch (n) {\n      i(n);\n    }\n    return null;\n  }\n  async _findAndLoadRelatedPortalItem(t) {\n    try {\n      return (await t.fetchRelatedItems({\n        relationshipType: \"Service2Service\",\n        direction: \"reverse\"\n      }, {\n        signal: this.signal\n      })).find(t => \"Feature Service\" === t.type) || null;\n    } catch (r) {\n      return i(r), null;\n    }\n  }\n  async _loadFeatureLayerFromPortalItem(t) {\n    await t.load({\n      signal: this.signal\n    });\n    const r = await this._findMatchingAssociatedSublayerUrl(t.url ?? \"\");\n    return new s({\n      url: r,\n      portalItem: t\n    }).load({\n      signal: this.signal\n    });\n  }\n  async _loadFromUrl() {\n    const t = await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);\n    return new s({\n      url: t\n    }).load({\n      signal: this.signal\n    });\n  }\n  async _findMatchingAssociatedSublayerUrl(t) {\n    const e = t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i, \"$1\"),\n      a = {\n        query: {\n          f: \"json\"\n        },\n        responseType: \"json\",\n        authMode: \"no-prompt\",\n        signal: this.signal\n      },\n      i = this._urlParts?.layerId,\n      s = this._fetchRootDocument(),\n      n = r(e, a),\n      [o, l] = await Promise.all([n, s]),\n      c = l && l.layers,\n      u = o.data && o.data.layers;\n    if (!Array.isArray(u)) throw new Error(\"expected layers array\");\n    if (Array.isArray(c)) for (let r = 0; r < Math.min(c.length, u.length); r++) {\n      if (c[r].id === i) return `${e}/${u[r].id}`;\n    } else if (null != i && i < u.length) return `${e}/${u[i].id}`;\n    throw new Error(\"could not find matching associated sublayer\");\n  }\n  async _portalItemFromServiceItemId() {\n    const t = (await this._fetchRootDocument()).serviceItemId;\n    if (!t) return null;\n    const r = new o({\n        id: t,\n        apiKey: this._apiKey\n      }),\n      e = await this._fetchServiceOwningPortalUrl();\n    a(e) && (r.portal = new n({\n      url: e\n    }));\n    try {\n      return r.load({\n        signal: this.signal\n      });\n    } catch (s) {\n      return i(s), null;\n    }\n  }\n}\nexport { l as FetchAssociatedFeatureLayer };","map":{"version":3,"names":["id","t","r","isNone","e","isSome","a","throwIfAbortError","i","s","n","o","l","constructor","_parsedUrl","_portalItem","_apiKey","signal","_rootDocument","path","match","_urlParts","root","layerId","parseInt","fetch","_portalItemFromServiceItemId","_loadFromUrl","_findAndLoadRelatedPortalItem","_loadFeatureLayerFromPortalItem","fetchPortalItem","_fetchRootDocument","query","f","token","responseType","data","_fetchServiceOwningPortalUrl","findServerInfo","owningSystemUrl","replace","fetchRelatedItems","relationshipType","direction","find","type","load","_findMatchingAssociatedSublayerUrl","url","portalItem","authMode","Promise","all","c","layers","u","Array","isArray","Error","Math","min","length","serviceItemId","apiKey","portal","FetchAssociatedFeatureLayer"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/layers/support/FetchAssociatedFeatureLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{id as t}from\"../../kernel.js\";import r from\"../../request.js\";import{isNone as e,isSome as a}from\"../../core/maybe.js\";import{throwIfAbortError as i}from\"../../core/promiseUtils.js\";import s from\"../FeatureLayer.js\";import n from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";class l{constructor(t,r,e,a){this._parsedUrl=t,this._portalItem=r,this._apiKey=e,this.signal=a,this._rootDocument=null;const i=this._parsedUrl?.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);i&&(this._urlParts={root:i[1],layerId:parseInt(i[2],10)})}async fetch(){if(!this._urlParts)return null;const t=this._portalItem??await this._portalItemFromServiceItemId();if(e(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return e(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const t=this._portalItem??await this._portalItemFromServiceItemId();return e(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(a(this._rootDocument))return this._rootDocument;if(e(this._urlParts))return this._rootDocument={},{};const t={query:{f:\"json\",token:this._apiKey},responseType:\"json\",signal:this.signal},i=`${this._urlParts.root}/SceneServer`;try{const e=await r(i,t);this._rootDocument=e.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){const e=this._parsedUrl?.path,a=e?t?.findServerInfo(e):null;if(a?.owningSystemUrl)return a.owningSystemUrl;const s=e?e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\":null;try{const t=(await r(s,{query:{f:\"json\"},responseType:\"json\",signal:this.signal})).data.owningSystemUrl;if(t)return t}catch(n){i(n)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:this.signal})).find((t=>\"Feature Service\"===t.type))||null}catch(r){return i(r),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(t.url??\"\");return new s({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return new s({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const e=t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i,\"$1\"),a={query:{f:\"json\"},responseType:\"json\",authMode:\"no-prompt\",signal:this.signal},i=this._urlParts?.layerId,s=this._fetchRootDocument(),n=r(e,a),[o,l]=await Promise.all([n,s]),c=l&&l.layers,u=o.data&&o.data.layers;if(!Array.isArray(u))throw new Error(\"expected layers array\");if(Array.isArray(c))for(let r=0;r<Math.min(c.length,u.length);r++){if(c[r].id===i)return`${e}/${u[r].id}`}else if(null!=i&&i<u.length)return`${e}/${u[i].id}`;throw new Error(\"could not find matching associated sublayer\")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new o({id:t,apiKey:this._apiKey}),e=await this._fetchServiceOwningPortalUrl();a(e)&&(r.portal=new n({url:e}));try{return r.load({signal:this.signal})}catch(s){return i(s),null}}}export{l as FetchAssociatedFeatureLayer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}