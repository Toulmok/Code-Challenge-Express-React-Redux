{"ast":null,"code":"/* Copyright 2017 Esri\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Portal from '@arcgis/core/portal/Portal';\nimport PortalQueryParams from '@arcgis/core/portal/PortalQueryParams';\nimport portalItem from '@arcgis/core/portal/PortalItem';\nimport { INIT_ITEMS } from '../constants/action-types';\nconst arcgis = {};\nwindow.arcgis = arcgis;\n\n/**\n * Middleware function with the signature\n *\n * storeInstance =>\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\n * actionThatDispatchWasCalledWith =>\n * valueToUseAsTheReturnValueOfTheDispatchCall\n *\n * Typically written as\n *\n * store => next => action => result\n */\nconst arcgisMiddleWare = store => next => action => {\n  switch (action.type) {\n    //Initialize scene view on a viewport container.\n\n    case INIT_ITEMS:\n      {\n        if (!action.id || !action.container) break;\n\n        // if sceneview container is already initialized, just add it back to the DOM.\n        if (arcgis.container) {\n          action.container.appendChild(arcgis.container);\n          break;\n        }\n\n        // Otherwise, create a new container element and a new scene view.\n        arcgis.container = document.createElement('DIV');\n        action.container.appendChild(arcgis.container);\n\n        // Initialize item table\n        const portal = new Portal();\n        const queryParams = new PortalQueryParams({\n          query: \"owner:\" + \"Eileonx\",\n          //portal.user.username,credential\n          sortOrder: \"desc\",\n          num: 20\n        });\n        let queryResults = portal.queryItems(queryParams);\n\n        // When initialized...\n        return queryResults.then(() => {\n          next({\n            ...action,\n            name: queryResults.portalItem.title\n          });\n          return arcgis.sceneView.whenLayerView();\n        }).then(() => {\n          // Update the environment settings (either from the state or from the scene)\n          const date = new Date();\n          const {\n            environment\n          } = store.getState();\n          store.dispatch({\n            type: undefined,\n            date: undefined,\n            UTCOffset: undefined,\n            shadows: undefined\n          });\n\n          // Update the selection highlights\n          const {\n            selection\n          } = store.getState();\n        });\n      }\n    default:\n      {\n        next(action);\n        break;\n      }\n  }\n  return Promise.resolve();\n};\nexport default arcgisMiddleWare;","map":{"version":3,"names":["Portal","PortalQueryParams","portalItem","INIT_ITEMS","arcgis","window","arcgisMiddleWare","store","next","action","type","id","container","appendChild","document","createElement","portal","queryParams","query","sortOrder","num","queryResults","queryItems","then","name","title","sceneView","whenLayerView","date","Date","environment","getState","dispatch","undefined","UTCOffset","shadows","selection","Promise","resolve"],"sources":["C:/code-challenge-react/frontend/src/middleware/arcgis-portalquery.js"],"sourcesContent":["/* Copyright 2017 Esri\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Portal from '@arcgis/core/portal/Portal'\nimport PortalQueryParams from '@arcgis/core/portal/PortalQueryParams'\nimport portalItem from '@arcgis/core/portal/PortalItem'\n\nimport {\n  INIT_ITEMS,\n} from '../constants/action-types'\n\nconst arcgis = {}\nwindow.arcgis = arcgis\n\n/**\n * Middleware function with the signature\n *\n * storeInstance =>\n * functionToCallWithAnActionThatWillSendItToTheNextMiddleware =>\n * actionThatDispatchWasCalledWith =>\n * valueToUseAsTheReturnValueOfTheDispatchCall\n *\n * Typically written as\n *\n * store => next => action => result\n */\nconst arcgisMiddleWare = store => next => (action) => {\n  switch (action.type) {\n    //Initialize scene view on a viewport container.\n\n    case INIT_ITEMS: {\n      if (!action.id || !action.container) break\n\n      // if sceneview container is already initialized, just add it back to the DOM.\n      if (arcgis.container) {\n        action.container.appendChild(arcgis.container)\n        break\n      }\n\n      // Otherwise, create a new container element and a new scene view.\n      arcgis.container = document.createElement('DIV')\n      action.container.appendChild(arcgis.container)\n\n      // Initialize item table\n      const portal = new Portal()\n      const queryParams = new PortalQueryParams({\n        query: \"owner:\" + \"Eileonx\",//portal.user.username,credential\n        sortOrder: \"desc\",\n        num: 20\n      })\n      let queryResults = portal.queryItems(queryParams)\n\n      // When initialized...\n      return queryResults\n        .then(() => {\n          \n          next({ ...action, name: queryResults.portalItem.title })\n\n          return arcgis.sceneView.whenLayerView()\n        })\n        .then(() => {\n          // Update the environment settings (either from the state or from the scene)\n          const date = new Date()\n\n          const { environment } = store.getState()\n\n          store.dispatch({\n            type: undefined,\n            date: undefined,\n            UTCOffset: undefined,\n            shadows: undefined,\n          })\n\n          // Update the selection highlights\n          const { selection } = store.getState()\n        })\n    }\n\n    default: {\n      next(action)\n      break\n    }\n  }\n\n  return Promise.resolve()\n}\n\nexport default arcgisMiddleWare"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,MAAM,MAAM,4BAA4B;AAC/C,OAAOC,iBAAiB,MAAM,uCAAuC;AACrE,OAAOC,UAAU,MAAM,gCAAgC;AAEvD,SACEC,UAAU,QACL,2BAA2B;AAElC,MAAMC,MAAM,GAAG,CAAC,CAAC;AACjBC,MAAM,CAACD,MAAM,GAAGA,MAAM;;AAEtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAME,gBAAgB,GAAGC,KAAK,IAAIC,IAAI,IAAKC,MAAM,IAAK;EACpD,QAAQA,MAAM,CAACC,IAAI;IACjB;;IAEA,KAAKP,UAAU;MAAE;QACf,IAAI,CAACM,MAAM,CAACE,EAAE,IAAI,CAACF,MAAM,CAACG,SAAS,EAAE;;QAErC;QACA,IAAIR,MAAM,CAACQ,SAAS,EAAE;UACpBH,MAAM,CAACG,SAAS,CAACC,WAAW,CAACT,MAAM,CAACQ,SAAS,CAAC;UAC9C;QACF;;QAEA;QACAR,MAAM,CAACQ,SAAS,GAAGE,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;QAChDN,MAAM,CAACG,SAAS,CAACC,WAAW,CAACT,MAAM,CAACQ,SAAS,CAAC;;QAE9C;QACA,MAAMI,MAAM,GAAG,IAAIhB,MAAM,EAAE;QAC3B,MAAMiB,WAAW,GAAG,IAAIhB,iBAAiB,CAAC;UACxCiB,KAAK,EAAE,QAAQ,GAAG,SAAS;UAAC;UAC5BC,SAAS,EAAE,MAAM;UACjBC,GAAG,EAAE;QACP,CAAC,CAAC;QACF,IAAIC,YAAY,GAAGL,MAAM,CAACM,UAAU,CAACL,WAAW,CAAC;;QAEjD;QACA,OAAOI,YAAY,CAChBE,IAAI,CAAC,MAAM;UAEVf,IAAI,CAAC;YAAE,GAAGC,MAAM;YAAEe,IAAI,EAAEH,YAAY,CAACnB,UAAU,CAACuB;UAAM,CAAC,CAAC;UAExD,OAAOrB,MAAM,CAACsB,SAAS,CAACC,aAAa,EAAE;QACzC,CAAC,CAAC,CACDJ,IAAI,CAAC,MAAM;UACV;UACA,MAAMK,IAAI,GAAG,IAAIC,IAAI,EAAE;UAEvB,MAAM;YAAEC;UAAY,CAAC,GAAGvB,KAAK,CAACwB,QAAQ,EAAE;UAExCxB,KAAK,CAACyB,QAAQ,CAAC;YACbtB,IAAI,EAAEuB,SAAS;YACfL,IAAI,EAAEK,SAAS;YACfC,SAAS,EAAED,SAAS;YACpBE,OAAO,EAAEF;UACX,CAAC,CAAC;;UAEF;UACA,MAAM;YAAEG;UAAU,CAAC,GAAG7B,KAAK,CAACwB,QAAQ,EAAE;QACxC,CAAC,CAAC;MACN;IAEA;MAAS;QACPvB,IAAI,CAACC,MAAM,CAAC;QACZ;MACF;EAAC;EAGH,OAAO4B,OAAO,CAACC,OAAO,EAAE;AAC1B,CAAC;AAED,eAAehC,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}