{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Error.js\";\nimport has from \"../../../../../core/has.js\";\nimport e from \"../../../../../core/Logger.js\";\nimport { clamp as i } from \"../../../../../core/mathUtils.js\";\nimport { isNone as s, isSome as r, mapMany as a, forEachSome as n, applySome as o, unwrap as h } from \"../../../../../core/maybe.js\";\nimport { createResolver as l, isAbortError as u } from \"../../../../../core/promiseUtils.js\";\nimport { diff as d } from \"../../../../../core/accessorSupport/diffUtils.js\";\nimport c from \"../../../../../layers/support/FieldsIndex.js\";\nimport { MAX_FILTERS as p, HIGHLIGHT_FLAG as g, ATTRIBUTE_DATA_VV as _, NAN_MAGIC_NUMBER as f, ATTRIBUTE_DATA_ANIMATION as y, ATTRIBUTE_DATA_GPGPU as m } from \"../../../engine/webgl/definitions.js\";\nimport { DISPLAY_ID_TYPE_AGGREGATE as b, DISPLAY_ID_TYPE_FEATURE as x, getDisplayIdTexel as S, getDisplayIdType as T, getDisplayIdFilterMask as z } from \"../../../engine/webgl/DisplayId.js\";\nimport { getPixelArrayCtor as A } from \"../../../engine/webgl/Utils.js\";\nimport { createDebugLogger as E, DEBUG_ATTR_UPDATES as U } from \"../../../engine/webgl/util/debug.js\";\nimport { getVisualVariableSizeValueRepresentationRatio as w } from \"../tileRenderers/support/visualVariablesUtils.js\";\nimport { PixelType as D } from \"../../../../webgl/enums.js\";\nconst k = e.getLogger(\"esri.views.layers.2d.features.support.AttributeStore\"),\n  F = E(U, k),\n  I = {\n    sharedArrayBuffer: has(\"esri-shared-array-buffer\"),\n    atomics: has(\"esri-atomics\")\n  };\nfunction B(t, e) {\n  return i => e(t(i));\n}\nclass C {\n  constructor(t, e, i, s) {\n    this.size = 0, this.texelSize = 4, this.dirtyStart = 0, this.dirtyEnd = 0;\n    const {\n      pixelType: r,\n      layout: a,\n      textureOnly: n\n    } = s;\n    this.textureOnly = n || !1, this.pixelType = r, this._ctype = e, this.layout = a, this._resetRange(), this._shared = t, this.size = i, n || (this.data = this._initData(r, i, t, e));\n  }\n  get buffer() {\n    return o(this.data, t => t.buffer);\n  }\n  unsetComponentAllTexels(t, e) {\n    const i = h(this.data);\n    for (let s = 0; s < this.size * this.size; s++) i[s * this.texelSize + t] &= ~e;\n    this.dirtyStart = 0, this.dirtyEnd = this.size * this.size - 1;\n  }\n  setComponentAllTexels(t, e) {\n    const i = h(this.data);\n    for (let s = 0; s < this.size * this.size; s++) i[s * this.texelSize + t] |= 255 & e;\n    this.dirtyStart = 0, this.dirtyEnd = this.size * this.size - 1;\n  }\n  setComponent(t, e, i) {\n    const s = h(this.data);\n    for (const r of i) s[r * this.texelSize + t] |= e, this.dirtyStart = Math.min(this.dirtyStart, r), this.dirtyEnd = Math.max(this.dirtyEnd, r);\n  }\n  setComponentTexel(t, e, i) {\n    h(this.data)[i * this.texelSize + t] |= e, this.dirtyStart = Math.min(this.dirtyStart, i), this.dirtyEnd = Math.max(this.dirtyEnd, i);\n  }\n  unsetComponentTexel(t, e, i) {\n    h(this.data)[i * this.texelSize + t] &= ~e, this.dirtyStart = Math.min(this.dirtyStart, i), this.dirtyEnd = Math.max(this.dirtyEnd, i);\n  }\n  getData(t, e) {\n    const i = S(t);\n    return h(this.data)[i * this.texelSize + e];\n  }\n  setData(t, e, i) {\n    const r = S(t),\n      a = 1 << e;\n    0 != (this.layout & a) ? s(this.data) || (this.data[r * this.texelSize + e] = i, this.dirtyStart = Math.min(this.dirtyStart, r), this.dirtyEnd = Math.max(this.dirtyEnd, r)) : k.error(\"mapview-attributes-store\", \"Tried to set a value for a texel's readonly component\");\n  }\n  lock() {\n    this.pixelType === D.UNSIGNED_BYTE && this._shared && I.atomics && \"local\" !== this._ctype && Atomics.store(this.data, 0, 1);\n  }\n  unlock() {\n    this.pixelType === D.UNSIGNED_BYTE && this._shared && I.atomics && \"local\" !== this._ctype && Atomics.store(this.data, 0, 0);\n  }\n  expand(t) {\n    if (this.size = t, !this.textureOnly) {\n      const e = this._initData(this.pixelType, t, this._shared, this._ctype),\n        i = h(this.data);\n      e.set(i), this.data = e;\n    }\n  }\n  toMessage() {\n    const t = this.dirtyStart,\n      e = this.dirtyEnd,\n      i = this.texelSize;\n    if (t > e) return null;\n    this._resetRange();\n    const s = !(this._shared || \"local\" === this._ctype),\n      r = this.pixelType,\n      a = this.layout,\n      n = h(this.data);\n    return {\n      start: t,\n      end: e,\n      data: s && n.slice(t * i, (e + 1) * i) || null,\n      pixelType: r,\n      layout: a\n    };\n  }\n  _initData(t, e, i, s) {\n    const r = i && \"local\" !== s ? SharedArrayBuffer : ArrayBuffer,\n      a = A(t),\n      n = new a(new r(e * e * 4 * a.BYTES_PER_ELEMENT));\n    for (let o = 0; o < n.length; o += 4) n[o + 1] = 255;\n    return n;\n  }\n  _resetRange() {\n    this.dirtyStart = 2147483647, this.dirtyEnd = 0;\n  }\n}\nclass M {\n  constructor(t, e) {\n    let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : () => {};\n    this._client = t, this.config = e, this._notifyChange = i, this._blocks = new Array(), this._filters = new Array(p), this._attributeComputeInfo = null, this._targetType = 0, this._abortController = new AbortController(), this._hasScaleExpr = !1, this._size = 32, this._nextUpdate = null, this._currUpdate = null, this._idsToHighlight = new Set();\n    const s = e.supportsTextureFloat ? D.FLOAT : D.UNSIGNED_BYTE;\n    F(`Creating AttributeStore ${I.sharedArrayBuffer ? \"with\" : \"without\"} shared memory`), this._blockDescriptors = [{\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 1\n    }, {\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 15,\n      textureOnly: !0\n    }, {\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 15,\n      textureOnly: !0\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }], this._blocks = this._blockDescriptors.map(() => null);\n  }\n  destroy() {\n    this._abortController.abort();\n  }\n  get hasScaleExpr() {\n    return this._hasScaleExpr;\n  }\n  get _signal() {\n    return this._abortController.signal;\n  }\n  get hasHighlight() {\n    return this._idsToHighlight.size > 0;\n  }\n  isUpdating() {\n    return !!this._currUpdate || !!this._nextUpdate;\n  }\n  update(t, e) {\n    this.config = e;\n    const i = e.schema.processors[0].storage,\n      a = d(this._schema, i);\n    if ((t.targets.feature || t.targets.aggregate) && (t.storage.data = !0), a && (has(\"esri-2d-update-debug\") && console.debug(\"Applying Update - AttributeStore:\", a), t.storage.data = !0, this._schema = i, this._attributeComputeInfo = null, !s(i))) {\n      switch (i.target) {\n        case \"feature\":\n          this._targetType = x;\n          break;\n        case \"aggregate\":\n          this._targetType = b;\n      }\n      if (\"subtype\" === i.type) {\n        this._attributeComputeInfo = {\n          isSubtype: !0,\n          subtypeField: i.subtypeField,\n          map: new Map()\n        };\n        for (const t in i.mapping) {\n          const e = i.mapping[t];\n          if (r(e) && r(e.vvMapping)) for (const i of e.vvMapping) this._bindAttribute(i, parseInt(t, 10));\n        }\n      } else {\n        if (this._attributeComputeInfo = {\n          isSubtype: !1,\n          map: new Map()\n        }, r(i.vvMapping)) for (const t of i.vvMapping) this._bindAttribute(t);\n        if (r(i.attributeMapping)) for (const t of i.attributeMapping) this._bindAttribute(t);\n      }\n    }\n  }\n  onTileData(t, e) {\n    if (s(e.addOrUpdate)) return;\n    const i = e.addOrUpdate.getCursor();\n    for (; i.next();) {\n      const t = i.getDisplayId();\n      this.setAttributeData(t, i);\n    }\n  }\n  async setHighlight(t, e) {\n    const i = 1,\n      s = this._getBlock(0),\n      r = e.map(t => S(t));\n    s.lock(), s.unsetComponentAllTexels(0, i), s.setComponent(0, i, r), s.unlock(), this._idsToHighlight.clear();\n    for (const a of t) this._idsToHighlight.add(a);\n    await this.sendUpdates();\n  }\n  async updateFilters(t, e, i) {\n    const {\n        service: s,\n        spatialReference: r\n      } = i,\n      {\n        filters: a\n      } = e,\n      n = a.map((t, e) => this._updateFilter(t, e, s, r));\n    (await Promise.all(n)).some(t => t) && (t.storage.filters = !0, has(\"esri-2d-update-debug\") && console.debug(\"Applying Update - AttributeStore:\", \"Filters changed\"));\n  }\n  setData(t, e, i, s) {\n    const r = S(t);\n    this._ensureSizeForTexel(r), this._getBlock(e).setData(t, i, s);\n  }\n  getData(t, e, i) {\n    return this._getBlock(e).getData(t, i);\n  }\n  getHighlightFlag(t) {\n    return this._idsToHighlight.has(t) ? g : 0;\n  }\n  unsetAttributeData(t) {\n    const e = S(t);\n    this._getBlock(0).setData(e, 0, 0);\n  }\n  setAttributeData(t, e) {\n    const s = S(t);\n    if (this._ensureSizeForTexel(s), this._getBlock(0).setData(s, 0, this.getFilterFlags(e)), this._targetType !== T(t)) return;\n    const r = this._attributeComputeInfo,\n      a = this.config.supportsTextureFloat ? 1 : 2,\n      n = 4;\n    let o = null;\n    r && (o = r.isSubtype ? r.map.get(e.readAttribute(r.subtypeField)) : r.map, o && o.size && o.forEach((t, r) => {\n      const o = r * a % n,\n        h = Math.floor(r * a / n),\n        l = this._getBlock(h + _),\n        u = t(e);\n      if (this.config.supportsTextureFloat) l.setData(s, o, u);else if (u === f) l.setData(s, o, 255), l.setData(s, o + 1, 255);else {\n        const t = i(Math.round(u), -32767, 32766) + 32768,\n          e = 255 & t,\n          r = (65280 & t) >> 8;\n        l.setData(s, o, e), l.setData(s, o + 1, r);\n      }\n    }));\n  }\n  sendUpdates() {\n    if (has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate\"), this._notifyChange(), this._nextUpdate) return this._nextUpdate.promise;\n    if (this._currUpdate) return this._nextUpdate = l(), this._nextUpdate.promise;\n    const e = {\n      blocks: this._blocks.map(t => r(t) ? t.toMessage() : null)\n    };\n    return this._currUpdate = this._createResources().then(() => {\n      const t = () => {\n        if (this._currUpdate = null, this._nextUpdate) {\n          const t = this._nextUpdate;\n          this._nextUpdate = null, this.sendUpdates().then(() => t.resolve());\n        } else has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate::No additional updates queued\");\n        this._notifyChange();\n      };\n      has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate::client.update\");\n      const i = this._client.update(e, this._signal).then(t).catch(t);\n      return this._client.render(this._signal), i;\n    }).catch(e => {\n      if (u(e)) return this._createResourcesPromise = null, this._createResources();\n      this._notifyChange(), k.error(new t(\"mapview-attribute-store\", \"Encountered an error during client update\", e));\n    }), this._currUpdate;\n  }\n  _ensureSizeForTexel(t) {\n    for (; t >= this._size * this._size;) if (this._expand()) return;\n  }\n  _bindAttribute(t, e) {\n    function i() {\n      const {\n        normalizationField: e\n      } = t;\n      return e ? i => {\n        const s = i.readAttribute(e);\n        if (!s) return null;\n        return i.readAttribute(t.field) / s;\n      } : e => e.readAttribute(t.field);\n    }\n    function s() {\n      return t.normalizationField && k.warn(\"mapview-arcade\", \"Ignoring normalizationField specified with an arcade expression which is not supported.\"), e => e.getComputedNumericAtIndex(t.fieldIndex);\n    }\n    let r;\n    if (null != t.fieldIndex) r = s();else {\n      if (!t.field) return;\n      r = i();\n    }\n    const {\n      valueRepresentation: a\n    } = t;\n    if (a) {\n      r = B(r, t => w(t, a));\n    }\n    const n = t => null === t || isNaN(t) || t === 1 / 0 || t === -1 / 0 ? f : t,\n      o = this._attributeComputeInfo;\n    if (o.isSubtype) {\n      const i = o.map.get(e) ?? new Map();\n      i.set(t.binding, B(r, n)), o.map.set(e, i);\n    } else o.map.set(t.binding, B(r, n));\n  }\n  _createResources() {\n    if (r(this._createResourcesPromise)) return this._createResourcesPromise;\n    this._getBlock(y), this._getBlock(m), F(\"Initializing AttributeStore\");\n    const e = {\n        shared: I.sharedArrayBuffer && !(\"local\" === this._client.type),\n        size: this._size,\n        blocks: a(this._blocks, t => ({\n          textureOnly: t.textureOnly,\n          buffer: t.buffer,\n          pixelType: t.pixelType\n        }))\n      },\n      i = this._client.initialize(e, this._signal).catch(e => {\n        u(e) ? this._createResourcesPromise = null : k.error(new t(\"mapview-attribute-store\", \"Encountered an error during client initialization\", e));\n      });\n    return this._createResourcesPromise = i, i.then(() => s(this._createResourcesPromise) ? this._createResources() : void 0), i;\n  }\n  _getBlock(t) {\n    const e = this._blocks[t];\n    if (r(e)) return e;\n    F(`Initializing AttributeBlock at index ${t}`);\n    const i = I.sharedArrayBuffer,\n      s = this._client.type,\n      a = new C(i, s, this._size, this._blockDescriptors[t]);\n    return this._blocks[t] = a, this._createResourcesPromise = null, a;\n  }\n  _expand() {\n    if (this._size < this.config.maxTextureSize) {\n      const t = this._size <<= 1;\n      return F(\"Expanding block size to\", t, this._blocks), n(this._blocks, e => e.expand(t)), this._createResourcesPromise = null, this._size = t, 0;\n    }\n    return k.error(new t(\"mapview-limitations\", \"Maximum number of onscreen features exceeded.\")), -1;\n  }\n  async _updateFilter(t, e, i, a) {\n    const n = this._filters[e],\n      o = r(n) && n.hash;\n    if (!n && !t) return !1;\n    if (o === JSON.stringify(t)) return !1;\n    if (s(t)) {\n      if (!n) return !1;\n      const t = 1 << e + 1,\n        i = this._getBlock(0);\n      return this._filters[e] = null, i.setComponentAllTexels(0, t), this.sendUpdates(), !0;\n    }\n    const h = await this._getFilter(e, i);\n    return await h.update(t, a), !0;\n  }\n  async _getFilter(t, e) {\n    const i = this._filters[t];\n    if (r(i)) return i;\n    const {\n        default: s\n      } = await import(\"./FeatureFilter.js\"),\n      a = new s({\n        geometryType: e.geometryType,\n        hasM: !1,\n        hasZ: !1,\n        timeInfo: e.timeInfo,\n        fieldsIndex: new c(e.fields)\n      });\n    return this._filters[t] = a, a;\n  }\n  isVisible(t) {\n    return !!(2 & this._getBlock(0).getData(t, 0));\n  }\n  getFilterFlags(t) {\n    let e = 0;\n    const i = z(t.getDisplayId());\n    for (let a = 0; a < this._filters.length; a++) {\n      const r = !!(i & 1 << a),\n        n = this._filters[a];\n      e |= (!r || s(n) || n.check(t) ? 1 : 0) << a;\n    }\n    let r = 0;\n    if (this._idsToHighlight.size) {\n      const e = t.getObjectId();\n      r = this.getHighlightFlag(e);\n    }\n    return e << 1 | r;\n  }\n}\nexport { M as default };","map":{"version":3,"names":["t","has","e","clamp","i","isNone","s","isSome","r","mapMany","a","forEachSome","n","applySome","o","unwrap","h","createResolver","l","isAbortError","u","diff","d","c","MAX_FILTERS","p","HIGHLIGHT_FLAG","g","ATTRIBUTE_DATA_VV","_","NAN_MAGIC_NUMBER","f","ATTRIBUTE_DATA_ANIMATION","y","ATTRIBUTE_DATA_GPGPU","m","DISPLAY_ID_TYPE_AGGREGATE","b","DISPLAY_ID_TYPE_FEATURE","x","getDisplayIdTexel","S","getDisplayIdType","T","getDisplayIdFilterMask","z","getPixelArrayCtor","A","createDebugLogger","E","DEBUG_ATTR_UPDATES","U","getVisualVariableSizeValueRepresentationRatio","w","PixelType","D","k","getLogger","F","I","sharedArrayBuffer","atomics","B","C","constructor","size","texelSize","dirtyStart","dirtyEnd","pixelType","layout","textureOnly","_ctype","_resetRange","_shared","data","_initData","buffer","unsetComponentAllTexels","setComponentAllTexels","setComponent","Math","min","max","setComponentTexel","unsetComponentTexel","getData","setData","error","lock","UNSIGNED_BYTE","Atomics","store","unlock","expand","set","toMessage","start","end","slice","SharedArrayBuffer","ArrayBuffer","BYTES_PER_ELEMENT","length","M","arguments","undefined","_client","config","_notifyChange","_blocks","Array","_filters","_attributeComputeInfo","_targetType","_abortController","AbortController","_hasScaleExpr","_size","_nextUpdate","_currUpdate","_idsToHighlight","Set","supportsTextureFloat","FLOAT","_blockDescriptors","map","destroy","abort","hasScaleExpr","_signal","signal","hasHighlight","isUpdating","update","schema","processors","storage","_schema","targets","feature","aggregate","console","debug","target","type","isSubtype","subtypeField","Map","mapping","vvMapping","_bindAttribute","parseInt","attributeMapping","onTileData","addOrUpdate","getCursor","next","getDisplayId","setAttributeData","setHighlight","_getBlock","clear","add","sendUpdates","updateFilters","service","spatialReference","filters","_updateFilter","Promise","all","some","_ensureSizeForTexel","getHighlightFlag","unsetAttributeData","getFilterFlags","get","readAttribute","forEach","floor","round","promise","blocks","_createResources","then","resolve","catch","render","_createResourcesPromise","_expand","normalizationField","field","warn","getComputedNumericAtIndex","fieldIndex","valueRepresentation","isNaN","binding","shared","initialize","maxTextureSize","hash","JSON","stringify","_getFilter","default","geometryType","hasM","hasZ","timeInfo","fieldsIndex","fields","isVisible","check","getObjectId"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/support/AttributeStore.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import has from\"../../../../../core/has.js\";import e from\"../../../../../core/Logger.js\";import{clamp as i}from\"../../../../../core/mathUtils.js\";import{isNone as s,isSome as r,mapMany as a,forEachSome as n,applySome as o,unwrap as h}from\"../../../../../core/maybe.js\";import{createResolver as l,isAbortError as u}from\"../../../../../core/promiseUtils.js\";import{diff as d}from\"../../../../../core/accessorSupport/diffUtils.js\";import c from\"../../../../../layers/support/FieldsIndex.js\";import{MAX_FILTERS as p,HIGHLIGHT_FLAG as g,ATTRIBUTE_DATA_VV as _,NAN_MAGIC_NUMBER as f,ATTRIBUTE_DATA_ANIMATION as y,ATTRIBUTE_DATA_GPGPU as m}from\"../../../engine/webgl/definitions.js\";import{DISPLAY_ID_TYPE_AGGREGATE as b,DISPLAY_ID_TYPE_FEATURE as x,getDisplayIdTexel as S,getDisplayIdType as T,getDisplayIdFilterMask as z}from\"../../../engine/webgl/DisplayId.js\";import{getPixelArrayCtor as A}from\"../../../engine/webgl/Utils.js\";import{createDebugLogger as E,DEBUG_ATTR_UPDATES as U}from\"../../../engine/webgl/util/debug.js\";import{getVisualVariableSizeValueRepresentationRatio as w}from\"../tileRenderers/support/visualVariablesUtils.js\";import{PixelType as D}from\"../../../../webgl/enums.js\";const k=e.getLogger(\"esri.views.layers.2d.features.support.AttributeStore\"),F=E(U,k),I={sharedArrayBuffer:has(\"esri-shared-array-buffer\"),atomics:has(\"esri-atomics\")};function B(t,e){return i=>e(t(i))}class C{constructor(t,e,i,s){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:r,layout:a,textureOnly:n}=s;this.textureOnly=n||!1,this.pixelType=r,this._ctype=e,this.layout=a,this._resetRange(),this._shared=t,this.size=i,n||(this.data=this._initData(r,i,t,e))}get buffer(){return o(this.data,(t=>t.buffer))}unsetComponentAllTexels(t,e){const i=h(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=h(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const s=h(this.data);for(const r of i)s[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){h(this.data)[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){h(this.data)[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=S(t);return h(this.data)[i*this.texelSize+e]}setData(t,e,i){const r=S(t),a=1<<e;0!=(this.layout&a)?s(this.data)||(this.data[r*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)):k.error(\"mapview-attributes-store\",\"Tried to set a value for a texel's readonly component\")}lock(){this.pixelType===D.UNSIGNED_BYTE&&this._shared&&I.atomics&&\"local\"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===D.UNSIGNED_BYTE&&this._shared&&I.atomics&&\"local\"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t,this._shared,this._ctype),i=h(this.data);e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const s=!(this._shared||\"local\"===this._ctype),r=this.pixelType,a=this.layout,n=h(this.data);return{start:t,end:e,data:s&&n.slice(t*i,(e+1)*i)||null,pixelType:r,layout:a}}_initData(t,e,i,s){const r=i&&\"local\"!==s?SharedArrayBuffer:ArrayBuffer,a=A(t),n=new a(new r(e*e*4*a.BYTES_PER_ELEMENT));for(let o=0;o<n.length;o+=4)n[o+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class M{constructor(t,e,i=(()=>{})){this._client=t,this.config=e,this._notifyChange=i,this._blocks=new Array,this._filters=new Array(p),this._attributeComputeInfo=null,this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._nextUpdate=null,this._currUpdate=null,this._idsToHighlight=new Set;const s=e.supportsTextureFloat?D.FLOAT:D.UNSIGNED_BYTE;F(`Creating AttributeStore ${I.sharedArrayBuffer?\"with\":\"without\"} shared memory`),this._blockDescriptors=[{pixelType:D.UNSIGNED_BYTE,layout:1},{pixelType:D.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:D.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:s,layout:15},{pixelType:s,layout:15},{pixelType:s,layout:15},{pixelType:s,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}isUpdating(){return!!this._currUpdate||!!this._nextUpdate}update(t,e){this.config=e;const i=e.schema.processors[0].storage,a=d(this._schema,i);if((t.targets.feature||t.targets.aggregate)&&(t.storage.data=!0),a&&(has(\"esri-2d-update-debug\")&&console.debug(\"Applying Update - AttributeStore:\",a),t.storage.data=!0,this._schema=i,this._attributeComputeInfo=null,!s(i))){switch(i.target){case\"feature\":this._targetType=x;break;case\"aggregate\":this._targetType=b}if(\"subtype\"===i.type){this._attributeComputeInfo={isSubtype:!0,subtypeField:i.subtypeField,map:new Map};for(const t in i.mapping){const e=i.mapping[t];if(r(e)&&r(e.vvMapping))for(const i of e.vvMapping)this._bindAttribute(i,parseInt(t,10))}}else{if(this._attributeComputeInfo={isSubtype:!1,map:new Map},r(i.vvMapping))for(const t of i.vvMapping)this._bindAttribute(t);if(r(i.attributeMapping))for(const t of i.attributeMapping)this._bindAttribute(t)}}}onTileData(t,e){if(s(e.addOrUpdate))return;const i=e.addOrUpdate.getCursor();for(;i.next();){const t=i.getDisplayId();this.setAttributeData(t,i)}}async setHighlight(t,e){const i=1,s=this._getBlock(0),r=e.map((t=>S(t)));s.lock(),s.unsetComponentAllTexels(0,i),s.setComponent(0,i,r),s.unlock(),this._idsToHighlight.clear();for(const a of t)this._idsToHighlight.add(a);await this.sendUpdates()}async updateFilters(t,e,i){const{service:s,spatialReference:r}=i,{filters:a}=e,n=a.map(((t,e)=>this._updateFilter(t,e,s,r)));(await Promise.all(n)).some((t=>t))&&(t.storage.filters=!0,has(\"esri-2d-update-debug\")&&console.debug(\"Applying Update - AttributeStore:\",\"Filters changed\"))}setData(t,e,i,s){const r=S(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,s)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlag(t){return this._idsToHighlight.has(t)?g:0}unsetAttributeData(t){const e=S(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e){const s=S(t);if(this._ensureSizeForTexel(s),this._getBlock(0).setData(s,0,this.getFilterFlags(e)),this._targetType!==T(t))return;const r=this._attributeComputeInfo,a=this.config.supportsTextureFloat?1:2,n=4;let o=null;r&&(o=r.isSubtype?r.map.get(e.readAttribute(r.subtypeField)):r.map,o&&o.size&&o.forEach(((t,r)=>{const o=r*a%n,h=Math.floor(r*a/n),l=this._getBlock(h+_),u=t(e);if(this.config.supportsTextureFloat)l.setData(s,o,u);else if(u===f)l.setData(s,o,255),l.setData(s,o+1,255);else{const t=i(Math.round(u),-32767,32766)+32768,e=255&t,r=(65280&t)>>8;l.setData(s,o,e),l.setData(s,o+1,r)}})))}sendUpdates(){if(has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate\"),this._notifyChange(),this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l(),this._nextUpdate.promise;const e={blocks:this._blocks.map((t=>r(t)?t.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const t=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>t.resolve()))}else has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate::No additional updates queued\");this._notifyChange()};has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate::client.update\");const i=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),i})).catch((e=>{if(u(e))return this._createResourcesPromise=null,this._createResources();this._notifyChange(),k.error(new t(\"mapview-attribute-store\",\"Encountered an error during client update\",e))})),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t,e){function i(){const{normalizationField:e}=t;return e?i=>{const s=i.readAttribute(e);if(!s)return null;return i.readAttribute(t.field)/s}:e=>e.readAttribute(t.field)}function s(){return t.normalizationField&&k.warn(\"mapview-arcade\",\"Ignoring normalizationField specified with an arcade expression which is not supported.\"),e=>e.getComputedNumericAtIndex(t.fieldIndex)}let r;if(null!=t.fieldIndex)r=s();else{if(!t.field)return;r=i()}const{valueRepresentation:a}=t;if(a){r=B(r,(t=>w(t,a)))}const n=t=>null===t||isNaN(t)||t===1/0||t===-1/0?f:t,o=this._attributeComputeInfo;if(o.isSubtype){const i=o.map.get(e)??new Map;i.set(t.binding,B(r,n)),o.map.set(e,i)}else o.map.set(t.binding,B(r,n))}_createResources(){if(r(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(y),this._getBlock(m),F(\"Initializing AttributeStore\");const e={shared:I.sharedArrayBuffer&&!(\"local\"===this._client.type),size:this._size,blocks:a(this._blocks,(t=>({textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType})))},i=this._client.initialize(e,this._signal).catch((e=>{u(e)?this._createResourcesPromise=null:k.error(new t(\"mapview-attribute-store\",\"Encountered an error during client initialization\",e))}));return this._createResourcesPromise=i,i.then((()=>s(this._createResourcesPromise)?this._createResources():void 0)),i}_getBlock(t){const e=this._blocks[t];if(r(e))return e;F(`Initializing AttributeBlock at index ${t}`);const i=I.sharedArrayBuffer,s=this._client.type,a=new C(i,s,this._size,this._blockDescriptors[t]);return this._blocks[t]=a,this._createResourcesPromise=null,a}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return F(\"Expanding block size to\",t,this._blocks),n(this._blocks,(e=>e.expand(t))),this._createResourcesPromise=null,this._size=t,0}return k.error(new t(\"mapview-limitations\",\"Maximum number of onscreen features exceeded.\")),-1}async _updateFilter(t,e,i,a){const n=this._filters[e],o=r(n)&&n.hash;if(!n&&!t)return!1;if(o===JSON.stringify(t))return!1;if(s(t)){if(!n)return!1;const t=1<<e+1,i=this._getBlock(0);return this._filters[e]=null,i.setComponentAllTexels(0,t),this.sendUpdates(),!0}const h=await this._getFilter(e,i);return await h.update(t,a),!0}async _getFilter(t,e){const i=this._filters[t];if(r(i))return i;const{default:s}=await import(\"./FeatureFilter.js\"),a=new s({geometryType:e.geometryType,hasM:!1,hasZ:!1,timeInfo:e.timeInfo,fieldsIndex:new c(e.fields)});return this._filters[t]=a,a}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let e=0;const i=z(t.getDisplayId());for(let a=0;a<this._filters.length;a++){const r=!!(i&1<<a),n=this._filters[a];e|=(!r||s(n)||n.check(t)?1:0)<<a}let r=0;if(this._idsToHighlight.size){const e=t.getObjectId();r=this.getHighlightFlag(e)}return e<<1|r}}export{M as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}