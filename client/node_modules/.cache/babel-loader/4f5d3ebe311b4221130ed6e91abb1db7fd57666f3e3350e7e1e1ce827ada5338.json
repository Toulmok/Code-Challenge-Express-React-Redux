{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport i from \"../../../core/Handles.js\";\nimport { destroyMaybe as s, isSome as r } from \"../../../core/maybe.js\";\nimport { watch as o } from \"../../../core/reactiveUtils.js\";\nimport { property as n } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/arrayUtils.js\";\nimport { subclass as l } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { canProjectToWGS84ComparableLonLat as a } from \"../../../geometry/projection.js\";\nimport { equals as c } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { isMars as h, isMoon as p } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { isTiledLayer as d } from \"../../../layers/support/layerUtils.js\";\nimport { ViewingMode as m } from \"../../ViewingMode.js\";\nimport { isProjectableRasterLayer as y, getTiledLayerInfo as u } from \"./terrainUtils.js\";\nimport { TilingScheme as S } from \"./TilingScheme.js\";\nlet g = class extends t {\n  constructor(e) {\n    super(e), this._handles = new i();\n  }\n  initialize() {\n    this._handles.add(this.layers.on(\"change\", () => this._update())), this._handles.add(o(() => this.extentHelper.layerViewsExtent, () => this._setAdHocTilingScheme())), this._update(), this.tilingSchemeLocked || this._setAdHocTilingScheme();\n  }\n  destroy() {\n    this._handles = s(this._handles), this._waitTask = null;\n  }\n  _update() {\n    if (this._waitTask = null, this.tilingSchemeLocked) return;\n    let e;\n    if (this.layers.some(t => !(!d(t) || t.isRejected()) && !(t.isFulfilled() && !f(t, this.viewSpatialReference, this.viewingMode)) && (e = t, !(\"vector-tile\" === t?.type || y(t)))), e) if (e.isResolved()) {\n      const t = u(e, this.viewSpatialReference, this.viewingMode);\n      if (r(t)) {\n        const e = new S(t.tileInfo);\n        this._lockTilingScheme(e);\n      }\n    } else this._updateWhen(e);\n  }\n  _updateWhen(e) {\n    const t = e.when().catch(() => {}).then(() => {\n      t !== this._waitTask || this.destroyed || this._update();\n    });\n    this._waitTask = t;\n  }\n  _lockTilingScheme(e) {\n    if (this.viewingMode === m.Global) {\n      const t = e.levels.length - 1;\n      e.spatialReference.isWebMercator ? e = S.makeWebMercatorAuxiliarySphere(t) : a(e.spatialReference) && (e = S.makeGCSWithTileSize(e.spatialReference, e.pixelSize, t));\n    }\n    this.tilingSchemeLocked = !0, this.tilingScheme = e, this.extentHelper.tilingScheme = this.tilingScheme, this._updateTiledLayerExtent(), this._handles.removeAll(), this._handles.add(o(() => this.extentHelper.tiledLayersExtent, () => this._updateTiledLayerExtent()));\n  }\n  _updateTiledLayerExtent() {\n    this._set(\"extent\", this.extentHelper.tiledLayersExtent);\n  }\n  _setAdHocTilingScheme() {\n    if (this.viewingMode === m.Global) {\n      const e = this.extentHelper.viewSpatialReference,\n        t = a(e) || h(e) || p(e);\n      e.isWebMercator ? this.tilingScheme = S.WebMercatorAuxiliarySphere : t && (this.tilingScheme = S.makeGCSWithTileSize(e, 256)), this._set(\"extent\", this.extentHelper.layerViewsExtent);\n    } else {\n      const e = this.extentHelper.layerViewsExtent;\n      r(e) && !c(e, this.extent) && (this.tilingScheme = S.fromExtent(e, this.extentHelper.viewSpatialReference), this._set(\"extent\", e));\n    }\n  }\n  get test() {\n    return {\n      lockTilingScheme: e => this._lockTilingScheme(e),\n      done: !this._waitTask\n    };\n  }\n};\nfunction f(e, t, i) {\n  return r(u(e, t, i));\n}\ne([n()], g.prototype, \"tilingScheme\", void 0), e([n({\n  readOnly: !0\n})], g.prototype, \"extent\", void 0), e([n({\n  value: !1\n})], g.prototype, \"tilingSchemeLocked\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"viewSpatialReference\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"layers\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"extentHelper\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"viewingMode\", void 0), g = e([l(\"esri.views.3d.terrain.TilingSchemeLogic\")], g);\nexport { g as TilingSchemeLogic };","map":{"version":3,"names":["_","e","t","i","destroyMaybe","s","isSome","r","watch","o","property","n","subclass","l","canProjectToWGS84ComparableLonLat","a","equals","c","isMars","h","isMoon","p","isTiledLayer","d","ViewingMode","m","isProjectableRasterLayer","y","getTiledLayerInfo","u","TilingScheme","S","g","constructor","_handles","initialize","add","layers","on","_update","extentHelper","layerViewsExtent","_setAdHocTilingScheme","tilingSchemeLocked","destroy","_waitTask","some","isRejected","isFulfilled","f","viewSpatialReference","viewingMode","type","isResolved","tileInfo","_lockTilingScheme","_updateWhen","when","catch","then","destroyed","Global","levels","length","spatialReference","isWebMercator","makeWebMercatorAuxiliarySphere","makeGCSWithTileSize","pixelSize","tilingScheme","_updateTiledLayerExtent","removeAll","tiledLayersExtent","_set","WebMercatorAuxiliarySphere","extent","fromExtent","test","lockTilingScheme","done","prototype","readOnly","value","constructOnly","TilingSchemeLogic"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/terrain/TilingSchemeLogic.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import i from\"../../../core/Handles.js\";import{destroyMaybe as s,isSome as r}from\"../../../core/maybe.js\";import{watch as o}from\"../../../core/reactiveUtils.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{canProjectToWGS84ComparableLonLat as a}from\"../../../geometry/projection.js\";import{equals as c}from\"../../../geometry/support/aaBoundingRect.js\";import{isMars as h,isMoon as p}from\"../../../geometry/support/spatialReferenceUtils.js\";import{isTiledLayer as d}from\"../../../layers/support/layerUtils.js\";import{ViewingMode as m}from\"../../ViewingMode.js\";import{isProjectableRasterLayer as y,getTiledLayerInfo as u}from\"./terrainUtils.js\";import{TilingScheme as S}from\"./TilingScheme.js\";let g=class extends t{constructor(e){super(e),this._handles=new i}initialize(){this._handles.add(this.layers.on(\"change\",(()=>this._update()))),this._handles.add(o((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=s(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!d(t)||t.isRejected())&&(!(t.isFulfilled()&&!f(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!(\"vector-tile\"===t?.type||y(t)))))),e)if(e.isResolved()){const t=u(e,this.viewSpatialReference,this.viewingMode);if(r(t)){const e=new S(t.tileInfo);this._lockTilingScheme(e)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===m.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=S.makeWebMercatorAuxiliarySphere(t):a(e.spatialReference)&&(e=S.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(o((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set(\"extent\",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===m.Global){const e=this.extentHelper.viewSpatialReference,t=a(e)||h(e)||p(e);e.isWebMercator?this.tilingScheme=S.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=S.makeGCSWithTileSize(e,256)),this._set(\"extent\",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;r(e)&&!c(e,this.extent)&&(this.tilingScheme=S.fromExtent(e,this.extentHelper.viewSpatialReference),this._set(\"extent\",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function f(e,t,i){return r(u(e,t,i))}e([n()],g.prototype,\"tilingScheme\",void 0),e([n({readOnly:!0})],g.prototype,\"extent\",void 0),e([n({value:!1})],g.prototype,\"tilingSchemeLocked\",void 0),e([n({constructOnly:!0})],g.prototype,\"viewSpatialReference\",void 0),e([n({constructOnly:!0})],g.prototype,\"layers\",void 0),e([n({constructOnly:!0})],g.prototype,\"extentHelper\",void 0),e([n({constructOnly:!0})],g.prototype,\"viewingMode\",void 0),g=e([l(\"esri.views.3d.terrain.TilingSchemeLogic\")],g);export{g as TilingSchemeLogic};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}