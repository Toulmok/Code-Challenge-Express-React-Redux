{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport s from \"../../../core/Logger.js\";\nimport { unwrapOrThrow as e, isSome as t } from \"../../../core/maybe.js\";\nimport o from \"../../../core/PooledArray.js\";\nimport { WorkerHandle as r } from \"../../../core/workers/WorkerHandle.js\";\nimport { canProjectWithoutEngine as p, projectVectorToVector as h } from \"../../../geometry/projection.js\";\nimport { ModificationType as i } from \"../../../libs/i3s/enums.js\";\nclass u extends r {\n  constructor(s) {\n    super(\"SceneLayerWorker\", \"process\", {\n      process: s => [s.geometryBuffer]\n    }, s, {\n      hasInitialize: !0\n    });\n  }\n  setModifications(s, e, t, o) {\n    const r = {\n      context: s,\n      modifications: c(e, t, o),\n      isGeodetic: o.isGeographic\n    };\n    this.broadcast(r, \"setModifications\");\n  }\n  setLegacySchema(s, e) {\n    const t = JSON.stringify(e);\n    this.broadcast({\n      context: s,\n      jsonSchema: t\n    }, \"setLegacySchema\");\n  }\n  destroyContext(s) {\n    return this.broadcast(s, \"destroyContext\");\n  }\n}\nconst n = new o({\n    deallocator: null\n  }),\n  a = [0, 0, 0];\nfunction c(o, r, u) {\n  n.clear();\n  let c = 1 / 0,\n    f = 1 / 0,\n    m = -1 / 0,\n    l = -1 / 0,\n    d = !1;\n  for (const t of r) {\n    const o = \"clip\" === t.type ? i.Inside : \"mask\" === t.type ? i.Outside : i.Replace,\n      r = e(t.geometry, \"modification.geometry\");\n    let g = s => s;\n    if (r.spatialReference) {\n      if (!p(r.spatialReference, u)) {\n        s.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\").warn(\"Can't project modification polygon into layer spatial reference, ignoring modification\");\n        continue;\n      }\n      g = s => (h(s, r.spatialReference, a, u), a);\n    } else r.hasZ || (a[2] = 0, g = s => (a[0] = s[0], a[1] = s[1], a));\n    d = d || o === i.Outside, n.push(o), n.push(r.rings.length);\n    for (const s of r.rings) {\n      n.push(s.length);\n      for (const e of s) {\n        const s = g(e);\n        n.push(s[0]), n.push(s[1]), n.push(s[2]), c = Math.min(c, s[0]), f = Math.min(f, s[1]), m = Math.max(m, s[0]), l = Math.max(l, s[1]);\n      }\n    }\n  }\n  if (t(o)) if (d) {\n    const s = 1e-4;\n    n.push(i.Inside), n.push(2), n.push(4), n.push(c - s), n.push(f - s), n.push(0), n.push(m + s), n.push(f - s), n.push(0), n.push(m + s), n.push(l + s), n.push(0), n.push(c - s), n.push(l + s), n.push(0), n.push(4), n.push(o[0]), n.push(o[1]), n.push(0), n.push(o[2]), n.push(o[1]), n.push(0), n.push(o[2]), n.push(o[3]), n.push(0), n.push(o[0]), n.push(o[3]), n.push(0);\n  } else n.push(i.Outside), n.push(1), n.push(4), n.push(o[0]), n.push(o[1]), n.push(0), n.push(o[2]), n.push(o[1]), n.push(0), n.push(o[2]), n.push(o[3]), n.push(0), n.push(o[0]), n.push(o[3]), n.push(0);\n  n.push(i.Finished);\n  const g = new Float64Array(n.length);\n  for (let s = 0; s < n.length; ++s) g[s] = n.getItemAt(s);\n  return g;\n}\nexport { u as I3SMeshWorkerHandle, c as toWasmModification };","map":{"version":3,"names":["s","unwrapOrThrow","e","isSome","t","o","WorkerHandle","r","canProjectWithoutEngine","p","projectVectorToVector","h","ModificationType","i","u","constructor","process","geometryBuffer","hasInitialize","setModifications","context","modifications","c","isGeodetic","isGeographic","broadcast","setLegacySchema","JSON","stringify","jsonSchema","destroyContext","n","deallocator","a","clear","f","m","l","d","type","Inside","Outside","Replace","geometry","g","spatialReference","getLogger","warn","hasZ","push","rings","length","Math","min","max","Finished","Float64Array","getItemAt","I3SMeshWorkerHandle","toWasmModification"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/layers/I3SMeshWorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport s from\"../../../core/Logger.js\";import{unwrapOrThrow as e,isSome as t}from\"../../../core/maybe.js\";import o from\"../../../core/PooledArray.js\";import{WorkerHandle as r}from\"../../../core/workers/WorkerHandle.js\";import{canProjectWithoutEngine as p,projectVectorToVector as h}from\"../../../geometry/projection.js\";import{ModificationType as i}from\"../../../libs/i3s/enums.js\";class u extends r{constructor(s){super(\"SceneLayerWorker\",\"process\",{process:s=>[s.geometryBuffer]},s,{hasInitialize:!0})}setModifications(s,e,t,o){const r={context:s,modifications:c(e,t,o),isGeodetic:o.isGeographic};this.broadcast(r,\"setModifications\")}setLegacySchema(s,e){const t=JSON.stringify(e);this.broadcast({context:s,jsonSchema:t},\"setLegacySchema\")}destroyContext(s){return this.broadcast(s,\"destroyContext\")}}const n=new o({deallocator:null}),a=[0,0,0];function c(o,r,u){n.clear();let c=1/0,f=1/0,m=-1/0,l=-1/0,d=!1;for(const t of r){const o=\"clip\"===t.type?i.Inside:\"mask\"===t.type?i.Outside:i.Replace,r=e(t.geometry,\"modification.geometry\");let g=s=>s;if(r.spatialReference){if(!p(r.spatialReference,u)){s.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\").warn(\"Can't project modification polygon into layer spatial reference, ignoring modification\");continue}g=s=>(h(s,r.spatialReference,a,u),a)}else r.hasZ||(a[2]=0,g=s=>(a[0]=s[0],a[1]=s[1],a));d=d||o===i.Outside,n.push(o),n.push(r.rings.length);for(const s of r.rings){n.push(s.length);for(const e of s){const s=g(e);n.push(s[0]),n.push(s[1]),n.push(s[2]),c=Math.min(c,s[0]),f=Math.min(f,s[1]),m=Math.max(m,s[0]),l=Math.max(l,s[1])}}}if(t(o))if(d){const s=1e-4;n.push(i.Inside),n.push(2),n.push(4),n.push(c-s),n.push(f-s),n.push(0),n.push(m+s),n.push(f-s),n.push(0),n.push(m+s),n.push(l+s),n.push(0),n.push(c-s),n.push(l+s),n.push(0),n.push(4),n.push(o[0]),n.push(o[1]),n.push(0),n.push(o[2]),n.push(o[1]),n.push(0),n.push(o[2]),n.push(o[3]),n.push(0),n.push(o[0]),n.push(o[3]),n.push(0)}else n.push(i.Outside),n.push(1),n.push(4),n.push(o[0]),n.push(o[1]),n.push(0),n.push(o[2]),n.push(o[1]),n.push(0),n.push(o[2]),n.push(o[3]),n.push(0),n.push(o[0]),n.push(o[3]),n.push(0);n.push(i.Finished);const g=new Float64Array(n.length);for(let s=0;s<n.length;++s)g[s]=n.getItemAt(s);return g}export{u as I3SMeshWorkerHandle,c as toWasmModification};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}