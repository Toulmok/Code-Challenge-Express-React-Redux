{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Evented.js\";\nimport s from \"../../../../core/Logger.js\";\nimport { isNone as o, unwrapOr as i, isSome as n } from \"../../../../core/maybe.js\";\nimport { isPromiseLike as u, isAbortError as a } from \"../../../../core/promiseUtils.js\";\nimport { property as h } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport { subclass as c } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { RenderRequestType as p } from \"./basicInterfaces.js\";\nimport { ContentObjectType as d } from \"./ContentObjectType.js\";\nimport { TextureTechnique as l } from \"./TextureTechnique.js\";\nimport { TextureTechniqueConfiguration as m } from \"./TextureTechniqueConfiguration.js\";\nimport { assert as _ } from \"./Util.js\";\nimport { TaskPriority as f } from \"../../../support/Scheduler.js\";\nlet g = class extends t {\n  constructor(e, t, s) {\n    super({}), this._stage = e, this._techniqueRepository = t, this._rctx = s, this._textures = new Map(), this._loadingCount = 0, this._frameUpdates = new Map(), this.events = new r(), this._frameTask = e.view.resourceController.scheduler.registerTask(f.TEXTURE_UNLOAD);\n  }\n  normalizeCtorArgs() {\n    return {};\n  }\n  destroy() {\n    this._frameTask.remove(), this._stage.forEachOfType(d.Texture, e => e.unload());\n  }\n  get updating() {\n    return this._loadingCount > 0 || this._frameTask.updating;\n  }\n  get textureTechnique() {\n    return o(this._textureTechnique) && (this._textureTechnique = this._techniqueRepository.acquire(l, new m())), this._textureTechnique;\n  }\n  acquire(e) {\n    const t = this._textures.get(e);\n    return t ? (t.ref(), i(t.loadingPromise, t)) : this._createNewRef(e);\n  }\n  update() {\n    let e = !1;\n    this._frameUpdates.forEach(t => {\n      const r = t.texture.frameUpdate(this._rctx, this.textureTechnique, t.previousToken);\n      r >= 0 && r !== t.previousToken && (t.previousToken = r, e = !0);\n    }), e && this.events.emit(\"changed\", p.BACKGROUND);\n  }\n  _createNewRef(e) {\n    const t = this._stage.getObject(e);\n    if (o(t)) return _(void 0 !== t), null;\n    const r = t.events.on(\"unloaded\", () => {\n        r.remove(), this._onTextureUnloaded(e);\n      }),\n      i = new T(e, () => {\n        this._frameTask.schedule(() => {\n          i.isUnreferenced && t.unload();\n        });\n      });\n    return this._textures.set(e, i), i.ref(), n(t.glTexture) ? (this._updateGLTexture(i, t.glTexture), t.requiresFrameUpdates && this._frameUpdates.set(e, {\n      texture: t,\n      previousToken: -1\n    }), i) : (this._loadingCount++, i.loadingPromise = this._stage.schedule(() => {\n      const r = t.load(this._rctx, () => this.textureTechnique),\n        o = r => (this._loadingCount--, i.loadingPromise = null, this._updateGLTexture(i, r), t.requiresFrameUpdates && this._frameUpdates.set(e, {\n          texture: t,\n          previousToken: -1\n        }), i),\n        n = e => (this._loadingCount--, i.loadingPromise = null, a(e) || s.getLogger(this.declaredClass).error(e), null);\n      return u(r) ? r.then(o, n) : o(r);\n    }), i.loadingPromise);\n  }\n  _updateGLTexture(e, t) {\n    e.glTexture = t, this.events.emit(\"changed\", p.UPDATE);\n  }\n  _onTextureUnloaded(e) {\n    this._textures.delete(e), this._frameUpdates.delete(e);\n  }\n};\ne([h()], g.prototype, \"_loadingCount\", void 0), e([h()], g.prototype, \"_frameTask\", void 0), e([h()], g.prototype, \"updating\", null), g = e([c(\"esri.views.3d.webgl-engine.lib.TextureRepository\")], g);\nclass T {\n  constructor(e, t) {\n    this.id = e, this._release = t, this._refCount = 0;\n  }\n  get isUnreferenced() {\n    return 0 === this._refCount;\n  }\n  ref() {\n    ++this._refCount;\n  }\n  release() {\n    --this._refCount, this._refCount > 0 || (0 !== this._refCount ? (s.getLogger(\"esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl\").error(\"Cannot dereference texture that has no references!\"), this._refCount = 0) : this._release());\n  }\n}\nexport { g as TextureRepository };","map":{"version":3,"names":["_","e","t","r","s","isNone","o","unwrapOr","i","isSome","n","isPromiseLike","u","isAbortError","a","property","h","subclass","c","RenderRequestType","p","ContentObjectType","d","TextureTechnique","l","TextureTechniqueConfiguration","m","assert","TaskPriority","f","g","constructor","_stage","_techniqueRepository","_rctx","_textures","Map","_loadingCount","_frameUpdates","events","_frameTask","view","resourceController","scheduler","registerTask","TEXTURE_UNLOAD","normalizeCtorArgs","destroy","remove","forEachOfType","Texture","unload","updating","textureTechnique","_textureTechnique","acquire","get","ref","loadingPromise","_createNewRef","update","forEach","texture","frameUpdate","previousToken","emit","BACKGROUND","getObject","on","_onTextureUnloaded","T","schedule","isUnreferenced","set","glTexture","_updateGLTexture","requiresFrameUpdates","load","getLogger","declaredClass","error","then","UPDATE","delete","prototype","id","_release","_refCount","release","TextureRepository"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureRepository.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Evented.js\";import s from\"../../../../core/Logger.js\";import{isNone as o,unwrapOr as i,isSome as n}from\"../../../../core/maybe.js\";import{isPromiseLike as u,isAbortError as a}from\"../../../../core/promiseUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{RenderRequestType as p}from\"./basicInterfaces.js\";import{ContentObjectType as d}from\"./ContentObjectType.js\";import{TextureTechnique as l}from\"./TextureTechnique.js\";import{TextureTechniqueConfiguration as m}from\"./TextureTechniqueConfiguration.js\";import{assert as _}from\"./Util.js\";import{TaskPriority as f}from\"../../../support/Scheduler.js\";let g=class extends t{constructor(e,t,s){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=s,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new r,this._frameTask=e.view.resourceController.scheduler.registerTask(f.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(d.Texture,(e=>e.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return o(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(l,new m)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),i(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)})),e&&this.events.emit(\"changed\",p.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(o(t))return _(void 0!==t),null;const r=t.events.on(\"unloaded\",(()=>{r.remove(),this._onTextureUnloaded(e)})),i=new T(e,(()=>{this._frameTask.schedule((()=>{i.isUnreferenced&&t.unload()}))}));return this._textures.set(e,i),i.ref(),n(t.glTexture)?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule((()=>{const r=t.load(this._rctx,(()=>this.textureTechnique)),o=r=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,r),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),n=e=>(this._loadingCount--,i.loadingPromise=null,a(e)||s.getLogger(this.declaredClass).error(e),null);return u(r)?r.then(o,n):o(r)})),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit(\"changed\",p.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};e([h()],g.prototype,\"_loadingCount\",void 0),e([h()],g.prototype,\"_frameTask\",void 0),e([h()],g.prototype,\"updating\",null),g=e([c(\"esri.views.3d.webgl-engine.lib.TextureRepository\")],g);class T{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(s.getLogger(\"esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl\").error(\"Cannot dereference texture that has no references!\"),this._refCount=0):this._release())}}export{g as TextureRepository};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}