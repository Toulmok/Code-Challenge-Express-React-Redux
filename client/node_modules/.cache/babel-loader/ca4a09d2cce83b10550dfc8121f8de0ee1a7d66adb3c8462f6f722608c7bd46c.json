{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { createScreenPointArray as e, createRenderScreenPointArray3 as t } from \"../../../../core/screenUtils.js\";\nimport { g as i, a as r } from \"../../../../chunks/vec3.js\";\nimport { c as s } from \"../../../../chunks/vec3f64.js\";\nimport { create as o, fromValues as n, distance as a, empty as c, expandPointInPlace as l, expand as h } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { PlaneIndex as m } from \"../../../../geometry/support/frustum.js\";\nimport { signedDistance as _, normal as u } from \"../../../../geometry/support/plane.js\";\nimport { areaPoints2d as p } from \"../../../../geometry/support/triangle.js\";\nimport { Visibility as d } from \"./FeatureTileDescriptor3D.js\";\nimport { FeatureTileVisibility3D as f } from \"./FeatureTileVisibility3D.js\";\nimport { Camera as S } from \"../../webgl-engine/lib/Camera.js\";\nclass j {\n  constructor(e) {\n    this._camera = new S(), this._focusOnMap = [0, 0], this._screenRect = o(), this._tileSize = e.tileSize, this._renderCoordsHelper = e.renderCoordsHelper, this._tilingScheme = e.tilingScheme, this._visibility = new f(e.renderCoordsHelper);\n  }\n  begin(e, t, i) {\n    this._camera.copyFrom(e), this._surfaceElevation = i, this._focusOnMap[0] = t.x, this._focusOnMap[1] = t.y, n(0, 0, e.fullWidth, e.fullHeight, this._screenRect), this._visibility.begin(this._camera, i);\n  }\n  end() {\n    this._visibility.end();\n  }\n  updateTile(e) {\n    e.measures.visibility = this._visibility.calculate(e), e.measures.distance = a(e.extent, this._focusOnMap), e.measures.visibility !== d.INVISIBLE && this._updateScreenMeasure(e);\n  }\n  _updateScreenMeasure(e) {\n    const t = T,\n      i = 1 << t,\n      r = e.measures.screenRect;\n    c(r);\n    let s = 0;\n    const o = e.lij[0] + t,\n      n = e.lij[1] << t,\n      a = e.lij[2] << t,\n      l = this._tileSizeWithBias(e),\n      h = l * l;\n    for (let c = 0; c < i; c++) for (let t = 0; t < i; t++) if (s += this._computeScreenArea(e, o, n + c, a + t, r), s > h) return void (e.measures.shouldSplit = !0);\n    e.measures.shouldSplit = !1;\n  }\n  _tileSizeWithBias(e) {\n    return e.measures.visibility === d.VISIBLE_WHEN_EXTENDED ? this._tileSize * y : this._tileSize;\n  }\n  _computeScreenArea(e, t, i, r, s) {\n    const o = e.measures.visibility === d.VISIBLE_WHEN_EXTENDED;\n    this._projectToScreen(t, i, r, o, E), c(g);\n    for (let n = 0; n < 4; n++) l(g, E[n]);\n    return h(s, g, s), p(E[0], E[1], E[2]) + p(E[0], E[2], E[3]);\n  }\n  _projectToScreen(e, t, i, r, s) {\n    this._tilingScheme.ensureMaxLod(e), this._tilingScheme.getExtent(e, t, i, b), this._toRenderCoords(b, 0, 3, R[0]), this._toRenderCoords(b, 2, 3, R[1]), this._toRenderCoords(b, 2, 1, R[2]), this._toRenderCoords(b, 0, 1, R[3]), r && (this._projectToPlane(R, this._camera.frustum[m.NEAR]), this._projectToPlane(R, this._camera.frustum[m.TOP]), this._projectToPlane(R, this._camera.frustum[m.BOTTOM]));\n    for (let o = 0; o < 4; o++) this._camera.projectToRenderScreen(R[o], M), this._camera.renderToScreen(M, s[o]);\n  }\n  _projectToPlane(e, t) {\n    for (let i = 0; i < 4; i++) C[i] = _(t, e[i]);\n    const s = Math.max(C[0], C[1], C[2], C[3]);\n    if (s > 0) {\n      const o = i(v, u(t), -s);\n      for (let t = 0; t < 4; t++) r(e[t], e[t], o);\n    }\n  }\n  _toRenderCoords(e, t, i, r) {\n    return v[0] = e[t], v[1] = e[i], v[2] = this._surfaceElevation, this._renderCoordsHelper.toRenderCoords(v, this._tilingScheme.spatialReference, r), r;\n  }\n}\nconst g = o(),\n  T = 2,\n  y = 5,\n  E = [e(), e(), e(), e()],\n  b = o(),\n  v = s(),\n  R = [s(), s(), s(), s()],\n  C = [0, 0, 0, 0],\n  M = t();\nexport { j as FeatureTileMeasurements3D };","map":{"version":3,"names":["createScreenPointArray","e","createRenderScreenPointArray3","t","g","i","a","r","c","s","create","o","fromValues","n","distance","empty","expandPointInPlace","l","expand","h","PlaneIndex","m","signedDistance","_","normal","u","areaPoints2d","p","Visibility","d","FeatureTileVisibility3D","f","Camera","S","j","constructor","_camera","_focusOnMap","_screenRect","_tileSize","tileSize","_renderCoordsHelper","renderCoordsHelper","_tilingScheme","tilingScheme","_visibility","begin","copyFrom","_surfaceElevation","x","y","fullWidth","fullHeight","end","updateTile","measures","visibility","calculate","extent","INVISIBLE","_updateScreenMeasure","T","screenRect","lij","_tileSizeWithBias","_computeScreenArea","shouldSplit","VISIBLE_WHEN_EXTENDED","_projectToScreen","E","ensureMaxLod","getExtent","b","_toRenderCoords","R","_projectToPlane","frustum","NEAR","TOP","BOTTOM","projectToRenderScreen","M","renderToScreen","C","Math","max","v","toRenderCoords","spatialReference","FeatureTileMeasurements3D"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/layers/support/FeatureTileMeasurements3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{createScreenPointArray as e,createRenderScreenPointArray3 as t}from\"../../../../core/screenUtils.js\";import{g as i,a as r}from\"../../../../chunks/vec3.js\";import{c as s}from\"../../../../chunks/vec3f64.js\";import{create as o,fromValues as n,distance as a,empty as c,expandPointInPlace as l,expand as h}from\"../../../../geometry/support/aaBoundingRect.js\";import{PlaneIndex as m}from\"../../../../geometry/support/frustum.js\";import{signedDistance as _,normal as u}from\"../../../../geometry/support/plane.js\";import{areaPoints2d as p}from\"../../../../geometry/support/triangle.js\";import{Visibility as d}from\"./FeatureTileDescriptor3D.js\";import{FeatureTileVisibility3D as f}from\"./FeatureTileVisibility3D.js\";import{Camera as S}from\"../../webgl-engine/lib/Camera.js\";class j{constructor(e){this._camera=new S,this._focusOnMap=[0,0],this._screenRect=o(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new f(e.renderCoordsHelper)}begin(e,t,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=t.x,this._focusOnMap[1]=t.y,n(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=a(e.extent,this._focusOnMap),e.measures.visibility!==d.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const t=T,i=1<<t,r=e.measures.screenRect;c(r);let s=0;const o=e.lij[0]+t,n=e.lij[1]<<t,a=e.lij[2]<<t,l=this._tileSizeWithBias(e),h=l*l;for(let c=0;c<i;c++)for(let t=0;t<i;t++)if(s+=this._computeScreenArea(e,o,n+c,a+t,r),s>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===d.VISIBLE_WHEN_EXTENDED?this._tileSize*y:this._tileSize}_computeScreenArea(e,t,i,r,s){const o=e.measures.visibility===d.VISIBLE_WHEN_EXTENDED;this._projectToScreen(t,i,r,o,E),c(g);for(let n=0;n<4;n++)l(g,E[n]);return h(s,g,s),p(E[0],E[1],E[2])+p(E[0],E[2],E[3])}_projectToScreen(e,t,i,r,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,t,i,b),this._toRenderCoords(b,0,3,R[0]),this._toRenderCoords(b,2,3,R[1]),this._toRenderCoords(b,2,1,R[2]),this._toRenderCoords(b,0,1,R[3]),r&&(this._projectToPlane(R,this._camera.frustum[m.NEAR]),this._projectToPlane(R,this._camera.frustum[m.TOP]),this._projectToPlane(R,this._camera.frustum[m.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(R[o],M),this._camera.renderToScreen(M,s[o])}_projectToPlane(e,t){for(let i=0;i<4;i++)C[i]=_(t,e[i]);const s=Math.max(C[0],C[1],C[2],C[3]);if(s>0){const o=i(v,u(t),-s);for(let t=0;t<4;t++)r(e[t],e[t],o)}}_toRenderCoords(e,t,i,r){return v[0]=e[t],v[1]=e[i],v[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(v,this._tilingScheme.spatialReference,r),r}}const g=o(),T=2,y=5,E=[e(),e(),e(),e()],b=o(),v=s(),R=[s(),s(),s(),s()],C=[0,0,0,0],M=t();export{j as FeatureTileMeasurements3D};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}