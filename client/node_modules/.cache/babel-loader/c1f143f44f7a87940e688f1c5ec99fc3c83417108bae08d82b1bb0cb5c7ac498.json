{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport \"../../../../../core/has.js\";\nimport { isSome as t, applySome as s } from \"../../../../../core/maybe.js\";\nimport \"../../../../../core/Logger.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport \"../../../../../core/Error.js\";\nimport { subclass as r } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { diff as i } from \"../../../../../core/accessorSupport/diffUtils.js\";\nimport { calculateHeatmapIntensityInfoReaders as o } from \"../../../../../renderers/support/heatmapUtils.js\";\nimport { TILE_SIZE as a } from \"../../../engine/webgl/definitions.js\";\nimport n from \"./BaseProcessor.js\";\nimport { getPow2NeighborKey as d } from \"../support/tileUtils.js\";\nclass p {\n  constructor(e, t) {\n    this.offset = e, this.extent = t;\n  }\n}\nfunction c(e) {\n  const t = e.key,\n    s = new Map(),\n    r = 256,\n    i = a,\n    o = e.tileInfoView.tileInfo.isWrappable;\n  return s.set(d(t, -1, -1, o).id, new p([-i, -i], [i - r, i - r, i, i])), s.set(d(t, 0, -1, o).id, new p([0, -i], [0, i - r, i, i])), s.set(d(t, 1, -1, o).id, new p([i, -i], [0, i - r, r, i])), s.set(d(t, -1, 0, o).id, new p([-i, 0], [i - r, 0, i, i])), s.set(d(t, 1, 0, o).id, new p([i, 0], [0, 0, r, i])), s.set(d(t, -1, 1, o).id, new p([-i, i], [i - r, 0, i, r])), s.set(d(t, 0, 1, o).id, new p([0, i], [0, 0, i, r])), s.set(d(t, 1, 1, o).id, new p([i, i], [0, 0, r, r])), s;\n}\nlet l = class extends n {\n  constructor() {\n    super(...arguments), this.type = \"heatmap\", this._tileKeyToFeatureSets = new Map();\n  }\n  initialize() {\n    this.handles.add([this.tileStore.on(\"update\", this.onTileUpdate.bind(this))]);\n  }\n  async update(e, t) {\n    const s = t.schema.processors[0];\n    if (\"heatmap\" !== s.type) return;\n    i(this._schema, s) && (e.mesh = !0, this._schema = s);\n  }\n  onTileUpdate(e) {\n    for (const t of e.removed) this._tileKeyToFeatureSets.delete(t.key.id);\n  }\n  onTileClear(e) {\n    const t = {\n      clear: !0\n    };\n    return this._tileKeyToFeatureSets.delete(e.key.id), this.remoteClient.invoke(\"tileRenderer.onTileData\", {\n      tileKey: e.id,\n      data: t\n    });\n  }\n  async onTileMessage(e, r, i) {\n    this._tileKeyToFeatureSets.has(e.key.id) || this._tileKeyToFeatureSets.set(e.key.id, new Map());\n    const a = this._tileKeyToFeatureSets.get(e.key.id);\n    if (a && t(r.addOrUpdate) && r.addOrUpdate.hasFeatures && a.set(r.addOrUpdate.instance, r), r.end) {\n      const t = [],\n        r = c(e);\n      this._tileKeyToFeatureSets.forEach((i, o) => {\n        if (o === e.key.id) i.forEach(e => s(e.addOrUpdate, e => t.push(e)));else if (r.has(o)) {\n          const e = r.get(o),\n            [a, n] = e.offset;\n          i.forEach(e => s(e.addOrUpdate, e => {\n            const s = e.transform(a, n, 1, 1);\n            t.push(s);\n          }));\n        }\n      });\n      const a = o(t, this._schema.mesh, 512, 512),\n        n = {\n          tileKey: e.key.id,\n          intensityInfo: a\n        },\n        d = [a.matrix];\n      return this.remoteClient.invoke(\"tileRenderer.onTileData\", n, {\n        ...i,\n        transferList: d\n      });\n    }\n  }\n  onTileError(e, t, s) {\n    return this.remoteClient.invoke(\"tileRenderer.onTileError\", {\n      tileKey: e.id,\n      error: t\n    }, s);\n  }\n};\nl = e([r(\"esri.views.2d.layers.features.processors.HeatmapProcessor\")], l);\nconst h = l;\nexport { h as default };","map":{"version":3,"names":["_","e","isSome","t","applySome","s","subclass","r","diff","i","calculateHeatmapIntensityInfoReaders","o","TILE_SIZE","a","n","getPow2NeighborKey","d","p","constructor","offset","extent","c","key","Map","tileInfoView","tileInfo","isWrappable","set","id","l","arguments","type","_tileKeyToFeatureSets","initialize","handles","add","tileStore","on","onTileUpdate","bind","update","schema","processors","_schema","mesh","removed","delete","onTileClear","clear","remoteClient","invoke","tileKey","data","onTileMessage","has","get","addOrUpdate","hasFeatures","instance","end","forEach","push","transform","intensityInfo","matrix","transferList","onTileError","error","h","default"],"sources":["C:/code-challenge-react/client/node_modules/@arcgis/core/views/2d/layers/features/processors/HeatmapProcessor.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import{isSome as t,applySome as s}from\"../../../../../core/maybe.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/Error.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{diff as i}from\"../../../../../core/accessorSupport/diffUtils.js\";import{calculateHeatmapIntensityInfoReaders as o}from\"../../../../../renderers/support/heatmapUtils.js\";import{TILE_SIZE as a}from\"../../../engine/webgl/definitions.js\";import n from\"./BaseProcessor.js\";import{getPow2NeighborKey as d}from\"../support/tileUtils.js\";class p{constructor(e,t){this.offset=e,this.extent=t}}function c(e){const t=e.key,s=new Map,r=256,i=a,o=e.tileInfoView.tileInfo.isWrappable;return s.set(d(t,-1,-1,o).id,new p([-i,-i],[i-r,i-r,i,i])),s.set(d(t,0,-1,o).id,new p([0,-i],[0,i-r,i,i])),s.set(d(t,1,-1,o).id,new p([i,-i],[0,i-r,r,i])),s.set(d(t,-1,0,o).id,new p([-i,0],[i-r,0,i,i])),s.set(d(t,1,0,o).id,new p([i,0],[0,0,r,i])),s.set(d(t,-1,1,o).id,new p([-i,i],[i-r,0,i,r])),s.set(d(t,0,1,o).id,new p([0,i],[0,0,i,r])),s.set(d(t,1,1,o).id,new p([i,i],[0,0,r,r])),s}let l=class extends n{constructor(){super(...arguments),this.type=\"heatmap\",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this))])}async update(e,t){const s=t.schema.processors[0];if(\"heatmap\"!==s.type)return;i(this._schema,s)&&(e.mesh=!0,this._schema=s)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){const t={clear:!0};return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke(\"tileRenderer.onTileData\",{tileKey:e.id,data:t})}async onTileMessage(e,r,i){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const a=this._tileKeyToFeatureSets.get(e.key.id);if(a&&t(r.addOrUpdate)&&r.addOrUpdate.hasFeatures&&a.set(r.addOrUpdate.instance,r),r.end){const t=[],r=c(e);this._tileKeyToFeatureSets.forEach(((i,o)=>{if(o===e.key.id)i.forEach((e=>s(e.addOrUpdate,(e=>t.push(e)))));else if(r.has(o)){const e=r.get(o),[a,n]=e.offset;i.forEach((e=>s(e.addOrUpdate,(e=>{const s=e.transform(a,n,1,1);t.push(s)}))))}}));const a=o(t,this._schema.mesh,512,512),n={tileKey:e.key.id,intensityInfo:a},d=[a.matrix];return this.remoteClient.invoke(\"tileRenderer.onTileData\",n,{...i,transferList:d})}}onTileError(e,t,s){return this.remoteClient.invoke(\"tileRenderer.onTileError\",{tileKey:e.id,error:t},s)}};l=e([r(\"esri.views.2d.layers.features.processors.HeatmapProcessor\")],l);const h=l;export{h as default};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAC,QAAK,oCAAoC;AAAC,OAAM,4BAA4B;AAAC,SAAOC,MAAM,IAAIC,CAAC,EAACC,SAAS,IAAIC,CAAC,QAAK,8BAA8B;AAAC,OAAM,+BAA+B;AAAC,OAAM,mDAAmD;AAAC,OAAM,mCAAmC;AAAC,OAAM,8BAA8B;AAAC,SAAOC,QAAQ,IAAIC,CAAC,QAAK,4DAA4D;AAAC,SAAOC,IAAI,IAAIC,CAAC,QAAK,kDAAkD;AAAC,SAAOC,oCAAoC,IAAIC,CAAC,QAAK,kDAAkD;AAAC,SAAOC,SAAS,IAAIC,CAAC,QAAK,sCAAsC;AAAC,OAAOC,CAAC,MAAK,oBAAoB;AAAC,SAAOC,kBAAkB,IAAIC,CAAC,QAAK,yBAAyB;AAAC,MAAMC,CAAC;EAACC,WAAWA,CAACjB,CAAC,EAACE,CAAC,EAAC;IAAC,IAAI,CAACgB,MAAM,GAAClB,CAAC,EAAC,IAAI,CAACmB,MAAM,GAACjB,CAAC;EAAA;AAAC;AAAC,SAASkB,CAACA,CAACpB,CAAC,EAAC;EAAC,MAAME,CAAC,GAACF,CAAC,CAACqB,GAAG;IAACjB,CAAC,GAAC,IAAIkB,GAAG;IAAChB,CAAC,GAAC,GAAG;IAACE,CAAC,GAACI,CAAC;IAACF,CAAC,GAACV,CAAC,CAACuB,YAAY,CAACC,QAAQ,CAACC,WAAW;EAAC,OAAOrB,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAAC,CAACR,CAAC,EAAC,CAACA,CAAC,CAAC,EAAC,CAACA,CAAC,GAACF,CAAC,EAACE,CAAC,GAACF,CAAC,EAACE,CAAC,EAACA,CAAC,CAAC,CAAC,CAAC,EAACJ,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAAC,CAAC,EAAC,CAACR,CAAC,CAAC,EAAC,CAAC,CAAC,EAACA,CAAC,GAACF,CAAC,EAACE,CAAC,EAACA,CAAC,CAAC,CAAC,CAAC,EAACJ,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAACR,CAAC,EAAC,CAACA,CAAC,CAAC,EAAC,CAAC,CAAC,EAACA,CAAC,GAACF,CAAC,EAACA,CAAC,EAACE,CAAC,CAAC,CAAC,CAAC,EAACJ,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAAC,CAACR,CAAC,EAAC,CAAC,CAAC,EAAC,CAACA,CAAC,GAACF,CAAC,EAAC,CAAC,EAACE,CAAC,EAACA,CAAC,CAAC,CAAC,CAAC,EAACJ,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,EAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAACR,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,EAACF,CAAC,EAACE,CAAC,CAAC,CAAC,CAAC,EAACJ,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAAC,CAACR,CAAC,EAACA,CAAC,CAAC,EAAC,CAACA,CAAC,GAACF,CAAC,EAAC,CAAC,EAACE,CAAC,EAACF,CAAC,CAAC,CAAC,CAAC,EAACF,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,EAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAAC,CAAC,EAACR,CAAC,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,EAACA,CAAC,EAACF,CAAC,CAAC,CAAC,CAAC,EAACF,CAAC,CAACsB,GAAG,CAACX,CAAC,CAACb,CAAC,EAAC,CAAC,EAAC,CAAC,EAACQ,CAAC,CAAC,CAACiB,EAAE,EAAC,IAAIX,CAAC,CAAC,CAACR,CAAC,EAACA,CAAC,CAAC,EAAC,CAAC,CAAC,EAAC,CAAC,EAACF,CAAC,EAACA,CAAC,CAAC,CAAC,CAAC,EAACF,CAAC;AAAA;AAAC,IAAIwB,CAAC,GAAC,cAAcf,CAAC;EAACI,WAAWA,CAAA,EAAE;IAAC,KAAK,CAAC,GAAGY,SAAS,CAAC,EAAC,IAAI,CAACC,IAAI,GAAC,SAAS,EAAC,IAAI,CAACC,qBAAqB,GAAC,IAAIT,GAAG;EAAA;EAACU,UAAUA,CAAA,EAAE;IAAC,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,IAAI,CAACC,SAAS,CAACC,EAAE,CAAC,QAAQ,EAAC,IAAI,CAACC,YAAY,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;EAAA;EAAC,MAAMC,MAAMA,CAACvC,CAAC,EAACE,CAAC,EAAC;IAAC,MAAME,CAAC,GAACF,CAAC,CAACsC,MAAM,CAACC,UAAU,CAAC,CAAC,CAAC;IAAC,IAAG,SAAS,KAAGrC,CAAC,CAAC0B,IAAI,EAAC;IAAOtB,CAAC,CAAC,IAAI,CAACkC,OAAO,EAACtC,CAAC,CAAC,KAAGJ,CAAC,CAAC2C,IAAI,GAAC,CAAC,CAAC,EAAC,IAAI,CAACD,OAAO,GAACtC,CAAC,CAAC;EAAA;EAACiC,YAAYA,CAACrC,CAAC,EAAC;IAAC,KAAI,MAAME,CAAC,IAAIF,CAAC,CAAC4C,OAAO,EAAC,IAAI,CAACb,qBAAqB,CAACc,MAAM,CAAC3C,CAAC,CAACmB,GAAG,CAACM,EAAE,CAAC;EAAA;EAACmB,WAAWA,CAAC9C,CAAC,EAAC;IAAC,MAAME,CAAC,GAAC;MAAC6C,KAAK,EAAC,CAAC;IAAC,CAAC;IAAC,OAAO,IAAI,CAAChB,qBAAqB,CAACc,MAAM,CAAC7C,CAAC,CAACqB,GAAG,CAACM,EAAE,CAAC,EAAC,IAAI,CAACqB,YAAY,CAACC,MAAM,CAAC,yBAAyB,EAAC;MAACC,OAAO,EAAClD,CAAC,CAAC2B,EAAE;MAACwB,IAAI,EAACjD;IAAC,CAAC,CAAC;EAAA;EAAC,MAAMkD,aAAaA,CAACpD,CAAC,EAACM,CAAC,EAACE,CAAC,EAAC;IAAC,IAAI,CAACuB,qBAAqB,CAACsB,GAAG,CAACrD,CAAC,CAACqB,GAAG,CAACM,EAAE,CAAC,IAAE,IAAI,CAACI,qBAAqB,CAACL,GAAG,CAAC1B,CAAC,CAACqB,GAAG,CAACM,EAAE,EAAC,IAAIL,GAAG,GAAC;IAAC,MAAMV,CAAC,GAAC,IAAI,CAACmB,qBAAqB,CAACuB,GAAG,CAACtD,CAAC,CAACqB,GAAG,CAACM,EAAE,CAAC;IAAC,IAAGf,CAAC,IAAEV,CAAC,CAACI,CAAC,CAACiD,WAAW,CAAC,IAAEjD,CAAC,CAACiD,WAAW,CAACC,WAAW,IAAE5C,CAAC,CAACc,GAAG,CAACpB,CAAC,CAACiD,WAAW,CAACE,QAAQ,EAACnD,CAAC,CAAC,EAACA,CAAC,CAACoD,GAAG,EAAC;MAAC,MAAMxD,CAAC,GAAC,EAAE;QAACI,CAAC,GAACc,CAAC,CAACpB,CAAC,CAAC;MAAC,IAAI,CAAC+B,qBAAqB,CAAC4B,OAAO,CAAE,CAACnD,CAAC,EAACE,CAAC,KAAG;QAAC,IAAGA,CAAC,KAAGV,CAAC,CAACqB,GAAG,CAACM,EAAE,EAACnB,CAAC,CAACmD,OAAO,CAAE3D,CAAC,IAAEI,CAAC,CAACJ,CAAC,CAACuD,WAAW,EAAEvD,CAAC,IAAEE,CAAC,CAAC0D,IAAI,CAAC5D,CAAC,CAAC,CAAE,CAAE,CAAC,KAAK,IAAGM,CAAC,CAAC+C,GAAG,CAAC3C,CAAC,CAAC,EAAC;UAAC,MAAMV,CAAC,GAACM,CAAC,CAACgD,GAAG,CAAC5C,CAAC,CAAC;YAAC,CAACE,CAAC,EAACC,CAAC,CAAC,GAACb,CAAC,CAACkB,MAAM;UAACV,CAAC,CAACmD,OAAO,CAAE3D,CAAC,IAAEI,CAAC,CAACJ,CAAC,CAACuD,WAAW,EAAEvD,CAAC,IAAE;YAAC,MAAMI,CAAC,GAACJ,CAAC,CAAC6D,SAAS,CAACjD,CAAC,EAACC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC;YAACX,CAAC,CAAC0D,IAAI,CAACxD,CAAC,CAAC;UAAA,CAAC,CAAE,CAAE;QAAA;MAAC,CAAC,CAAE;MAAC,MAAMQ,CAAC,GAACF,CAAC,CAACR,CAAC,EAAC,IAAI,CAACwC,OAAO,CAACC,IAAI,EAAC,GAAG,EAAC,GAAG,CAAC;QAAC9B,CAAC,GAAC;UAACqC,OAAO,EAAClD,CAAC,CAACqB,GAAG,CAACM,EAAE;UAACmC,aAAa,EAAClD;QAAC,CAAC;QAACG,CAAC,GAAC,CAACH,CAAC,CAACmD,MAAM,CAAC;MAAC,OAAO,IAAI,CAACf,YAAY,CAACC,MAAM,CAAC,yBAAyB,EAACpC,CAAC,EAAC;QAAC,GAAGL,CAAC;QAACwD,YAAY,EAACjD;MAAC,CAAC,CAAC;IAAA;EAAC;EAACkD,WAAWA,CAACjE,CAAC,EAACE,CAAC,EAACE,CAAC,EAAC;IAAC,OAAO,IAAI,CAAC4C,YAAY,CAACC,MAAM,CAAC,0BAA0B,EAAC;MAACC,OAAO,EAAClD,CAAC,CAAC2B,EAAE;MAACuC,KAAK,EAAChE;IAAC,CAAC,EAACE,CAAC,CAAC;EAAA;AAAC,CAAC;AAACwB,CAAC,GAAC5B,CAAC,CAAC,CAACM,CAAC,CAAC,2DAA2D,CAAC,CAAC,EAACsB,CAAC,CAAC;AAAC,MAAMuC,CAAC,GAACvC,CAAC;AAAC,SAAOuC,CAAC,IAAIC,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}