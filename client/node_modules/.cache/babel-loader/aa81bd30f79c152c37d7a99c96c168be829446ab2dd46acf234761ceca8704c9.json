{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport t from \"../../../../core/Error.js\";\nimport s from \"../../../../core/Handles.js\";\nimport { destroyMaybe as n, isNone as o } from \"../../../../core/maybe.js\";\nimport { property as i } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport { subclass as a } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport u from \"../../../../geometry/Extent.js\";\nimport { fallbackObjectIDAttribute as y } from \"../../../../layers/LayerConstants.js\";\nimport { QueryEngine as c } from \"../../../../layers/graphics/data/QueryEngine.js\";\nimport l from \"../../../../rest/support/FeatureSet.js\";\nimport p from \"../../../../rest/support/Query.js\";\nconst d = c;\nlet h = class extends r {\n  get spatialReference() {\n    return this.layerView.view.spatialReference;\n  }\n  get layer() {\n    return this.layerView.i3slayer;\n  }\n  get defaultQueryJSON() {\n    return new p({\n      outSpatialReference: this.spatialReference\n    }).toJSON();\n  }\n  get _dataQueryEngine() {\n    return this._ensureDataQueryEngine();\n  }\n  constructor(e) {\n    super(e), this._handles = new s();\n  }\n  initialize() {\n    this._handles.add(this.layerView.on(\"visible-geometry-changed\", () => this.spatialIndex.events.emit(\"changed\")));\n  }\n  destroy() {\n    this._dataQueryEngineInstance = n(this._dataQueryEngineInstance), this._handles = n(this._handles), this._set(\"layerView\", null);\n  }\n  async executeQueryForCount(e, r) {\n    return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e), r);\n  }\n  async executeQueryForExtent(e, r) {\n    const {\n      count: t,\n      extent: s\n    } = await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e), r);\n    return {\n      count: t,\n      extent: u.fromJSON(s)\n    };\n  }\n  async executeQueryForIds(e, r) {\n    return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e), r);\n  }\n  async executeQuery(e, r) {\n    const s = this._ensureQueryJSON(e);\n    if (s.returnGeometry) throw new t(\"feature-store:unsupported-query\", \"returnGeometry is not yet supported for mesh scene layer queries\");\n    if (s.returnCentroid) throw new t(\"feature-store:unsupported-query\", \"returnCentroid is not yet supported for mesh scene layer queries\");\n    const n = await this._dataQueryEngine.executeQuery(s, r),\n      o = l.fromJSON(n);\n    return o.features.forEach(e => {\n      e.geometry = null;\n    }), o;\n  }\n  _ensureQueryJSON(e) {\n    return o(e) ? this.defaultQueryJSON : e.toJSON();\n  }\n  _ensureDataQueryEngine() {\n    if (this._dataQueryEngineInstance) return this._dataQueryEngineInstance;\n    const e = this.layer.objectIdField || y,\n      r = \"esriGeometryPolygon\",\n      t = this.layer.fields?.map(e => e.toJSON()) ?? [],\n      s = this.layerView.view.resourceController.scheduler,\n      n = this.spatialReference.toJSON(),\n      o = this.priority,\n      i = this.spatialIndex;\n    return this._dataQueryEngineInstance = new d({\n      hasZ: !0,\n      hasM: !1,\n      geometryType: r,\n      fields: t,\n      timeInfo: null,\n      spatialReference: n,\n      objectIdField: e,\n      featureStore: i,\n      scheduler: s,\n      priority: o\n    }), this._dataQueryEngineInstance;\n  }\n};\ne([i({\n  constructOnly: !0\n})], h.prototype, \"layerView\", void 0), e([i({\n  constructOnly: !0\n})], h.prototype, \"priority\", void 0), e([i({\n  constructOnly: !0\n})], h.prototype, \"spatialIndex\", void 0), e([i()], h.prototype, \"spatialReference\", null), e([i()], h.prototype, \"layer\", null), e([i()], h.prototype, \"defaultQueryJSON\", null), h = e([a(\"esri.views.3d.layers.i3s.I3SQueryEngine\")], h);\nexport { h as I3SQueryEngine };","map":{"version":3,"names":["_","e","r","t","s","destroyMaybe","n","isNone","o","property","i","subclass","a","u","fallbackObjectIDAttribute","y","QueryEngine","c","l","p","d","h","spatialReference","layerView","view","layer","i3slayer","defaultQueryJSON","outSpatialReference","toJSON","_dataQueryEngine","_ensureDataQueryEngine","constructor","_handles","initialize","add","on","spatialIndex","events","emit","destroy","_dataQueryEngineInstance","_set","executeQueryForCount","_ensureQueryJSON","executeQueryForExtent","count","extent","fromJSON","executeQueryForIds","executeQuery","returnGeometry","returnCentroid","features","forEach","geometry","objectIdField","fields","map","resourceController","scheduler","priority","hasZ","hasM","geometryType","timeInfo","featureStore","constructOnly","prototype","I3SQueryEngine"],"sources":["C:/code-challenge-react/frontend/node_modules/@arcgis/core/views/3d/layers/i3s/I3SQueryEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Accessor.js\";import t from\"../../../../core/Error.js\";import s from\"../../../../core/Handles.js\";import{destroyMaybe as n,isNone as o}from\"../../../../core/maybe.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import u from\"../../../../geometry/Extent.js\";import{fallbackObjectIDAttribute as y}from\"../../../../layers/LayerConstants.js\";import{QueryEngine as c}from\"../../../../layers/graphics/data/QueryEngine.js\";import l from\"../../../../rest/support/FeatureSet.js\";import p from\"../../../../rest/support/Query.js\";const d=c;let h=class extends r{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new p({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(e){super(e),this._handles=new s}initialize(){this._handles.add(this.layerView.on(\"visible-geometry-changed\",(()=>this.spatialIndex.events.emit(\"changed\"))))}destroy(){this._dataQueryEngineInstance=n(this._dataQueryEngineInstance),this._handles=n(this._handles),this._set(\"layerView\",null)}async executeQueryForCount(e,r){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:u.fromJSON(s)}}async executeQueryForIds(e,r){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQuery(e,r){const s=this._ensureQueryJSON(e);if(s.returnGeometry)throw new t(\"feature-store:unsupported-query\",\"returnGeometry is not yet supported for mesh scene layer queries\");if(s.returnCentroid)throw new t(\"feature-store:unsupported-query\",\"returnCentroid is not yet supported for mesh scene layer queries\");const n=await this._dataQueryEngine.executeQuery(s,r),o=l.fromJSON(n);return o.features.forEach((e=>{e.geometry=null})),o}_ensureQueryJSON(e){return o(e)?this.defaultQueryJSON:e.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||y,r=\"esriGeometryPolygon\",t=this.layer.fields?.map((e=>e.toJSON()))??[],s=this.layerView.view.resourceController.scheduler,n=this.spatialReference.toJSON(),o=this.priority,i=this.spatialIndex;return this._dataQueryEngineInstance=new d({hasZ:!0,hasM:!1,geometryType:r,fields:t,timeInfo:null,spatialReference:n,objectIdField:e,featureStore:i,scheduler:s,priority:o}),this._dataQueryEngineInstance}};e([i({constructOnly:!0})],h.prototype,\"layerView\",void 0),e([i({constructOnly:!0})],h.prototype,\"priority\",void 0),e([i({constructOnly:!0})],h.prototype,\"spatialIndex\",void 0),e([i()],h.prototype,\"spatialReference\",null),e([i()],h.prototype,\"layer\",null),e([i()],h.prototype,\"defaultQueryJSON\",null),h=e([a(\"esri.views.3d.layers.i3s.I3SQueryEngine\")],h);export{h as I3SQueryEngine};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}